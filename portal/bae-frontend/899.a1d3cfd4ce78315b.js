"use strict";(self.webpackChunkbae_frontend=self.webpackChunkbae_frontend||[]).push([[899],{1899:(Oe,S,c)=>{c.r(S),c.d(S,{TendersModule:()=>Ne});var h=c(177),v=c(1600),e=c(4438),u=c(9417),m=c(6354),b=c(7468),I=c(8508),C=c(3077),w=c(7473),j=c(8944),E=c(3836),G=c(6964),D=c(5586),L=c(3636),x=c(7673),F=c(5558),R=c(1626),k=c(9437),P=c(5312);let q=(()=>{class n{constructor(){this.http=(0,e.WQX)(R.Qq),this.endpoint=`${P.c.BASE_URL}/party/v4/organization`}getProviders(t={}){let r=new R.Nl;t.fields&&(r=r.set("fields",t.fields)),void 0!==t.offset&&(r=r.set("offset",t.offset.toString())),void 0!==t.limit&&(r=r.set("limit",t.limit.toString()));const o=`${this.endpoint}${r.toString()?"?"+r.toString():""}`;return this.http.get(o).pipe((0,m.T)(i=>Array.isArray(i)?i:[]),(0,k.W)(i=>(console.warn("Provider API failed:",i),(0,x.of)([]))))}getProviderById(t){const r=`${this.endpoint}/${t}`,o=r.startsWith("https://"),i=o?`https://api.allorigins.win/get?url=${encodeURIComponent(r)}`:r;return this.http.get(i).pipe((0,m.T)(s=>o?JSON.parse(s.contents):s),(0,k.W)(s=>{throw console.warn("Provider by ID API failed:",s),s}))}getProvidersForTender(){const t=this.endpoint,r=t.startsWith("https://"),o=r?`https://api.allorigins.win/get?url=${encodeURIComponent(t)}`:t;return this.http.get(o).pipe((0,m.T)(i=>{const s=r?JSON.parse(i.contents):i;return Array.isArray(s)?s:[]}),(0,k.W)(i=>(console.warn("Providers for tender API failed:",i),(0,x.of)([]))))}static#e=this.\u0275fac=function(r){return new(r||n)};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var p=c(2087);function Q(n,d){if(1&n){const t=e.RV6();e.j41(0,"div")(1,"div",9)(2,"label",10),e.EFF(3," Tender Title * "),e.k0s(),e.j41(4,"input",11),e.mxI("ngModelChange",function(o){e.eBV(t);const i=e.XpG(2);return e.DH7(i.tenderTitle,o)||(i.tenderTitle=o),e.Njj(o)}),e.k0s(),e.j41(5,"p",12),e.EFF(6,"This will be the main description of your tender"),e.k0s()(),e.j41(7,"div",13)(8,"button",14),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.closeTenderModal())}),e.EFF(9," Cancel "),e.k0s(),e.j41(10,"button",15),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.saveInitialTender())}),e.EFF(11),e.k0s()()()}if(2&n){const t=e.XpG(2);e.R7$(4),e.R50("ngModel",t.tenderTitle),e.R7$(6),e.Y8G("disabled",!t.tenderTitle.trim()||t.tenderLoading),e.R7$(),e.SpI(" ",t.tenderLoading?"Saving...":"Save"," ")}}function A(n,d){if(1&n&&(e.j41(0,"div",31)(1,"div",32)(2,"div",33),e.qSk(),e.j41(3,"svg",34),e.nrm(4,"path",35),e.k0s(),e.joV(),e.j41(5,"div")(6,"p",36),e.EFF(7,"Current PDF:"),e.k0s(),e.j41(8,"p",37),e.EFF(9),e.k0s()()(),e.j41(10,"span",38),e.EFF(11,"Attached"),e.k0s()(),e.j41(12,"p",39),e.EFF(13,"Upload a new file to replace the existing attachment"),e.k0s()()),2&n){const t=e.XpG(3);e.R7$(9),e.JRh(t.existingAttachment.name)}}function B(n,d){1&n&&(e.j41(0,"span",40),e.EFF(1," Complete all fields first "),e.k0s())}function U(n,d){if(1&n){const t=e.RV6();e.j41(0,"div")(1,"div",16)(2,"label",17),e.EFF(3,"Tender Title"),e.k0s(),e.j41(4,"p",18),e.EFF(5),e.k0s()(),e.j41(6,"div",9)(7,"label",19),e.EFF(8," Expected Fulfillment Start Date * "),e.k0s(),e.j41(9,"div",20)(10,"input",21),e.mxI("ngModelChange",function(o){e.eBV(t);const i=e.XpG(2);return e.DH7(i.requestedCompletionDate,o)||(i.requestedCompletionDate=o),e.Njj(o)}),e.k0s(),e.j41(11,"button",22),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.setRequestedDate())}),e.EFF(12),e.k0s()(),e.j41(13,"p",23),e.EFF(14,"Format: DD/MM/YYYY"),e.k0s()(),e.j41(15,"div",9)(16,"label",24),e.EFF(17," Effective Quote Completion Date * "),e.k0s(),e.j41(18,"div",20)(19,"input",25),e.mxI("ngModelChange",function(o){e.eBV(t);const i=e.XpG(2);return e.DH7(i.expectedCompletionDate,o)||(i.expectedCompletionDate=o),e.Njj(o)}),e.k0s(),e.j41(20,"button",22),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.setExpectedDate())}),e.EFF(21),e.k0s()(),e.j41(22,"p",23),e.EFF(23,"Format: DD/MM/YYYY"),e.k0s()(),e.j41(24,"div",9)(25,"label",26),e.EFF(26," PDF Attachment * "),e.k0s(),e.DNE(27,A,14,1,"div",27),e.j41(28,"div",20)(29,"input",28),e.bIt("change",function(o){e.eBV(t);const i=e.XpG(2);return e.Njj(i.onPdfFileSelected(o))}),e.k0s(),e.j41(30,"button",22),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.setPdfAttachment())}),e.EFF(31),e.k0s()(),e.j41(32,"p",23),e.EFF(33),e.k0s()(),e.j41(34,"div",13)(35,"button",14),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.closeTenderModal())}),e.EFF(36," Cancel "),e.k0s(),e.j41(37,"button",29),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.proceedToProviderSelection())}),e.EFF(38," Next: Select Providers "),e.DNE(39,B,2,0,"span",30),e.k0s()()()}if(2&n){const t=e.XpG(2);e.R7$(5),e.JRh(t.tenderTitle),e.R7$(5),e.R50("ngModel",t.requestedCompletionDate),e.R7$(),e.Y8G("disabled",!t.requestedCompletionDate||t.tenderLoading),e.R7$(),e.SpI(" ",t.requestedDateSet?"\u2713 Set":"Set"," "),e.R7$(7),e.R50("ngModel",t.expectedCompletionDate),e.R7$(),e.Y8G("disabled",!t.expectedCompletionDate||t.tenderLoading),e.R7$(),e.SpI(" ",t.expectedDateSet?"\u2713 Set":"Set"," "),e.R7$(6),e.Y8G("ngIf",t.existingAttachment),e.R7$(3),e.Y8G("disabled",!t.selectedPdfFile||t.tenderLoading),e.R7$(),e.SpI(" ",t.pdfAttachmentSet?"\u2713 Set":"Set"," "),e.R7$(2),e.SpI(" ",t.existingAttachment?"Select a new file to upload or keep the current one":"Only PDF files allowed"," "),e.R7$(4),e.Y8G("disabled",!t.isStep2Complete())("title",t.isStep2Complete()?"":"Complete all fields first"),e.R7$(2),e.Y8G("ngIf",!t.isStep2Complete())}}function X(n,d){if(1&n&&(e.j41(0,"div",41)(1,"h4",42),e.EFF(2,"\u2713 PDF Attachment Set"),e.k0s(),e.j41(3,"p",52),e.EFF(4),e.k0s()()),2&n){const t=e.XpG(3);e.R7$(4),e.JRh((null==t.existingAttachment?null:t.existingAttachment.name)||(null==t.selectedPdfFile?null:t.selectedPdfFile.name))}}function N(n,d){1&n&&(e.j41(0,"div",53),e.nrm(1,"div",54),e.k0s())}function Y(n,d){if(1&n&&(e.j41(0,"div",55)(1,"p",56),e.EFF(2),e.k0s()()),2&n){const t=e.XpG(3);e.R7$(2),e.JRh(t.tenderError)}}function V(n,d){if(1&n&&(e.j41(0,"p",70),e.EFF(1),e.k0s()),2&n){const t=e.XpG().$implicit;e.R7$(),e.SpI(" ",null==t.provider.externalReference||null==t.provider.externalReference[0]?null:t.provider.externalReference[0].name," ")}}function O(n,d){if(1&n){const t=e.RV6();e.j41(0,"div",64)(1,"div",65)(2,"p",66),e.EFF(3),e.k0s(),e.DNE(4,V,2,1,"p",67),e.k0s(),e.j41(5,"button",68),e.bIt("click",function(){const o=e.eBV(t).$implicit,i=e.XpG(5);return e.Njj(i.removeInvitedProvider(o.quoteId,o.provider.id))}),e.qSk(),e.j41(6,"svg",69),e.nrm(7,"path",7),e.k0s()()()}if(2&n){const t=d.$implicit;e.R7$(3),e.SpI(" ",t.provider.tradingName||"Unnamed Provider"," "),e.R7$(),e.Y8G("ngIf",null==t.provider.externalReference||null==t.provider.externalReference[0]?null:t.provider.externalReference[0].name)}}function z(n,d){if(1&n&&(e.j41(0,"div",9)(1,"label",58),e.EFF(2),e.k0s(),e.j41(3,"div",62),e.DNE(4,O,8,2,"div",63),e.k0s()()),2&n){const t=e.XpG(4);e.R7$(2),e.SpI(" Already Invited Providers (",t.invitedProviders.length,") "),e.R7$(2),e.Y8G("ngForOf",t.invitedProviders)}}function H(n,d){if(1&n){const t=e.RV6();e.j41(0,"input",74),e.bIt("change",function(){e.eBV(t);const o=e.XpG().$implicit,i=e.XpG(4);return e.Njj(i.toggleProviderSelection(o.id))}),e.k0s()}if(2&n){const t=e.XpG().$implicit,r=e.XpG(4);e.Y8G("id","provider-"+t.id)("checked",r.selectedProviders.has(t.id))}}function J(n,d){if(1&n&&(e.j41(0,"p",70),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2).$implicit;e.R7$(),e.SpI(" ",null==t.externalReference||null==t.externalReference[0]?null:t.externalReference[0].name," ")}}function W(n,d){if(1&n&&(e.j41(0,"label",75)(1,"div")(2,"p",66),e.EFF(3),e.k0s(),e.DNE(4,J,2,1,"p",67),e.k0s()()),2&n){const t=e.XpG().$implicit;e.Y8G("for","provider-"+t.id),e.R7$(3),e.SpI(" ",t.tradingName||"Unnamed Provider"," "),e.R7$(),e.Y8G("ngIf",null==t.externalReference||null==t.externalReference[0]?null:t.externalReference[0].name)}}function Z(n,d){if(1&n&&(e.j41(0,"div",71),e.DNE(1,H,1,2,"input",72)(2,W,5,3,"label",73),e.k0s()),2&n){const t=d.$implicit;e.R7$(),e.Y8G("ngIf",t.id),e.R7$(),e.Y8G("ngIf",t.id)}}function K(n,d){1&n&&(e.j41(0,"div",76)(1,"p",77),e.EFF(2,"No more providers available. All providers have been invited."),e.k0s()())}function ee(n,d){if(1&n&&(e.j41(0,"div"),e.DNE(1,z,5,2,"div",57),e.j41(2,"div",9)(3,"label",58),e.EFF(4," Select Providers to Invite "),e.k0s(),e.j41(5,"div",59),e.DNE(6,Z,3,2,"div",60)(7,K,3,0,"div",61),e.k0s(),e.j41(8,"p",12),e.EFF(9),e.k0s()()()),2&n){const t=e.XpG(3);e.R7$(),e.Y8G("ngIf",t.invitedProviders.length>0),e.R7$(5),e.Y8G("ngForOf",t.getAvailableProviders()),e.R7$(),e.Y8G("ngIf",0===t.getAvailableProviders().length),e.R7$(2),e.SpI(" ",t.selectedProviders.size," provider(s) selected ")}}function te(n,d){1&n&&(e.j41(0,"span",40),e.EFF(1," Please select at least one provider "),e.k0s())}function re(n,d){1&n&&(e.j41(0,"span",40),e.EFF(1," Please invite at least one provider first "),e.k0s())}function oe(n,d){if(1&n){const t=e.RV6();e.j41(0,"div")(1,"div",16)(2,"label",17),e.EFF(3,"Tender Title"),e.k0s(),e.j41(4,"p",18),e.EFF(5),e.k0s()(),e.j41(6,"div",41)(7,"h4",42),e.EFF(8,"\u2713 Dates Set"),e.k0s(),e.j41(9,"div",43)(10,"div")(11,"span",44),e.EFF(12,"Effective:"),e.k0s(),e.j41(13,"span",45),e.EFF(14),e.k0s()(),e.j41(15,"div")(16,"span",44),e.EFF(17,"Expected Fulfillment:"),e.k0s(),e.j41(18,"span",45),e.EFF(19),e.k0s()()()(),e.DNE(20,X,5,1,"div",46)(21,N,2,0,"div",47)(22,Y,3,1,"div",48)(23,ee,10,4,"div",8),e.j41(24,"div",49)(25,"button",14),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.backToStep2())}),e.EFF(26," \u2190 Back "),e.k0s(),e.j41(27,"div",50)(28,"button",14),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.closeTenderModal())}),e.EFF(29," Cancel "),e.k0s(),e.j41(30,"button",29),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.saveProvidersList())}),e.EFF(31),e.DNE(32,te,2,0,"span",30),e.k0s(),e.j41(33,"button",51),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.finalizeTender())}),e.EFF(34," Submit Tender "),e.DNE(35,re,2,0,"span",30),e.k0s()()()()}if(2&n){const t=e.XpG(2);e.R7$(5),e.JRh(t.tenderTitle),e.R7$(9),e.JRh(t.formatDateForDisplay(t.expectedCompletionDate)),e.R7$(5),e.JRh(t.formatDateForDisplay(t.requestedCompletionDate)),e.R7$(),e.Y8G("ngIf",t.existingAttachment||t.pdfAttachmentSet),e.R7$(),e.Y8G("ngIf",t.tenderLoading),e.R7$(),e.Y8G("ngIf",t.tenderError),e.R7$(),e.Y8G("ngIf",!t.tenderLoading&&!t.tenderError),e.R7$(7),e.Y8G("disabled",0===t.selectedProviders.size||t.tenderLoading)("title",0===t.selectedProviders.size?"Please select at least one provider":""),e.R7$(),e.SpI(" ",t.tenderLoading?"Inviting...":"Save Providers List"," "),e.R7$(),e.Y8G("ngIf",0===t.selectedProviders.size),e.R7$(),e.Y8G("disabled",0===t.invitedProviders.length||t.tenderLoading)("title",0===t.invitedProviders.length?"Please invite at least one provider first":""),e.R7$(2),e.Y8G("ngIf",0===t.invitedProviders.length)}}function ne(n,d){if(1&n){const t=e.RV6();e.j41(0,"div",1),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.closeTenderModal())}),e.j41(1,"div",2),e.bIt("click",function(o){return e.eBV(t),e.Njj(o.stopPropagation())}),e.j41(2,"div",3)(3,"h3",4),e.EFF(4),e.k0s(),e.j41(5,"button",5),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.closeTenderModal())}),e.qSk(),e.j41(6,"svg",6),e.nrm(7,"path",7),e.k0s()()(),e.DNE(8,Q,12,3,"div",8)(9,U,40,14,"div",8)(10,oe,36,14,"div",8),e.k0s()()}if(2&n){const t=e.XpG();e.R7$(4),e.JRh(t.editingTenderId?"Edit Tender":"Create New Tender"),e.R7$(4),e.Y8G("ngIf",1===t.tenderCreationStep),e.R7$(),e.Y8G("ngIf",2===t.tenderCreationStep),e.R7$(),e.Y8G("ngIf",3===t.tenderCreationStep)}}let ie=(()=>{class n{constructor(){this.isOpen=!1,this.customerId="",this.tenderToEdit=null,this.closeModal=new e.bkB,this.tenderCreated=new e.bkB,this.tenderUpdated=new e.bkB,this.quoteService=(0,e.WQX)(I.K),this.notificationService=(0,e.WQX)(w.J),this.localStorage=(0,e.WQX)(C.s),this.providerService=(0,e.WQX)(q),this.router=(0,e.WQX)(v.Ix),this.tenderProviders=[],this.selectedProviders=new Set,this.invitedProviders=[],this.tenderLoading=!1,this.tenderError=null,this.currentUserId=null,this.tenderTitle="",this.expectedCompletionDate="",this.requestedCompletionDate="",this.expectedDateSet=!1,this.requestedDateSet=!1,this.selectedPdfFile=null,this.pdfAttachmentSet=!1,this.editingTenderId=null,this.existingAttachment=null,this.createdQuoteId=null,this.tenderCreationStep=1}ngOnInit(){if(this.customerId)this.currentUserId=this.customerId;else{const t=this.localStorage.getObject("login_items");if(t&&t.logged_as==t.id)this.currentUserId=t.partyId;else if(t&&t.logged_as){const r=t.organizations.find(o=>o.id==t.logged_as);this.currentUserId=r?.partyId}}}ngOnChanges(t){t.tenderToEdit&&this.tenderToEdit&&this.loadTenderForEdit(this.tenderToEdit),t.isOpen&&this.isOpen&&this.tenderToEdit&&this.loadTenderForEdit(this.tenderToEdit)}loadTenderForEdit(t){this.editingTenderId=t.id||null,this.createdQuoteId=t.id||null,this.tenderTitle=t.tenderNote||"",t.expectedFulfillmentStartDate&&(this.requestedCompletionDate=this.formatDateForInput(t.expectedFulfillmentStartDate),this.requestedDateSet=!0),t.effectiveQuoteCompletionDate&&(this.expectedCompletionDate=this.formatDateForInput(t.effectiveQuoteCompletionDate),this.expectedDateSet=!0),t.attachment&&(this.existingAttachment=t.attachment,this.pdfAttachmentSet=!0),this.tenderCreationStep=2}formatDateForInput(t){try{const r=new Date(t),o=r.getFullYear();return`${o}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`}catch(r){return console.error("Error formatting date:",r),""}}closeTenderModal(){this.isOpen=!1,this.tenderCreationStep=1,this.selectedProviders.clear(),this.invitedProviders=[],this.tenderProviders=[],this.tenderError=null,this.editingTenderId=null,this.resetTenderForm(),this.closeModal.emit()}resetTenderForm(){this.tenderTitle="",this.expectedCompletionDate="",this.requestedCompletionDate="",this.expectedDateSet=!1,this.requestedDateSet=!1,this.existingAttachment=null,this.createdQuoteId=null,this.selectedPdfFile=null,this.pdfAttachmentSet=!1,this.invitedProviders=[]}saveInitialTender(){this.tenderTitle.trim()?this.currentUserId?(this.tenderLoading=!0,this.quoteService.createCoordinatorQuote(this.currentUserId,this.tenderTitle.trim()).subscribe({next:t=>{console.log("Coordinator tender created:",t),this.createdQuoteId=t.id||null,this.editingTenderId=t.id||null,this.notificationService.showSuccess("Tender created! Now set the completion dates."),this.tenderLoading=!1,this.tenderCreationStep=2},error:t=>{console.error("Error creating tender:",t),this.notificationService.showError("Failed to create tender: "+(t.message||"Unknown error")),this.tenderLoading=!1}})):this.notificationService.showError("User not logged in"):this.notificationService.showError("Tender title is required")}formatDateForAPI(t){if(!t)return"";const[r,o,i]=t.split("-");return`${i}-${o}-${r}`}setExpectedDate(){if(!this.expectedCompletionDate||!this.createdQuoteId)return void this.notificationService.showError("Please select a date");this.tenderLoading=!0;const t=this.formatDateForAPI(this.expectedCompletionDate);this.quoteService.updateQuoteDate(this.createdQuoteId,t,"effective").subscribe({next:r=>{this.expectedDateSet=!0,this.notificationService.showSuccess("Effective completion date set successfully!"),this.tenderLoading=!1,this.tenderUpdated.emit()},error:r=>{console.error("Error setting effective date:",r),this.notificationService.showError("Failed to set effective date: "+(r.message||"Unknown error")),this.tenderLoading=!1}})}setRequestedDate(){if(!this.requestedCompletionDate||!this.createdQuoteId)return void this.notificationService.showError("Please select a date");this.tenderLoading=!0;const t=this.formatDateForAPI(this.requestedCompletionDate);this.quoteService.updateQuoteDate(this.createdQuoteId,t,"expectedFulfillment").subscribe({next:r=>{this.requestedDateSet=!0,this.notificationService.showSuccess("Expected fulfillment start date set successfully!"),this.tenderLoading=!1,this.tenderUpdated.emit()},error:r=>{console.error("Error setting expected fulfillment date:",r),this.notificationService.showError("Failed to set expected fulfillment date: "+(r.message||"Unknown error")),this.tenderLoading=!1}})}onPdfFileSelected(t){const r=t.target,o=r.files?.[0];if(o){if("application/pdf"!==o.type)return this.notificationService.showError("Please select a valid PDF file"),this.selectedPdfFile=null,void(r.value="");this.selectedPdfFile=o,console.log("PDF file selected:",o.name)}else this.selectedPdfFile=null}setPdfAttachment(){this.selectedPdfFile&&this.createdQuoteId?(this.tenderLoading=!0,this.quoteService.addAttachmentToQuote(this.createdQuoteId,this.selectedPdfFile,"").subscribe({next:t=>{if(this.pdfAttachmentSet=!0,t.quoteItem&&t.quoteItem.length>0){const o=t.quoteItem[0];if(o.attachment&&o.attachment.length>0){const i=o.attachment[0];this.existingAttachment={name:i.name||"attachment.pdf",mimeType:i.mimeType||"application/pdf",content:i.content||"",size:i.size?.amount}}}this.selectedPdfFile=null;const r=document.getElementById("pdfFile");r&&(r.value=""),this.notificationService.showSuccess("PDF attachment uploaded successfully!"),this.tenderLoading=!1},error:t=>{console.error("Error uploading PDF:",t),this.notificationService.showError("Failed to upload PDF: "+(t.message||"Unknown error")),this.tenderLoading=!1}})):this.notificationService.showError("Please select a PDF file")}isStep2Complete(){return this.expectedDateSet&&this.requestedDateSet&&this.pdfAttachmentSet}proceedToProviderSelection(){this.isStep2Complete()?(this.tenderCreationStep=3,this.loadTenderProviders()):this.notificationService.showError("Please complete all date and PDF fields first")}loadTenderProviders(){this.tenderLoading=!0,this.tenderError=null,console.log("Loading providers from API..."),this.providerService.getProvidersForTender().subscribe({next:t=>{console.log("Providers loaded successfully:",t.length),this.tenderProviders=t,this.tenderLoading=!1,3===this.tenderCreationStep&&this.loadInvitedProviders()},error:t=>{console.error("Error loading providers:",t),this.tenderError="Failed to load providers. Please try again.",this.tenderProviders=[],this.tenderLoading=!1}})}toggleProviderSelection(t){this.selectedProviders.has(t)?this.selectedProviders.delete(t):this.selectedProviders.add(t)}loadInvitedProviders(){this.createdQuoteId&&this.currentUserId?(console.log("Loading invited providers for externalId:",this.createdQuoteId),this.tenderLoading=!0,this.quoteService.getTenderingQuotesByUser(this.currentUserId,p.XZ.BUYER).subscribe({next:t=>{console.log("Received tenders:",t),this.invitedProviders=[],t.filter(o=>o.external_id===this.createdQuoteId).forEach(o=>{const i={id:o.provider||void 0,tradingName:o.provider||"Unknown Provider"};o.id&&(this.invitedProviders.push({provider:i,quoteId:o.id}),console.log("Added invited provider:",i.tradingName,"with quote ID:",o.id))}),console.log("Total invited providers loaded:",this.invitedProviders.length),this.tenderLoading=!1},error:t=>{console.error("Error loading invited providers:",t),this.tenderLoading=!1}})):console.log("No coordinator quote ID or user ID, skipping invited providers load")}backToStep2(){this.tenderCreationStep=2}formatDateForDisplay(t){if(!t)return"";const r=t.split("-");if(3===r.length){const[o,i,s]=r;return`${s}/${i}/${o}`}return t}getAvailableProviders(){const t=new Set(this.invitedProviders.map(r=>r.provider.id));return this.tenderProviders.filter(r=>r.id&&!t.has(r.id))}saveProvidersList(){if(0===this.selectedProviders.size)return void this.notificationService.showError("Please select at least one provider");if(!this.createdQuoteId||!this.currentUserId)return void this.notificationService.showError("Coordinator quote not found. Please start over.");this.tenderLoading=!0;const t=Array.from(this.selectedProviders),r=this.tenderTitle;console.log("Creating tendering quotes for providers:",t),this.quoteService.createMultipleTenderingQuotes(this.currentUserId,t,this.createdQuoteId,r).subscribe({next:o=>{console.log("Tendering quotes created:",o),o.forEach((i,s)=>{if(i.id){const a=this.tenderProviders.find(g=>g.id===t[s]);a&&this.invitedProviders.push({provider:a,quoteId:i.id})}}),this.selectedProviders.clear(),this.notificationService.showSuccess(`${t.length} provider(s) invited successfully!`),this.tenderLoading=!1},error:o=>{console.error("Error creating tendering quotes:",o),this.notificationService.showError("Failed to invite providers: "+(o.message||"Unknown error")),this.tenderLoading=!1}})}removeInvitedProvider(t,r){r&&confirm("Are you sure you want to remove this provider invitation? This will delete the quote.")&&(this.tenderLoading=!0,this.quoteService.deleteQuote(t).subscribe({next:()=>{console.log("Quote deleted for provider:",r),this.invitedProviders=this.invitedProviders.filter(o=>o.quoteId!==t),this.notificationService.showSuccess("Provider invitation removed successfully"),this.tenderLoading=!1},error:o=>{console.error("Error deleting quote:",o),this.notificationService.showError("Failed to remove provider invitation: "+(o.message||"Unknown error")),this.tenderLoading=!1}}))}finalizeTender(){0!==this.invitedProviders.length?this.createdQuoteId?confirm("Are you sure you want to finalize the tender?")&&(this.tenderLoading=!0,this.quoteService.getQuoteById(this.createdQuoteId).pipe((0,F.n)(t=>{console.log("Coordinator quote retrieved:",t);const r=this.formatDateForAPI(this.expectedCompletionDate),o=this.formatDateForAPI(this.requestedCompletionDate);console.log(`Copying dates to ${this.invitedProviders.length} provider quotes`);const i=this.invitedProviders.flatMap(s=>{const a=s.quoteId;return[this.quoteService.updateQuoteDate(a,r,"expected"),this.quoteService.updateQuoteDate(a,o,"requested")]});return 0===i.length?(0,x.of)([]):(0,b.p)(i)}),(0,F.n)(t=>(console.log(`Successfully updated dates for ${t.length/2} provider quotes`),this.quoteService.updateQuoteStatus(this.createdQuoteId,"inProgress")))).subscribe({next:t=>{console.log("Coordinator quote status updated to inProgress:",t),this.notificationService.showSuccess("Dates copied to all provider quotes and notifications sent to providers"),this.tenderLoading=!1,this.closeTenderModal(),this.tenderCreated.emit(t)},error:t=>{console.error("Error finalizing tender:",t),this.notificationService.showError("Failed to finalize tender: "+(t.message||"Unknown error")),this.tenderLoading=!1}})):this.notificationService.showError("Coordinator quote not found"):this.notificationService.showError("Please invite at least one provider first")}static#e=this.\u0275fac=function(r){return new(r||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-create-tender-modal"]],inputs:{isOpen:"isOpen",customerId:"customerId",tenderToEdit:"tenderToEdit"},outputs:{closeModal:"closeModal",tenderCreated:"tenderCreated",tenderUpdated:"tenderUpdated"},standalone:!0,features:[e.OA$,e.aNF],decls:1,vars:1,consts:[["class","fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",3,"click",4,"ngIf"],[1,"fixed","inset-0","bg-gray-600","bg-opacity-50","overflow-y-auto","h-full","w-full","z-50",3,"click"],[1,"relative","top-10","mx-auto","p-5","border","w-11/12","md:w-3/4","lg:w-2/3","shadow-lg","rounded-md","bg-white","dark:bg-gray-800",3,"click"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-lg","font-bold","text-gray-900","dark:text-white"],[1,"text-gray-400","hover:text-gray-600","dark:hover:text-gray-300",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[4,"ngIf"],[1,"mb-6"],["for","tenderTitle",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-200","mb-2"],["type","text","id","tenderTitle","placeholder","Enter tender title or description...","autofocus","",1,"w-full","px-4","py-3","border","border-gray-300","dark:border-gray-600","dark:bg-gray-700","dark:text-white","rounded-lg","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-indigo-500","focus:border-transparent",3,"ngModelChange","ngModel"],[1,"mt-2","text-sm","text-gray-500","dark:text-gray-400"],[1,"flex","justify-end","space-x-3","mt-6","pt-4","border-t","border-gray-200","dark:border-gray-700"],[1,"bg-gray-100","dark:bg-gray-700","text-gray-700","dark:text-gray-200","px-4","py-2","rounded","hover:bg-gray-200","dark:hover:bg-gray-600",3,"click"],[1,"bg-indigo-600","text-white","px-4","py-2","rounded","hover:bg-indigo-700","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"mb-6","p-4","bg-gray-50","dark:bg-gray-700","rounded-lg","border","border-gray-200","dark:border-gray-600"],[1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-200","mb-2"],[1,"text-gray-900","dark:text-white","font-medium"],["for","requestedDate",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-200","mb-2"],[1,"flex","items-center","space-x-3"],["type","date","id","requestedDate",1,"flex-1","px-4","py-2","border","border-gray-300","dark:border-gray-600","dark:bg-gray-700","dark:text-white","rounded-lg","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-indigo-500","focus:border-transparent",3,"ngModelChange","ngModel"],[1,"px-4","py-2","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","disabled:opacity-50","disabled:cursor-not-allowed","font-medium","min-w-[80px]",3,"click","disabled"],[1,"mt-1","text-xs","text-gray-500","dark:text-gray-400"],["for","expectedDate",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-200","mb-2"],["type","date","id","expectedDate",1,"flex-1","px-4","py-2","border","border-gray-300","dark:border-gray-600","dark:bg-gray-700","dark:text-white","rounded-lg","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-indigo-500","focus:border-transparent",3,"ngModelChange","ngModel"],["for","pdfFile",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-200","mb-2"],["class","mb-3 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg",4,"ngIf"],["type","file","id","pdfFile","accept",".pdf",1,"flex-1","px-4","py-2","border","border-gray-300","dark:border-gray-600","dark:bg-gray-700","dark:text-white","rounded-lg","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-indigo-500","focus:border-transparent",3,"change"],[1,"bg-indigo-600","text-white","px-4","py-2","rounded","hover:bg-indigo-700","disabled:opacity-50","disabled:cursor-not-allowed","relative","group",3,"click","disabled","title"],["class","absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-1 bg-gray-900 text-white text-xs rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",4,"ngIf"],[1,"mb-3","p-3","bg-blue-50","dark:bg-blue-900/20","border","border-blue-200","dark:border-blue-700","rounded-lg"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","space-x-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-blue-600","dark:text-blue-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"text-sm","font-medium","text-blue-900","dark:text-blue-100"],[1,"text-sm","text-blue-700","dark:text-blue-300"],[1,"text-xs","font-medium","text-blue-600","dark:text-blue-400","bg-blue-100","dark:bg-blue-900","px-2","py-1","rounded"],[1,"text-xs","text-blue-600","dark:text-blue-400","mt-2"],[1,"absolute","bottom-full","left-1/2","transform","-translate-x-1/2","mb-2","px-3","py-1","bg-gray-900","text-white","text-xs","rounded","whitespace-nowrap","opacity-0","group-hover:opacity-100","transition-opacity","pointer-events-none"],[1,"mb-6","p-4","bg-green-50","dark:bg-green-900/20","rounded-lg","border","border-green-200","dark:border-green-700"],[1,"text-sm","font-medium","text-green-900","dark:text-green-100","mb-2"],[1,"grid","grid-cols-2","gap-4","text-sm"],[1,"text-green-700","dark:text-green-300"],[1,"ml-2","font-medium","text-green-900","dark:text-green-100"],["class","mb-6 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-700",4,"ngIf"],["class","flex justify-center py-8",4,"ngIf"],["class","bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-md p-4 mb-4",4,"ngIf"],[1,"flex","justify-between","space-x-3","mt-6","pt-4","border-t","border-gray-200","dark:border-gray-700"],[1,"flex","space-x-3"],[1,"bg-green-600","text-white","px-4","py-2","rounded","hover:bg-green-700","disabled:opacity-50","disabled:cursor-not-allowed","relative","group",3,"click","disabled","title"],[1,"text-sm","text-green-700","dark:text-green-300"],[1,"flex","justify-center","py-8"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-indigo-600"],[1,"bg-red-50","dark:bg-red-900/20","border","border-red-200","dark:border-red-700","rounded-md","p-4","mb-4"],[1,"text-sm","text-red-700","dark:text-red-300"],["class","mb-6",4,"ngIf"],[1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-200","mb-3"],[1,"max-h-96","overflow-y-auto","border","border-gray-300","dark:border-gray-600","rounded-lg"],["class","flex items-center p-4 hover:bg-gray-50 dark:hover:bg-gray-700 border-b border-gray-200 dark:border-gray-600 last:border-b-0",4,"ngFor","ngForOf"],["class","p-8 text-center text-gray-500 dark:text-gray-400",4,"ngIf"],[1,"max-h-64","overflow-y-auto","border","border-green-300","dark:border-green-700","rounded-lg","bg-green-50","dark:bg-green-900/20"],["class","flex items-center justify-between p-4 hover:bg-green-100 dark:hover:bg-green-900/30 border-b border-green-200 dark:border-green-700 last:border-b-0",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","p-4","hover:bg-green-100","dark:hover:bg-green-900/30","border-b","border-green-200","dark:border-green-700","last:border-b-0"],[1,"flex-1"],[1,"text-sm","font-medium","text-gray-900","dark:text-white"],["class","text-xs text-gray-500 dark:text-gray-400 mt-1",4,"ngIf"],["title","Remove invitation",1,"ml-4","p-2","text-red-600","hover:text-red-800","hover:bg-red-100","dark:hover:bg-red-900/30","rounded-full","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],[1,"text-xs","text-gray-500","dark:text-gray-400","mt-1"],[1,"flex","items-center","p-4","hover:bg-gray-50","dark:hover:bg-gray-700","border-b","border-gray-200","dark:border-gray-600","last:border-b-0"],["type","checkbox","class","h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded",3,"id","checked","change",4,"ngIf"],["class","ml-3 flex-1 cursor-pointer",3,"for",4,"ngIf"],["type","checkbox",1,"h-4","w-4","text-indigo-600","focus:ring-indigo-500","border-gray-300","rounded",3,"change","id","checked"],[1,"ml-3","flex-1","cursor-pointer",3,"for"],[1,"p-8","text-center","text-gray-500","dark:text-gray-400"],[1,"text-sm"]],template:function(r,o){1&r&&e.DNE(0,ne,11,4,"div",0),2&r&&e.Y8G("ngIf",o.isOpen)},dependencies:[h.MD,h.Sq,h.bT,u.YN,u.me,u.BC,u.vS],encapsulation:2})}return n})();function se(n,d){if(1&n){const t=e.RV6();e.j41(0,"button",32),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.openCreateTenderModal())}),e.qSk(),e.j41(1,"svg",33),e.nrm(2,"path",34),e.k0s(),e.EFF(3," Create Tender "),e.k0s()}}function de(n,d){1&n&&(e.j41(0,"div",35),e.nrm(1,"div",36),e.k0s())}function ae(n,d){if(1&n&&(e.j41(0,"div",37)(1,"div",38)(2,"div",39),e.qSk(),e.j41(3,"svg",40),e.nrm(4,"path",41),e.k0s()(),e.joV(),e.j41(5,"div",42)(6,"h3",43),e.EFF(7,"Error loading quotes"),e.k0s(),e.j41(8,"p",44),e.EFF(9),e.k0s()()()()),2&n){const t=e.XpG();e.R7$(9),e.JRh(t.error)}}function ce(n,d){1&n&&(e.j41(0,"div",49),e.qSk(),e.j41(1,"svg",50),e.nrm(2,"path",51),e.k0s(),e.joV(),e.j41(3,"h3",52),e.EFF(4,"No quotes found"),e.k0s(),e.j41(5,"p",53),e.EFF(6,"No orders found"),e.k0s()())}function le(n,d){1&n&&(e.j41(0,"div",56),e.EFF(1,"REQUEST"),e.k0s())}function ue(n,d){if(1&n&&(e.j41(0,"div",54)(1,"div",55)(2,"div",56),e.EFF(3,"DETAILS"),e.k0s(),e.j41(4,"div",57),e.EFF(5,"TITLE"),e.k0s(),e.j41(6,"div",58),e.EFF(7,"STATUS"),e.k0s(),e.j41(8,"div",58),e.EFF(9,"TENDER START DATE"),e.k0s(),e.j41(10,"div",58),e.EFF(11,"TENDER END DATE"),e.k0s(),e.j41(12,"div",58),e.EFF(13,"ATTACHMENTS"),e.k0s(),e.DNE(14,le,2,0,"div",59),e.j41(15,"div"),e.EFF(16,"ACTIONS"),e.k0s()()()),2&n){const t=e.XpG(2);e.R7$(14),e.Y8G("ngIf",t.selectedRole===t.UI_ROLES.SELLER),e.R7$(),e.AVh("col-span-3",t.selectedRole===t.UI_ROLES.BUYER)("col-span-2",t.selectedRole===t.UI_ROLES.SELLER)}}function pe(n,d){if(1&n){const t=e.RV6();e.j41(0,"button",83),e.bIt("click",function(){e.eBV(t);const o=e.XpG().$implicit,i=e.XpG(2);return e.Njj(i.toggleExpand(o))}),e.qSk(),e.j41(1,"svg",84),e.nrm(2,"path",85),e.k0s()()}if(2&n){const t=e.XpG().$implicit,r=e.XpG(2);e.Y8G("title",r.isExpanded(t.id)?"Collapse related quotes":"Expand to view related quotes"),e.R7$(),e.AVh("rotate-180",r.isExpanded(t.id))}}function he(n,d){if(1&n){const t=e.RV6();e.j41(0,"button",92),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2).$implicit,i=e.XpG(2);return e.Njj(i.addAttachment(o))}),e.qSk(),e.j41(1,"svg",88),e.nrm(2,"path",93),e.k0s()()}if(2&n){const t=e.XpG(2).$implicit,r=e.XpG(2);e.Y8G("disabled",r.isActionDisabled(t,"addAttachment"))}}function ge(n,d){if(1&n){const t=e.RV6();e.j41(0,"div",86)(1,"button",87),e.bIt("click",function(){e.eBV(t);const o=e.XpG().$implicit,i=e.XpG(2);return e.Njj(i.downloadAttachment(o))}),e.qSk(),e.j41(2,"svg",88),e.nrm(3,"path",89),e.k0s(),e.joV(),e.j41(4,"span",90),e.EFF(5),e.k0s()(),e.DNE(6,he,3,1,"button",91),e.k0s()}if(2&n){const t=e.XpG().$implicit,r=e.XpG(2);e.R7$(),e.Y8G("disabled",r.isActionDisabled(t,"downloadAttachment")),e.R7$(4),e.JRh(r.getAttachmentName(t)),e.R7$(),e.Y8G("ngIf",r.selectedRole===r.UI_ROLES.SELLER&&("inProgress"===r.getPrimaryState(t)||"approved"===r.getPrimaryState(t))&&r.canAddAttachmentToTenderingQuote(t))}}function _e(n,d){if(1&n){const t=e.RV6();e.j41(0,"button",94),e.bIt("click",function(){e.eBV(t);const o=e.XpG().$implicit,i=e.XpG(2);return e.Njj(i.addAttachment(o))}),e.qSk(),e.j41(1,"svg",88),e.nrm(2,"path",34),e.k0s(),e.joV(),e.j41(3,"span",95),e.EFF(4,"Add file"),e.k0s()()}if(2&n){const t=e.XpG().$implicit,r=e.XpG(2);e.Y8G("disabled",r.isActionDisabled(t,"addAttachment"))}}function fe(n,d){if(1&n){const t=e.RV6();e.j41(0,"button",98),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2).$implicit,i=e.XpG(2);return e.Njj(i.downloadCustomerRequest(o))}),e.qSk(),e.j41(1,"svg",88),e.nrm(2,"path",99),e.k0s()()}}function me(n,d){if(1&n&&(e.j41(0,"div",96),e.DNE(1,fe,3,0,"button",97),e.k0s()),2&n){const t=e.XpG().$implicit;e.R7$(),e.Y8G("ngIf","tender"===t.category)}}function ve(n,d){if(1&n){const t=e.RV6();e.j41(0,"button",100),e.bIt("click",function(){e.eBV(t);const o=e.XpG().$implicit,i=e.XpG(2);return e.Njj(i.simulateStartTender(o))}),e.qSk(),e.j41(1,"svg",101),e.nrm(2,"path",102),e.k0s(),e.EFF(3," Start Tender "),e.k0s()}}function be(n,d){if(1&n){const t=e.RV6();e.j41(0,"button",103),e.bIt("click",function(){e.eBV(t);const o=e.XpG().$implicit,i=e.XpG(2);return e.Njj(i.simulateCloseTender(o))}),e.qSk(),e.j41(1,"svg",101),e.nrm(2,"path",104),e.k0s(),e.EFF(3," Close Tender "),e.k0s()}}function xe(n,d){if(1&n){const t=e.RV6();e.j41(0,"button",105),e.bIt("click",function(){e.eBV(t);const o=e.XpG().$implicit,i=e.XpG(2);return e.Njj(i.editTender(o))}),e.EFF(1," Edit "),e.k0s()}}function ke(n,d){if(1&n){const t=e.RV6();e.j41(0,"button",106),e.bIt("click",function(){e.eBV(t);const o=e.XpG().$implicit,i=e.XpG(2);return e.Njj(i.openChat(o))}),e.qSk(),e.j41(1,"svg",65),e.nrm(2,"path",107),e.k0s()()}if(2&n){const t=e.XpG().$implicit,r=e.XpG(2);e.HbH(r.getIconButtonClass(t,"chat","text-blue-500 hover:text-blue-700")),e.Y8G("disabled",r.isActionDisabled(t,"chat"))}}function ye(n,d){if(1&n){const t=e.RV6();e.j41(0,"button",108),e.bIt("click",function(){e.eBV(t);const o=e.XpG().$implicit,i=e.XpG(2);return e.Njj(i.openBroadcastModal(o))}),e.EFF(1," Broadcast Message "),e.k0s()}}function Te(n,d){if(1&n){const t=e.RV6();e.j41(0,"button",114),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2).$implicit,i=e.XpG(2);return e.Njj(i.acceptTenderingQuote(o))}),e.qSk(),e.j41(1,"svg",65),e.nrm(2,"path",104),e.k0s()()}if(2&n){const t=e.XpG(2).$implicit,r=e.XpG(2);e.HbH(r.getIconButtonClass(t,"accept","text-emerald-600 hover:text-emerald-700")),e.Y8G("disabled",r.isActionDisabled(t,"accept"))}}function Se(n,d){if(1&n){const t=e.RV6();e.j41(0,"button",115),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2).$implicit,i=e.XpG(2);return e.Njj(i.acceptQuoteCustomer(o))}),e.qSk(),e.j41(1,"svg",65),e.nrm(2,"path",104),e.k0s()()}if(2&n){const t=e.XpG(2).$implicit,r=e.XpG(2);e.HbH(r.getIconButtonClass(t,"acceptCustomer","text-emerald-600 hover:text-emerald-700")),e.Y8G("disabled",r.isActionDisabled(t,"acceptCustomer"))}}function Ie(n,d){if(1&n){const t=e.RV6();e.j41(0,"button",116),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2).$implicit,i=e.XpG(2);return e.Njj(i.acceptTenderQuote(o))}),e.qSk(),e.j41(1,"svg",65),e.nrm(2,"path",104),e.k0s()()}if(2&n){const t=e.XpG(2).$implicit,r=e.XpG(2);e.HbH(r.getIconButtonClass(t,"acceptTender","text-emerald-600 hover:text-emerald-700")),e.Y8G("disabled",r.isActionDisabled(t,"acceptTender"))}}function Ce(n,d){if(1&n){const t=e.RV6();e.j41(0,"button",117),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2).$implicit,i=e.XpG(2);return e.Njj(i.rejectTenderQuote(o))}),e.qSk(),e.j41(1,"svg",65),e.nrm(2,"path",118),e.k0s()()}if(2&n){const t=e.XpG(2).$implicit,r=e.XpG(2);e.HbH(r.getIconButtonClass(t,"rejectTender","text-red-500 hover:text-red-700")),e.Y8G("disabled",r.isActionDisabled(t,"rejectTender"))}}function we(n,d){if(1&n){const t=e.RV6();e.j41(0,"button",119),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2).$implicit,i=e.XpG(2);return e.Njj(i.cancelTenderingQuote(o))}),e.qSk(),e.j41(1,"svg",65),e.nrm(2,"path",118),e.k0s()()}if(2&n){const t=e.XpG(2).$implicit,r=e.XpG(2);e.HbH(r.getIconButtonClass(t,"cancel","text-red-500 hover:text-red-700")),e.Y8G("disabled",r.isActionDisabled(t,"cancel"))}}function je(n,d){if(1&n&&(e.qex(0),e.DNE(1,Te,3,3,"button",109)(2,Se,3,3,"button",110)(3,Ie,3,3,"button",111)(4,Ce,3,3,"button",112)(5,we,3,3,"button",113),e.bVm()),2&n){const t=e.XpG().$implicit,r=e.XpG(2);e.R7$(),e.Y8G("ngIf",r.selectedRole===r.UI_ROLES.SELLER&&"tender"===t.category&&"pending"===r.getPrimaryState(t)&&r.canAcceptTenderingQuote(t)),e.R7$(),e.Y8G("ngIf",r.selectedRole===r.UI_ROLES.BUYER&&"approved"===r.getPrimaryState(t)&&("tender"===t.category||"tailored"===t.category)),e.R7$(),e.Y8G("ngIf",r.selectedRole===r.UI_ROLES.BUYER&&"tender"===t.category&&"approved"===r.getPrimaryState(t)),e.R7$(),e.Y8G("ngIf",r.selectedRole===r.UI_ROLES.BUYER&&"tender"===t.category&&"approved"===r.getPrimaryState(t)),e.R7$(),e.Y8G("ngIf",r.selectedRole===r.UI_ROLES.SELLER&&"tender"===t.category&&"pending"===r.getPrimaryState(t))}}function Ee(n,d){if(1&n&&(e.qex(0),e.j41(1,"button",120),e.qSk(),e.j41(2,"svg",65),e.nrm(3,"path",121),e.k0s()(),e.bVm()),2&n){const t=e.XpG().$implicit,r=e.XpG(2);e.R7$(),e.Y8G("title","Quote is already "+(r.isQuoteCancelled(t)?"cancelled":"accepted")),e.R7$(2),e.BMQ("d",r.isQuoteCancelled(t)?"M6 18L18 6M6 6l12 12":"M5 13l4 4L19 7")}}function Fe(n,d){1&n&&(e.j41(0,"div",128),e.nrm(1,"div",129),e.j41(2,"span",130),e.EFF(3,"Loading related quotes..."),e.k0s()())}function Re(n,d){if(1&n){const t=e.RV6();e.j41(0,"button",144),e.bIt("click",function(){e.eBV(t);const o=e.XpG().$implicit,i=e.XpG(5);return e.Njj(i.downloadAttachment(o))}),e.qSk(),e.j41(1,"svg",88),e.nrm(2,"path",89),e.k0s(),e.joV(),e.j41(3,"span",145),e.EFF(4),e.k0s()()}if(2&n){const t=e.XpG().$implicit,r=e.XpG(5);e.R7$(4),e.JRh(r.getAttachmentName(t))}}function $e(n,d){if(1&n){const t=e.RV6();e.j41(0,"button",116),e.bIt("click",function(){e.eBV(t);const o=e.XpG().$implicit,i=e.XpG(5);return e.Njj(i.acceptTenderQuote(o))}),e.qSk(),e.j41(1,"svg",88),e.nrm(2,"path",104),e.k0s()()}if(2&n){const t=e.XpG().$implicit,r=e.XpG(5);e.HbH(r.getIconButtonClass(t,"acceptTender","text-emerald-600 hover:text-emerald-700")),e.Y8G("disabled",r.isActionDisabled(t,"acceptTender"))}}function Me(n,d){if(1&n){const t=e.RV6();e.j41(0,"button",117),e.bIt("click",function(){e.eBV(t);const o=e.XpG().$implicit,i=e.XpG(5);return e.Njj(i.rejectTenderQuote(o))}),e.qSk(),e.j41(1,"svg",88),e.nrm(2,"path",118),e.k0s()()}if(2&n){const t=e.XpG().$implicit,r=e.XpG(5);e.HbH(r.getIconButtonClass(t,"rejectTender","text-red-500 hover:text-red-700")),e.Y8G("disabled",r.isActionDisabled(t,"rejectTender"))}}function Ge(n,d){if(1&n){const t=e.RV6();e.j41(0,"div",136)(1,"div",137)(2,"div",56)(3,"button",138),e.bIt("click",function(){const o=e.eBV(t).$implicit,i=e.XpG(5);return e.Njj(i.viewDetails(o))}),e.qSk(),e.j41(4,"svg",88),e.nrm(5,"path",66)(6,"path",67),e.k0s()()(),e.joV(),e.j41(7,"div",139),e.EFF(8),e.k0s(),e.j41(9,"div",58)(10,"span",140),e.EFF(11),e.k0s()(),e.j41(12,"div",58),e.DNE(13,Re,5,1,"button",141),e.k0s(),e.j41(14,"div",142)(15,"button",143),e.bIt("click",function(){const o=e.eBV(t).$implicit,i=e.XpG(5);return e.Njj(i.openChat(o))}),e.qSk(),e.j41(16,"svg",88),e.nrm(17,"path",107),e.k0s()(),e.DNE(18,$e,3,3,"button",111)(19,Me,3,3,"button",112),e.k0s()()()}if(2&n){const t=d.$implicit,r=d.last,o=e.XpG(5);e.AVh("border-b",!r)("border-gray-200",!r),e.R7$(8),e.SpI(" ",o.getProviderName(t)," "),e.R7$(2),e.Y8G("ngClass",o.getStateClass(o.getQuoteItemState(t))),e.R7$(),e.SpI(" ",o.getQuoteItemState(t)," "),e.R7$(2),e.Y8G("ngIf",o.hasAttachment(t)),e.R7$(5),e.Y8G("ngIf",o.selectedRole===o.UI_ROLES.BUYER&&"tender"===t.category&&"approved"===o.getPrimaryState(t)),e.R7$(),e.Y8G("ngIf",o.selectedRole===o.UI_ROLES.BUYER&&"tender"===t.category&&"approved"===o.getPrimaryState(t))}}function De(n,d){if(1&n&&(e.j41(0,"div",131)(1,"div",132)(2,"div",133)(3,"div",56),e.EFF(4,"Details"),e.k0s(),e.j41(5,"div",57),e.EFF(6,"Provider"),e.k0s(),e.j41(7,"div",58),e.EFF(8,"Status"),e.k0s(),e.j41(9,"div",58),e.EFF(10,"Attachments"),e.k0s(),e.j41(11,"div",134),e.EFF(12,"Actions"),e.k0s()()(),e.DNE(13,Ge,20,10,"div",135),e.k0s()),2&n){const t=e.XpG(2).$implicit,r=e.XpG(2);e.R7$(13),e.Y8G("ngForOf",r.getRelatedQuotes(t.id))}}function Le(n,d){1&n&&(e.j41(0,"div",146),e.qSk(),e.j41(1,"svg",147),e.nrm(2,"path",51),e.k0s(),e.joV(),e.j41(3,"p"),e.EFF(4,"No related provider quotes found"),e.k0s()())}function Pe(n,d){if(1&n&&(e.j41(0,"div",122)(1,"div",123)(2,"h4",124),e.EFF(3,"Related Provider Quotes"),e.k0s(),e.DNE(4,Fe,4,0,"div",125)(5,De,14,1,"div",126)(6,Le,5,0,"div",127),e.k0s()()),2&n){const t=e.XpG().$implicit,r=e.XpG(2);e.R7$(4),e.Y8G("ngIf",r.isLoadingRelatedQuotes(t.id)),e.R7$(),e.Y8G("ngIf",!r.isLoadingRelatedQuotes(t.id)&&r.getRelatedQuotes(t.id).length>0),e.R7$(),e.Y8G("ngIf",!r.isLoadingRelatedQuotes(t.id)&&0===r.getRelatedQuotes(t.id).length)}}function qe(n,d){if(1&n){const t=e.RV6();e.j41(0,"div",60)(1,"div",61)(2,"div",62),e.DNE(3,pe,3,3,"button",63),e.j41(4,"button",64),e.bIt("click",function(){const o=e.eBV(t).$implicit,i=e.XpG(2);return e.Njj(i.viewDetails(o))}),e.qSk(),e.j41(5,"svg",65),e.nrm(6,"path",66)(7,"path",67),e.k0s()()(),e.joV(),e.j41(8,"div",68),e.EFF(9),e.k0s(),e.j41(10,"div",58)(11,"span",69),e.EFF(12),e.k0s()(),e.j41(13,"div",70),e.EFF(14),e.nI1(15,"date"),e.k0s(),e.j41(16,"div",70),e.EFF(17),e.nI1(18,"date"),e.k0s(),e.j41(19,"div",71),e.DNE(20,ge,7,3,"div",72)(21,_e,5,1,"button",73),e.k0s(),e.DNE(22,me,2,1,"div",74),e.j41(23,"div",75),e.DNE(24,ve,4,0,"button",76)(25,be,4,0,"button",77)(26,xe,2,0,"button",78)(27,ke,3,3,"button",79)(28,ye,2,0,"button",80)(29,je,6,5,"ng-container",81)(30,Ee,4,2,"ng-container",81),e.k0s()(),e.DNE(31,Pe,7,3,"div",82),e.k0s()}if(2&n){const t=d.$implicit,r=e.XpG(2);e.R7$(),e.AVh("bg-gray-50",r.isQuoteFinalized(t))("hover:bg-gray-50",!r.isQuoteFinalized(t)),e.BMQ("data-quote-id",t.id),e.R7$(2),e.Y8G("ngIf",r.isCoordinatorExpandable(t)),e.R7$(),e.HbH(r.getIconButtonClass(t,"viewDetails","text-gray-600 hover:text-gray-900")),e.Y8G("disabled",r.isActionDisabled(t,"viewDetails")),e.R7$(5),e.SpI(" ",t.description||"(no title)"," "),e.R7$(2),e.Y8G("ngClass",r.getStateClass(r.getQuoteItemState(t))),e.R7$(),e.SpI(" ",r.getQuoteItemState(t)," "),e.R7$(2),e.SpI(" ",e.i5U(15,29,t.expectedFulfillmentStartDate,"dd/MM/yyyy")," "),e.R7$(3),e.SpI(" ",e.i5U(18,32,t.effectiveQuoteCompletionDate,"dd/MM/yyyy")," "),e.R7$(3),e.Y8G("ngIf",r.hasAttachment(t)),e.R7$(),e.Y8G("ngIf",!r.hasAttachment(t)&&r.selectedRole===r.UI_ROLES.SELLER&&("inProgress"===r.getPrimaryState(t)||"approved"===r.getPrimaryState(t))&&r.canAddAttachmentToTenderingQuote(t)),e.R7$(),e.Y8G("ngIf",r.selectedRole===r.UI_ROLES.SELLER),e.R7$(),e.AVh("col-span-3",r.selectedRole===r.UI_ROLES.BUYER)("col-span-2",r.selectedRole===r.UI_ROLES.SELLER),e.R7$(),e.Y8G("ngIf","coordinator"===t.category&&"inProgress"===r.getPrimaryState(t)),e.R7$(),e.Y8G("ngIf","coordinator"===t.category&&"approved"===r.getPrimaryState(t)),e.R7$(),e.Y8G("ngIf","coordinator"===t.category&&!r.isCoordinatorExpandable(t)),e.R7$(),e.Y8G("ngIf","coordinator"!==t.category),e.R7$(),e.Y8G("ngIf","coordinator"===t.category&&r.isCoordinatorExpandable(t)),e.R7$(),e.Y8G("ngIf",!r.isQuoteFinalized(t)),e.R7$(),e.Y8G("ngIf","coordinator"!==t.category&&r.isQuoteFinalized(t)),e.R7$(),e.Y8G("ngIf",r.isExpanded(t.id))}}function Qe(n,d){if(1&n&&(e.j41(0,"div",45),e.DNE(1,ce,7,0,"div",46)(2,ue,17,5,"div",47)(3,qe,32,35,"div",48),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngIf",0===t.filteredQuotes.length),e.R7$(),e.Y8G("ngIf",t.filteredQuotes.length>0),e.R7$(),e.Y8G("ngForOf",t.filteredQuotes)}}function Ae(n,d){if(1&n){const t=e.RV6();e.j41(0,"div",157)(1,"input",158),e.mxI("ngModelChange",function(o){e.eBV(t);const i=e.XpG(2);return e.DH7(i.selectedState,o)||(i.selectedState=o),e.Njj(o)}),e.k0s(),e.j41(2,"label",159),e.EFF(3),e.k0s()()}if(2&n){const t=d.$implicit,r=e.XpG(2);e.R7$(),e.Y8G("id","state-"+t),e.R50("ngModel",r.selectedState),e.Y8G("value",t),e.R7$(),e.Y8G("for","state-"+t),e.R7$(),e.SpI(" ",r.getStateDisplay(t)," ")}}function Be(n,d){if(1&n){const t=e.RV6();e.j41(0,"div",148)(1,"div",149)(2,"div",150)(3,"h3",151),e.EFF(4,"Update Quote State"),e.k0s(),e.j41(5,"div",152),e.DNE(6,Ae,4,5,"div",153),e.k0s(),e.j41(7,"div",154)(8,"button",155),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.showStateUpdate=!1)}),e.EFF(9," Cancel "),e.k0s(),e.j41(10,"button",156),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.confirmStateUpdate())}),e.EFF(11," Update "),e.k0s()()()()()}if(2&n){const t=e.XpG();e.R7$(6),e.Y8G("ngForOf",t.availableStates),e.R7$(4),e.Y8G("disabled",!t.selectedState)}}function Ue(n,d){if(1&n){const t=e.RV6();e.j41(0,"div",148)(1,"div",149)(2,"div",160)(3,"h3",151),e.EFF(4,"Broadcast Message"),e.k0s(),e.j41(5,"textarea",161),e.mxI("ngModelChange",function(o){e.eBV(t);const i=e.XpG();return e.DH7(i.broadcastMessage,o)||(i.broadcastMessage=o),e.Njj(o)}),e.k0s(),e.j41(6,"div",162)(7,"button",155),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.closeBroadcastModal())}),e.EFF(8," Cancel "),e.k0s(),e.j41(9,"button",163),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.sendBroadcastMessage())}),e.EFF(10),e.k0s()()()()()}if(2&n){const t=e.XpG();e.R7$(5),e.R50("ngModel",t.broadcastMessage),e.R7$(4),e.Y8G("disabled",!t.broadcastMessage||t.isBroadcastSending),e.R7$(),e.SpI(" ",t.isBroadcastSending?"Sending...":"Send"," ")}}let $=(()=>{class n{constructor(){this.router=(0,e.WQX)(v.Ix),this.quoteService=(0,e.WQX)(I.K),this.localStorage=(0,e.WQX)(C.s),this.notificationService=(0,e.WQX)(w.J),this.quotes=[],this.filteredQuotes=[],this.loading=!1,this.error=null,this.showDeleteConfirm=!1,this.deleteConfirmMessage="",this.quoteToDelete=null,this.showStateUpdate=!1,this.quoteToUpdate=null,this.selectedState=null,this.availableStates=["pending","inProgress","approved","rejected","cancelled","accepted"],this.selectedRole=p.Zk.BUYER,this.currentUserId=null,this.UI_ROLES=p.Zk,this.statusFilter="",this.showQuoteDetailsModal=!1,this.selectedQuoteId=null,this.showChatModal=!1,this.selectedChatQuoteId=null,this.showAttachmentModal=!1,this.selectedAttachmentQuote=null,this.showBroadcastModal=!1,this.broadcastForCoordinatorId=null,this.broadcastMessage="",this.isBroadcastSending=!1,this.showCreateTenderModal=!1,this.tenderToEdit=null,this.expandedQuoteIds=new Set,this.relatedQuotesMap=new Map,this.loadingRelatedQuotes=new Set,this.coordinatorQuoteStatesMap=new Map,this.loadingCoordinatorStates=new Set}ngOnInit(){let t=this.localStorage.getObject("login_items");if(t&&t.logged_as==t.id)this.currentUserId=t.partyId;else if(t&&t.logged_as){let r=t.organizations.find(o=>o.id==t.logged_as);this.currentUserId=r?.partyId}this.currentUserId?this.loadQuotes():this.error="User not authenticated"}loadQuotes(){if(!this.currentUserId)return void(this.error="User not authenticated");let t;this.loading=!0,this.error=null,t=this.selectedRole===p.Zk.BUYER?this.quoteService.getCoordinatorQuotesByUser(this.currentUserId).pipe((0,m.T)(r=>r.map(o=>this.mapTenderToQuote(o)))):this.quoteService.getTenderingQuotesByUser(this.currentUserId,(0,p.E9)(this.selectedRole)).pipe((0,m.T)(r=>r.map(o=>this.mapTenderToQuote(o)))),t.subscribe({next:r=>{this.quotes=r,console.log(`Loaded ${this.quotes.length} quotes as ${this.selectedRole}`),console.log(`Current user ID: ${this.currentUserId}`),this.quotes.forEach(o=>{if(console.log(`Quote ${this.extractShortId(o.id)}:`,{category:o.category,state:o.state,quoteItemState:this.getQuoteItemState(o),externalId:o.externalId,id:o.id,relatedParty:o.relatedParty}),this.selectedRole===p.Zk.SELLER){const i=o.relatedParty?.some(s=>s.id===this.currentUserId&&s.role?.toLowerCase()===p.Zk.SELLER);console.log(`  -> Quote ${this.extractShortId(o.id)} related to current provider? ${i}`)}}),this.selectedRole===p.Zk.SELLER&&this.loadCoordinatorStatesForTenderingQuotes(),this.filterQuotesByStatus(),this.loading=!1},error:r=>{console.error("Failed to load quotes:",r),this.error="Failed to load quotes. Please try again.",this.loading=!1}})}mapTenderToQuote(t){const r={state:this.mapTenderStateToQuoteState(t.state)};return t.attachment&&(r.attachment=[{name:t.attachment.name,mimeType:t.attachment.mimeType,content:t.attachment.content,size:t.attachment.size?{amount:t.attachment.size,units:"bytes"}:void 0}]),{id:t.id,href:"",description:t.tenderNote||"",quoteDate:t.createdAt||(new Date).toISOString(),effectiveQuoteCompletionDate:t.effectiveQuoteCompletionDate,expectedFulfillmentStartDate:t.expectedFulfillmentStartDate,state:this.mapTenderStateToQuoteState(t.state),category:"tendering"===t.category?"tender":t.category,externalId:t.external_id,relatedParty:t.selectedProviders.map(o=>({id:o,role:"Seller",name:t.provider,"@referredType":"Organization"})),quoteItem:[r],note:[]}}mapTenderStateToQuoteState(t){switch(t){case"draft":case"pending":default:return"pending";case"pre-launched":return"inProgress";case"sent":return"approved";case"closed":return"accepted"}}refreshQuotes(){this.loadQuotes()}selectRole(t){this.selectedRole=t,this.loadQuotes()}getRoleTabClass(t){return this.selectedRole===t?"bg-white dark:bg-gray-600 text-indigo-600 dark:text-blue-400 shadow-sm":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-200"}filterQuotesByStatus(){this.filteredQuotes=this.statusFilter?this.quotes.filter(t=>this.getPrimaryState(t)===this.statusFilter):[...this.quotes]}viewDetails(t){this.selectedQuoteId=t.id,this.showQuoteDetailsModal=!0}editTender(t){let r;if(Array.isArray(t.quoteItem)&&t.quoteItem.length>0){const s=t.quoteItem[0];if(Array.isArray(s.attachment)&&s.attachment.length>0){const a=s.attachment[0];r={name:a.name||"attachment.pdf",mimeType:a.mimeType||"application/pdf",content:a.content||"",size:a.size?.amount}}}const o=this.getPrimaryState(t),i={id:t.id,category:"coordinator"===t.category?"coordinator":"tendering",state:this.mapQuoteStateToTenderState(o),responseDeadline:t.expectedFulfillmentStartDate||t.effectiveQuoteCompletionDate||(new Date).toISOString(),tenderNote:t.description||"",attachment:r,selectedProviders:t.relatedParty?.filter(s=>"seller"===s.role?.toLowerCase()).map(s=>s.id)||[],effectiveQuoteCompletionDate:t.effectiveQuoteCompletionDate,expectedFulfillmentStartDate:t.expectedFulfillmentStartDate};this.tenderToEdit=i,this.showCreateTenderModal=!0}mapQuoteStateToTenderState(t){if(!t)return"draft";switch(t){case"pending":default:return"draft";case"inProgress":return"pre-launched";case"approved":return"sent";case"accepted":case"cancelled":case"rejected":return"closed"}}viewQuote(t){this.selectedQuoteId=t.id,this.showQuoteDetailsModal=!0}closeQuoteDetailsModal(){this.showQuoteDetailsModal=!1,this.selectedQuoteId=null}closeChatModal(){this.showChatModal=!1,this.selectedChatQuoteId=null}closeAttachmentModal(){this.showAttachmentModal=!1,this.selectedAttachmentQuote=null}openBroadcastModal(t){t.id&&(this.broadcastForCoordinatorId=t.id,this.broadcastMessage="",this.showBroadcastModal=!0)}closeBroadcastModal(){this.showBroadcastModal=!1,this.broadcastForCoordinatorId=null,this.broadcastMessage="",this.isBroadcastSending=!1}openCreateTenderModal(){this.currentUserId?this.showCreateTenderModal=!0:this.notificationService.showError("You must be logged in to create a tender.")}closeCreateTenderModal(){this.showCreateTenderModal=!1,this.tenderToEdit=null}onTenderCreated(t){console.log("Tender created successfully:",t),this.loadQuotes(),this.notificationService.showSuccess("Tender created successfully!")}onTenderUpdated(){this.loadQuotes()}sendBroadcastMessage(){if(!(this.broadcastForCoordinatorId&&this.currentUserId&&this.broadcastMessage&&confirm("Are you sure you want to broadcast this message to all the invited providers?")))return;this.isBroadcastSending=!0;const r=this.getRelatedQuotes(this.broadcastForCoordinatorId);if(!r||0===r.length){const s=this.quotes.find(a=>a.id===this.broadcastForCoordinatorId);s&&this.loadRelatedQuotes(s)}const o=this.getRelatedQuotes(this.broadcastForCoordinatorId).filter(s=>"tender"===s.category);if(0===o.length)return this.notificationService.showError("No related provider quotes found to broadcast to."),void(this.isBroadcastSending=!1);const i=o.map(s=>this.quoteService.addNoteToQuote(s.id,this.broadcastMessage,this.currentUserId));(0,b.p)(i).subscribe({next:()=>{this.notificationService.showSuccess("Message broadcast sent to all invited providers."),this.closeBroadcastModal()},error:s=>{console.error("Failed to broadcast message:",s),this.notificationService.showError("Failed to broadcast message."),this.isBroadcastSending=!1}})}onAttachmentUploaded(t){const r=this.quotes.findIndex(o=>o.id===t.id);-1!==r&&(this.quotes[r]=t,this.filterQuotesByStatus()),this.selectedRole===p.Zk.SELLER&&"inProgress"===this.getPrimaryState(t)&&(console.log("Provider uploaded PDF, updating quote status to approved:",t.id),this.quoteService.updateQuoteStatus(t.id,"approved").subscribe({next:o=>{const i=this.quotes.findIndex(a=>a.id===o.id);-1!==i&&(this.quotes[i]=o,this.filterQuotesByStatus());const s=this.extractShortId(t.id);console.log("Quote status automatically updated to approved after PDF upload"),this.notificationService.showSuccess(`Quote ${s} has been approved after PDF upload.`)},error:o=>{console.error("Error updating quote status to approved:",o),this.notificationService.showError(`Error updating quote status: ${o?.message||"Unknown error"}`)}}))}updateQuoteState(t){this.quoteToUpdate=t,this.selectedState=t.state||null,this.showStateUpdate=!0}confirmStateUpdate(){this.quoteToUpdate&&this.selectedState&&this.quoteService.updateQuoteState(this.quoteToUpdate.id,this.selectedState).subscribe({next:t=>{const r=this.quotes.findIndex(o=>o.id===t.id);-1!==r&&(this.quotes[r]=t,this.filterQuotesByStatus()),this.showStateUpdate=!1,this.notificationService.showSuccess("Quote state updated successfully")},error:t=>{console.error("Failed to update quote state:",t),this.notificationService.showError("Failed to update quote state")}})}confirmDelete(t){this.quoteToDelete=t,this.deleteConfirmMessage=`Are you sure you want to delete Quote ${this.extractShortId(t.id)}? This action cannot be undone.`,this.showDeleteConfirm=!0}deleteQuote(){this.quoteToDelete&&this.quoteService.deleteQuote(this.quoteToDelete.id).subscribe({next:()=>{this.quotes=this.quotes.filter(t=>t.id!==this.quoteToDelete.id),this.filterQuotesByStatus(),this.showDeleteConfirm=!1,this.notificationService.showSuccess("Quote deleted successfully")},error:t=>{console.error("Failed to delete quote:",t),this.notificationService.showError("Failed to delete quote")}})}openChat(t){this.selectedChatQuoteId=t.id,this.showChatModal=!0}downloadAttachment(t){try{this.quoteService.downloadAttachment(t),this.notificationService.showSuccess("Download started")}catch(r){console.error("Error downloading attachment:",r),this.notificationService.showError(r.message||"Error downloading attachment")}}downloadCustomerRequest(t){const r=t.externalId||t.id;r?this.quoteService.getQuoteById(r).subscribe({next:o=>{try{if(!o.quoteItem||0===o.quoteItem.length||!o.quoteItem[0].attachment||0===o.quoteItem[0].attachment.length)return void this.notificationService.showError("No buyer's request attachment found on coordinator quote.");this.quoteService.downloadAttachment(o),this.notificationService.showSuccess("Download started")}catch(i){console.error("Error downloading buyer request:",i),this.notificationService.showError(i.message||"Error downloading buyer request")}},error:o=>{console.error("Failed to fetch coordinator quote for download:",o),this.notificationService.showError("Failed to fetch coordinator quote")}}):this.notificationService.showError("No coordinator reference found for this quote.")}addAttachment(t){this.selectedAttachmentQuote=t,this.showAttachmentModal=!0}acceptTenderingQuote(t){const r=this.extractShortId(t.id);confirm("Are you sure you want to accept this tender request?")&&(console.log("Accepting tendering quote:",t.id),this.quoteService.updateQuoteStatus(t.id,"inProgress").subscribe({next:i=>{const s=this.quotes.findIndex(a=>a.id===i.id);-1!==s&&(this.quotes[s]=i,this.filterQuotesByStatus()),console.log("Tendering quote successfully accepted"),this.notificationService.showSuccess(`Tender request ${r} has been accepted and is now in progress.`)},error:i=>{console.error("Error accepting tendering quote:",i),this.notificationService.showError(`Error accepting tender request: ${i.message||"Unknown error"}`)}}))}cancelTenderingQuote(t){const r=this.extractShortId(t.id);confirm("Are you sure you want to cancel this tender request?\n\nThis action cannot be undone.")&&(console.log("Cancelling tendering quote:",t.id),this.quoteService.updateQuoteStatus(t.id,"cancelled").subscribe({next:i=>{const s=this.quotes.findIndex(a=>a.id===i.id);-1!==s&&(this.quotes[s]=i,this.filterQuotesByStatus()),console.log("Tendering quote successfully cancelled"),this.notificationService.showSuccess(`Tender request ${r} has been cancelled.`)},error:i=>{console.error("Error cancelling tendering quote:",i),this.notificationService.showError(`Error cancelling tender request: ${i.message||"Unknown error"}`)}}))}simulateStartTender(t){const r=this.extractShortId(t.id);confirm('[TEST] Simulate starting the tender?\n\nThis will update the status from "pre-launched" to "launched".')&&(console.log("[TEST] Starting tender (updating to approved):",t.id),this.quoteService.updateQuoteStatus(t.id,"approved").subscribe({next:i=>{const s=this.quotes.findIndex(a=>a.id===i.id);-1!==s&&(this.quotes[s]=i,this.filterQuotesByStatus()),console.log("[TEST] Tender successfully started (status updated to approved/launched)"),this.notificationService.showSuccess(`Tender ${r} has been started successfully (status: launched).`)},error:i=>{console.error("[TEST] Error starting tender:",i),this.notificationService.showError(`Error starting tender: ${i.message||"Unknown error"}`)}}))}simulateCloseTender(t){const r=this.extractShortId(t.id);confirm('[TEST] Simulate closing the tender?\n\nThis will update the status from "launched" to "closed".')&&(console.log("[TEST] Closing tender (updating to accepted):",t.id),this.quoteService.updateQuoteStatus(t.id,"accepted").subscribe({next:i=>{const s=this.quotes.findIndex(a=>a.id===i.id);-1!==s&&(this.quotes[s]=i,this.filterQuotesByStatus()),console.log("[TEST] Tender successfully closed (status updated to accepted/closed)"),this.notificationService.showSuccess(`Tender ${r} has been closed successfully (status: closed).`)},error:i=>{console.error("[TEST] Error closing tender:",i),this.notificationService.showError(`Error closing tender: ${i.message||"Unknown error"}`)}}))}acceptQuoteCustomer(t){const r=this.extractShortId(t.id);confirm("Are you sure you want to accept the quotation?")&&(console.log("Buyer accepting quotation:",t.id),this.quoteService.updateQuoteStatus(t.id,"accepted").subscribe({next:i=>{const s=this.quotes.findIndex(a=>a.id===i.id);-1!==s&&(this.quotes[s]=i,this.filterQuotesByStatus()),console.log("Quotation successfully accepted by buyer"),this.notificationService.showSuccess(`Quotation ${r} has been accepted successfully.`)},error:i=>{console.error("Error accepting quotation:",i),this.notificationService.showError(`Error accepting quotation: ${i?.message||"Unknown error"}`)}}))}acceptTenderQuote(t){const r=this.extractShortId(t.id);if(!confirm("Are you sure you want to accept this quote? Every other quote in this tender will be Rejected"))return;console.log("Buyer accepting tender:",t.id);const s=(()=>{if(t.externalId)return t.externalId;for(const[a,g]of this.relatedQuotesMap.entries())if(g.some(_=>_.id===t.id))return a;return null})();this.quoteService.updateQuoteStatus(t.id,"accepted").subscribe({next:a=>{if(s){const _=(this.relatedQuotesMap.get(s)||[]).filter(f=>f.id!==t.id).filter(f=>{const l=this.getPrimaryState(f);return"accepted"!==l&&"cancelled"!==l&&"rejected"!==l});if(_.length>0){const f=_.map(l=>this.quoteService.updateQuoteStatus(l.id,"rejected"));(0,b.p)(f).subscribe({next:l=>{const Ye=(this.relatedQuotesMap.get(s)||[]).map(T=>T.id===a.id?a:l.find(Ve=>Ve.id===T.id)||T);this.relatedQuotesMap.set(s,Ye),this.notificationService.showSuccess(`Tender ${r} accepted. ${l.length} other quote(s) have been rejected.`)},error:l=>{console.error("Error rejecting sibling quotes:",l),this.notificationService.showError(`Accepted the selected quote, but failed rejecting other quotes: ${l.message||"Unknown error"}`)}})}else{const l=(this.relatedQuotesMap.get(s)||[]).map(y=>y.id===a.id?a:y);this.relatedQuotesMap.set(s,l),this.notificationService.showSuccess(`Tender ${r} has been accepted successfully.`)}}else{const g=this.quotes.findIndex(_=>_.id===a.id);-1!==g&&(this.quotes[g]=a,this.filterQuotesByStatus()),this.notificationService.showSuccess(`Tender ${r} has been accepted successfully.`)}},error:a=>{console.error("Error accepting tender:",a),this.notificationService.showError(`Error accepting tender: ${a?.message||"Unknown error"}`)}})}rejectTenderQuote(t){const r=this.extractShortId(t.id);confirm("Are you sure you want to reject this tender?\n\nThis action cannot be undone.")&&(console.log("Buyer rejecting tender:",t.id),this.quoteService.updateQuoteStatus(t.id,"rejected").subscribe({next:i=>{const s=this.quotes.findIndex(a=>a.id===i.id);-1!==s&&(this.quotes[s]=i,this.filterQuotesByStatus()),console.log("Tender successfully rejected by buyer"),this.notificationService.showSuccess(`Tender ${r} has been rejected.`)},error:i=>{console.error("Error rejecting tender:",i),this.notificationService.showError(`Error rejecting tender: ${i?.message||"Unknown error"}`)}}))}cancelQuote(t){const r=this.extractShortId(t.id);confirm(`Are you sure you want to cancel quote ${r}?\n\nThis action cannot be undone and will disable all other quote actions.`)&&(console.log("Cancelling quote:",t.id),this.quoteService.updateQuoteStatus(t.id,"cancelled").subscribe({next:i=>{const s=this.quotes.findIndex(a=>a.id===i.id);-1!==s&&(this.quotes[s]=i,this.filterQuotesByStatus()),console.log("Quote successfully cancelled"),this.notificationService.showSuccess(`Quote ${r} has been cancelled successfully.`)},error:i=>{console.error("Error cancelling quote:",i),this.notificationService.showError(`Error cancelling quote: ${i?.message||"Unknown error"}`)}}))}extractShortId(t){return t?t.length>8?t.slice(-8):t:"N/A"}getPrimaryState(t){return Array.isArray(t.quoteItem)&&t.quoteItem.length>0?t.quoteItem[0].state||"unknown":t.state?t.state:"unknown"}getQuoteItemState(t){let r="unknown";if(Array.isArray(t.quoteItem)&&t.quoteItem.length>0)for(const o of t.quoteItem)if(o&&o.state){r=o.state;break}return"coordinator"===t.category?this.mapCoordinatorStatusToGUI(r):r}mapCoordinatorStatusToGUI(t){return{pending:"draft",inProgress:"pre-launched",approved:"launched",accepted:"closed",cancelled:"cancelled",rejected:"rejected"}[t]||t}hasAttachment(t){return Array.isArray(t.quoteItem)&&t.quoteItem.some(r=>r.attachment&&r.attachment.length>0)}getAttachmentName(t){if(!Array.isArray(t.quoteItem))return"";for(const r of t.quoteItem)if(r.attachment&&r.attachment.length>0)return r.attachment[0].name||"attachment.pdf";return""}isQuoteCancelled(t){return!!t.quoteItem?.some(r=>"cancelled"===r.state)||"cancelled"===t.state}isQuoteAccepted(t){return!!t.quoteItem?.some(r=>"accepted"===r.state)||"accepted"===t.state}isQuoteFinalized(t){return this.isQuoteCancelled(t)||this.isQuoteAccepted(t)}isActionDisabled(t,r){const o=this.isQuoteCancelled(t),s=(this.isQuoteAccepted(t),this.isQuoteFinalized(t));switch(r){case"viewDetails":case"chat":case"downloadAttachment":return o;case"addAttachment":case"cancel":return s;case"accept":case"acceptCustomer":case"acceptTender":case"rejectTender":default:return!1;case"addRequestedDate":case"addExpectedDate":return!0}}getButtonClass(t,r){const o="px-2 py-1 text-xs font-medium transition-colors rounded border";return this.isActionDisabled(t,r)?`${o} text-gray-400 cursor-not-allowed border-gray-200`:"viewDetails"===r?`${o} text-blue-600 hover:text-blue-800 border-blue-200 hover:bg-blue-50`:`${o} text-indigo-600 hover:text-indigo-800 border-indigo-200 hover:bg-indigo-50`}getIconButtonClass(t,r,o){const i="p-1.5 text-xs cursor-pointer rounded hover:bg-gray-100 transition-colors";return this.isActionDisabled(t,r)?`${i} text-gray-400 cursor-not-allowed hover:bg-transparent`:`${i} ${o}`}getActionTitle(t,r){return this.isActionDisabled(t,r)?"Action disabled - quote is "+(this.isQuoteCancelled(t)?"cancelled":"accepted"):""}getStateDisplay(t){return t?{pending:"Pending",inProgress:"In Progress",approved:"Approved",rejected:"Rejected",cancelled:"Cancelled",accepted:"Accepted"}[t]||t:"Unknown"}getStateClass(t){switch(t){case"pending":return"status-pending";case"inProgress":return"status-inProgress";case"approved":return"status-approved";case"rejected":return"status-rejected";case"cancelled":return"status-cancelled";case"accepted":return"status-accepted";case"draft":return"status-draft";case"pre-launched":return"status-pre-launched";case"launched":return"status-launched";case"closed":return"status-closed";default:return"status-unknown"}}canUpdateState(t){return"cancelled"!==t&&"accepted"!==t}isCoordinatorExpandable(t){return"coordinator"===t.category&&"pending"!==this.getPrimaryState(t)}isExpanded(t){return!!t&&this.expandedQuoteIds.has(t)}toggleExpand(t){t.id&&(this.expandedQuoteIds.has(t.id)?(console.log(`Collapsing quote ${this.extractShortId(t.id)}`),this.expandedQuoteIds.delete(t.id)):(console.log(`Expanding quote ${this.extractShortId(t.id)}, externalId: ${t.externalId}`),this.expandedQuoteIds.add(t.id),this.relatedQuotesMap.has(t.id)?console.log(`Using cached ${this.relatedQuotesMap.get(t.id)?.length} related quotes`):(console.log("Fetching related quotes..."),this.loadRelatedQuotes(t))))}loadRelatedQuotes(t){if(!t.id||!this.currentUserId)return void console.error("Cannot load related quotes: missing id or userId",{id:t.id,userId:this.currentUserId});const r=t.externalId||t.id;console.log(`Loading related quotes for coordinator ${this.extractShortId(t.id)}:`,{userId:this.currentUserId,role:p.XZ.BUYER,externalId:r,coordinatorId:t.id}),this.loadingRelatedQuotes.add(t.id),this.quoteService.getTenderingQuotesByExternalId(this.currentUserId,r,p.XZ.BUYER).subscribe({next:o=>{this.relatedQuotesMap.set(t.id,o),this.loadingRelatedQuotes.delete(t.id),console.log(`\xe2\u0153\u2026 Successfully loaded ${o.length} related quotes for coordinator ${this.extractShortId(t.id)}`),o.length>0&&console.log("Related quotes:",o.map(i=>({id:this.extractShortId(i.id),provider:this.getProviderName(i),state:this.getQuoteItemState(i)})))},error:o=>{console.error("\xe2\x9d\u0152 Failed to load related quotes:",o),this.loadingRelatedQuotes.delete(t.id),this.notificationService.showError("Failed to load related quotes")}})}getRelatedQuotes(t){return t&&this.relatedQuotesMap.get(t)||[]}isLoadingRelatedQuotes(t){return!!t&&this.loadingRelatedQuotes.has(t)}getProviderName(t){if(console.log("Getting provider name for quote:",t.id),console.log("RelatedParty array:",t.relatedParty),!t.relatedParty||0===t.relatedParty.length)return console.warn("No relatedParty found in quote:",t.id),"Unknown Provider";t.relatedParty.forEach(o=>{console.log("Party:",o.id,"Role:",o.role,"Name:",o.name)});const r=t.relatedParty?.find(o=>"seller"===o.role?.toLowerCase());return r||(console.warn("No seller found in relatedParty for quote:",t.id),console.log("Available roles:",t.relatedParty.map(o=>o.role).join(", "))),r?.name||r?.id||"Unknown Provider"}canAcceptTenderingQuote(t){if(!t.externalId)return console.warn("Tendering quote has no externalId, cannot check coordinator state"),!1;const r=this.coordinatorQuoteStatesMap.get(t.externalId);return r?"inProgress"===r:(this.loadCoordinatorQuoteState(t.externalId),!1)}canAddAttachmentToTenderingQuote(t){if(!t.externalId)return console.warn("Tendering quote has no externalId, cannot check coordinator state"),!1;const r=this.coordinatorQuoteStatesMap.get(t.externalId);return r?"approved"===r:(this.loadCoordinatorQuoteState(t.externalId),!1)}loadCoordinatorQuoteState(t){this.loadingCoordinatorStates.has(t)||this.coordinatorQuoteStatesMap.has(t)||(console.log(`Loading coordinator quote state for: ${this.extractShortId(t)}`),this.loadingCoordinatorStates.add(t),this.quoteService.getQuoteById(t).subscribe({next:r=>{const o=this.getQuoteItemState(r),i=this.getPrimaryState(r);this.coordinatorQuoteStatesMap.set(t,i),this.loadingCoordinatorStates.delete(t),console.log(`Coordinator quote ${this.extractShortId(t)} state: ${i} (GUI: ${o})`)},error:r=>{console.error(`Failed to load coordinator quote state for ${this.extractShortId(t)}:`,r),this.loadingCoordinatorStates.delete(t),this.coordinatorQuoteStatesMap.set(t,"unknown")}}))}loadCoordinatorStatesForTenderingQuotes(){const t=new Set;this.quotes.forEach(r=>{"tender"===r.category&&r.externalId&&t.add(r.externalId)}),t.forEach(r=>{this.loadCoordinatorQuoteState(r)})}static#e=this.\u0275fac=function(r){return new(r||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-quote-list"]],standalone:!0,features:[e.aNF],decls:50,vars:24,consts:[[1,"w-full","mx-auto","px-6","py-8"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-2xl","font-bold","text-gray-900","dark:text-white"],[1,"flex","space-x-3"],["class","bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 flex items-center",3,"click",4,"ngIf"],[1,"bg-gray-600","text-white","px-4","py-2","rounded-md","hover:bg-gray-700","focus:outline-none","focus:ring-2","focus:ring-gray-500","focus:ring-offset-2","disabled:opacity-50",3,"click","disabled"],[1,"mb-6"],[1,"flex","space-x-1","bg-gray-100","dark:bg-gray-700","p-1","rounded-lg"],[1,"flex-1","px-8","py-4","text-2xl","font-medium","rounded-md","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","inline","mr-3"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"],[1,"flex","items-center","space-x-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-gray-500","dark:text-gray-100"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"],[1,"text-sm","font-medium","text-gray-700","dark:text-gray-100"],[1,"form-select","rounded-md","border-gray-300","dark:bg-gray-700","dark:border-gray-800","dark:text-white","shadow-sm","focus:border-indigo-500","focus:ring-indigo-500",3,"ngModelChange","ngModel"],["value",""],["value","pending"],["value","inProgress"],["value","approved"],["value","rejected"],["value","cancelled"],["value","accepted"],["class","flex justify-center items-center py-8",4,"ngIf"],["class","bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded relative mb-4",4,"ngIf"],["class","bg-white dark:bg-gray-700 shadow-md rounded-lg overflow-hidden",4,"ngIf"],["title","Delete Quote","confirmText","Delete","confirmButtonClass","px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",3,"confirm","cancel","isOpen","message"],["class","fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",4,"ngIf"],[3,"close","isOpen","quoteId"],[3,"close","uploadSuccess","isOpen","quote"],[3,"closeModal","tenderCreated","tenderUpdated","isOpen","customerId","tenderToEdit"],[1,"bg-blue-600","text-white","px-4","py-2","rounded-md","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","flex","items-center",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"flex","justify-center","items-center","py-8"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-blue-600"],[1,"bg-red-50","border","border-red-200","text-red-700","px-4","py-3","rounded","relative","mb-4"],[1,"flex"],[1,"flex-shrink-0"],["viewBox","0 0 20 20","fill","currentColor",1,"h-5","w-5","text-red-400"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule","evenodd"],[1,"ml-3"],[1,"text-sm","font-medium","text-red-800"],[1,"mt-1","text-sm","text-red-700"],[1,"bg-white","dark:bg-gray-700","shadow-md","rounded-lg","overflow-hidden"],["class","text-center py-12",4,"ngIf"],["class","bg-gray-50 px-6 py-3",4,"ngIf"],["class","quote-row",4,"ngFor","ngForOf"],[1,"text-center","py-12"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"mx-auto","h-12","w-12","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"mt-2","text-sm","font-medium","text-gray-900"],[1,"mt-1","text-sm","text-gray-500"],[1,"bg-gray-50","px-6","py-3"],[1,"grid","grid-cols-16","gap-4","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[1,"col-span-1"],[1,"col-span-3"],[1,"col-span-2"],["class","col-span-1",4,"ngIf"],[1,"quote-row"],[1,"grid","grid-cols-16","gap-4","items-center","px-6","py-4","border-b","border-gray-100","transition-colors"],[1,"col-span-1","flex","items-center","gap-1"],["class","p-1.5 text-indigo-600 hover:text-indigo-800 hover:bg-indigo-50 rounded transition-colors",3,"title","click",4,"ngIf"],["title","View details",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"],[1,"col-span-3","text-sm","font-medium","text-gray-900"],[1,"status-badge","px-2","inline-flex","text-xs","leading-5","font-semibold","rounded-full",3,"ngClass"],[1,"col-span-2","text-sm","text-gray-600"],[1,"col-span-2","text-sm"],["class","flex items-center space-x-1",4,"ngIf"],["class","flex items-center space-x-1 text-blue-500 hover:text-blue-700 disabled:text-gray-300","title","Add attachment",3,"disabled","click",4,"ngIf"],["class","col-span-1 text-sm",4,"ngIf"],[1,"flex","flex-wrap","gap-1"],["class","px-2 py-1 text-xs font-medium transition-colors rounded border text-orange-600 hover:text-orange-800 border-orange-200 hover:bg-orange-50 flex items-center gap-1","title","[TEST] Start tender - updates status to 'launched'",3,"click",4,"ngIf"],["class","px-2 py-1 text-xs font-medium transition-colors rounded border text-purple-600 hover:text-purple-800 border-purple-200 hover:bg-purple-50 flex items-center gap-1","title","[TEST] Close tender - updates status to 'closed'",3,"click",4,"ngIf"],["class","px-2 py-1 text-xs font-medium transition-colors rounded border text-green-600 hover:text-green-800 border-green-200 hover:bg-green-50","title","Edit tender",3,"click",4,"ngIf"],["title","Chat",3,"disabled","class","click",4,"ngIf"],["class","px-2 py-1 text-xs font-medium transition-colors rounded border text-fuchsia-600 hover:text-fuchsia-800 border-fuchsia-200 hover:bg-fuchsia-50","title","Broadcast message to all invited providers",3,"click",4,"ngIf"],[4,"ngIf"],["class","px-6 py-4 bg-gray-50 border-t border-gray-200",4,"ngIf"],[1,"p-1.5","text-indigo-600","hover:text-indigo-800","hover:bg-indigo-50","rounded","transition-colors",3,"click","title"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4","transition-transform"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"flex","items-center","space-x-1"],["title","Download attachment",1,"flex","items-center","space-x-1","text-purple-600","hover:text-purple-800","disabled:text-gray-300",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"],[1,"text-xs","truncate","max-w-[100px]"],["class","text-blue-500 hover:text-blue-700 disabled:text-gray-300","title","Edit attachment",3,"disabled","click",4,"ngIf"],["title","Edit attachment",1,"text-blue-500","hover:text-blue-700","disabled:text-gray-300",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"],["title","Add attachment",1,"flex","items-center","space-x-1","text-blue-500","hover:text-blue-700","disabled:text-gray-300",3,"click","disabled"],[1,"text-xs"],[1,"col-span-1","text-sm"],["class","flex items-center space-x-1 text-blue-600 hover:text-blue-800","title","Download Buyer's Request (from coordinator)",3,"click",4,"ngIf"],["title","Download Buyer's Request (from coordinator)",1,"flex","items-center","space-x-1","text-blue-600","hover:text-blue-800",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],["title","[TEST] Start tender - updates status to 'launched'",1,"px-2","py-1","text-xs","font-medium","transition-colors","rounded","border","text-orange-600","hover:text-orange-800","border-orange-200","hover:bg-orange-50","flex","items-center","gap-1",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-3","w-3"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 10V3L4 14h7v7l9-11h-7z"],["title","[TEST] Close tender - updates status to 'closed'",1,"px-2","py-1","text-xs","font-medium","transition-colors","rounded","border","text-purple-600","hover:text-purple-800","border-purple-200","hover:bg-purple-50","flex","items-center","gap-1",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],["title","Edit tender",1,"px-2","py-1","text-xs","font-medium","transition-colors","rounded","border","text-green-600","hover:text-green-800","border-green-200","hover:bg-green-50",3,"click"],["title","Chat",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 10h.01M12 10h.01M16 10h.01M21 12c0 4.418-4.03 8-9 8a9.77 9.77 0 01-4-.8L3 21l1.8-4A7.96 7.96 0 013 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"],["title","Broadcast message to all invited providers",1,"px-2","py-1","text-xs","font-medium","transition-colors","rounded","border","text-fuchsia-600","hover:text-fuchsia-800","border-fuchsia-200","hover:bg-fuchsia-50",3,"click"],["title","Accept tender request",3,"disabled","class","click",4,"ngIf"],["title","Accept quotation",3,"disabled","class","click",4,"ngIf"],["title","Accept tender",3,"disabled","class","click",4,"ngIf"],["title","Reject tender",3,"disabled","class","click",4,"ngIf"],["title","Cancel tender request",3,"disabled","class","click",4,"ngIf"],["title","Accept tender request",3,"click","disabled"],["title","Accept quotation",3,"click","disabled"],["title","Accept tender",3,"click","disabled"],["title","Reject tender",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],["title","Cancel tender request",3,"click","disabled"],["disabled","",1,"p-2","text-xs","text-gray-400","cursor-not-allowed",3,"title"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2"],[1,"px-6","py-4","bg-gray-50","border-t","border-gray-200"],[1,"ml-8"],[1,"text-sm","font-semibold","text-gray-700","mb-3"],["class","flex items-center justify-center py-4",4,"ngIf"],["class","bg-white rounded-lg shadow-sm border border-gray-200",4,"ngIf"],["class","text-center py-6 text-sm text-gray-500 bg-white rounded-lg border border-gray-200",4,"ngIf"],[1,"flex","items-center","justify-center","py-4"],[1,"animate-spin","rounded-full","h-6","w-6","border-b-2","border-indigo-600"],[1,"ml-2","text-sm","text-gray-600"],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200"],[1,"bg-gray-100","px-4","py-2","border-b","border-gray-200"],[1,"grid","grid-cols-12","gap-4","text-xs","font-medium","text-gray-600","uppercase"],[1,"col-span-4"],["class","px-4 py-3 hover:bg-gray-50 transition-colors",3,"border-b","border-gray-200",4,"ngFor","ngForOf"],[1,"px-4","py-3","hover:bg-gray-50","transition-colors"],[1,"grid","grid-cols-12","gap-4","items-center","text-sm"],["title","View details",1,"p-1","text-gray-600","hover:text-gray-900","rounded","hover:bg-gray-100","transition-colors",3,"click"],[1,"col-span-3","text-gray-900","font-medium"],[1,"status-badge","px-2","py-0.5","inline-flex","text-xs","leading-5","font-semibold","rounded-full",3,"ngClass"],["class","flex items-center space-x-1 text-purple-600 hover:text-purple-800","title","Download attachment",3,"click",4,"ngIf"],[1,"col-span-4","flex","gap-1"],["title","Chat",1,"p-1","text-blue-500","hover:text-blue-700","rounded","hover:bg-gray-100","transition-colors",3,"click"],["title","Download attachment",1,"flex","items-center","space-x-1","text-purple-600","hover:text-purple-800",3,"click"],[1,"text-xs","truncate","max-w-[80px]"],[1,"text-center","py-6","text-sm","text-gray-500","bg-white","rounded-lg","border","border-gray-200"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"mx-auto","h-8","w-8","text-gray-400","mb-2"],[1,"fixed","inset-0","bg-gray-600","bg-opacity-50","overflow-y-auto","h-full","w-full","z-50"],[1,"relative","top-20","mx-auto","p-5","border","w-96","shadow-lg","rounded-md","bg-white"],[1,"mt-3"],[1,"text-lg","font-medium","text-gray-900","mb-4"],[1,"space-y-3"],["class","flex items-center",4,"ngFor","ngForOf"],[1,"mt-6","flex","justify-end","space-x-3"],[1,"px-4","py-2","text-sm","font-medium","text-gray-700","bg-white","border","border-gray-300","rounded-md","hover:bg-gray-50","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-indigo-500",3,"click"],[1,"px-4","py-2","text-sm","font-medium","text-white","bg-indigo-600","border","border-transparent","rounded-md","hover:bg-indigo-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-indigo-500","disabled:opacity-50",3,"click","disabled"],[1,"flex","items-center"],["type","radio",1,"focus:ring-indigo-500","h-4","w-4","text-indigo-600","border-gray-300",3,"ngModelChange","id","ngModel","value"],[1,"ml-3","block","text-sm","font-medium","text-gray-700",3,"for"],[1,"mt-1"],["rows","4","placeholder","Type your message to all invited providers...",1,"w-full","border","border-gray-300","rounded-md","p-2","focus:outline-none","focus:ring-2","focus:ring-indigo-500","focus:border-indigo-500",3,"ngModelChange","ngModel"],[1,"mt-4","flex","justify-end","space-x-3"],[1,"px-4","py-2","text-sm","font-medium","text-white","bg-fuchsia-600","border","border-transparent","rounded-md","hover:bg-fuchsia-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-fuchsia-500","disabled:opacity-50",3,"click","disabled"]],template:function(r,o){1&r&&(e.nrm(0,"app-notification"),e.j41(1,"div",0)(2,"div",1)(3,"h1",2),e.EFF(4,"Tenders"),e.k0s(),e.j41(5,"div",3),e.DNE(6,se,4,0,"button",4),e.j41(7,"button",5),e.bIt("click",function(){return o.refreshQuotes()}),e.EFF(8),e.k0s()()(),e.j41(9,"div",6)(10,"div",7)(11,"button",8),e.bIt("click",function(){return o.selectRole(o.UI_ROLES.BUYER)}),e.qSk(),e.j41(12,"svg",9),e.nrm(13,"path",10),e.k0s(),e.EFF(14," As Buyer "),e.k0s(),e.joV(),e.j41(15,"button",8),e.bIt("click",function(){return o.selectRole(o.UI_ROLES.SELLER)}),e.qSk(),e.j41(16,"svg",9),e.nrm(17,"path",11),e.k0s(),e.EFF(18," As Provider "),e.k0s()()(),e.joV(),e.j41(19,"div",6)(20,"div",12),e.qSk(),e.j41(21,"svg",13),e.nrm(22,"path",14),e.k0s(),e.joV(),e.j41(23,"span",15),e.EFF(24,"Filter by status"),e.k0s(),e.j41(25,"select",16),e.mxI("ngModelChange",function(s){return e.DH7(o.statusFilter,s)||(o.statusFilter=s),s}),e.bIt("ngModelChange",function(){return o.filterQuotesByStatus()}),e.j41(26,"option",17),e.EFF(27,"All Statuses"),e.k0s(),e.j41(28,"option",18),e.EFF(29,"Pending"),e.k0s(),e.j41(30,"option",19),e.EFF(31,"In Progress"),e.k0s(),e.j41(32,"option",20),e.EFF(33,"Approved"),e.k0s(),e.j41(34,"option",21),e.EFF(35,"Rejected"),e.k0s(),e.j41(36,"option",22),e.EFF(37,"Cancelled"),e.k0s(),e.j41(38,"option",23),e.EFF(39,"Accepted"),e.k0s()()()(),e.DNE(40,de,2,0,"div",24)(41,ae,10,1,"div",25)(42,Qe,4,3,"div",26),e.k0s(),e.j41(43,"app-confirm-dialog",27),e.bIt("confirm",function(){return o.deleteQuote()})("cancel",function(){return o.showDeleteConfirm=!1}),e.k0s(),e.DNE(44,Be,12,2,"div",28),e.j41(45,"app-quote-details-modal",29),e.bIt("close",function(){return o.closeQuoteDetailsModal()}),e.k0s(),e.j41(46,"app-chat-modal",29),e.bIt("close",function(){return o.closeChatModal()}),e.k0s(),e.j41(47,"app-attachment-modal",30),e.bIt("close",function(){return o.closeAttachmentModal()})("uploadSuccess",function(s){return o.onAttachmentUploaded(s)}),e.k0s(),e.DNE(48,Ue,11,3,"div",28),e.j41(49,"app-create-tender-modal",31),e.bIt("closeModal",function(){return o.closeCreateTenderModal()})("tenderCreated",function(s){return o.onTenderCreated(s)})("tenderUpdated",function(){return o.onTenderUpdated()}),e.k0s()),2&r&&(e.R7$(6),e.Y8G("ngIf",o.selectedRole===o.UI_ROLES.BUYER),e.R7$(),e.Y8G("disabled",o.loading),e.R7$(),e.SpI(" ",o.loading?"Loading...":"Refresh"," "),e.R7$(3),e.HbH(o.getRoleTabClass(o.UI_ROLES.BUYER)),e.R7$(4),e.HbH(o.getRoleTabClass(o.UI_ROLES.SELLER)),e.R7$(10),e.R50("ngModel",o.statusFilter),e.R7$(15),e.Y8G("ngIf",o.loading),e.R7$(),e.Y8G("ngIf",o.error),e.R7$(),e.Y8G("ngIf",!o.loading&&!o.error),e.R7$(),e.Y8G("isOpen",o.showDeleteConfirm)("message",o.deleteConfirmMessage),e.R7$(),e.Y8G("ngIf",o.showStateUpdate),e.R7$(),e.Y8G("isOpen",o.showQuoteDetailsModal)("quoteId",o.selectedQuoteId),e.R7$(),e.Y8G("isOpen",o.showChatModal)("quoteId",o.selectedChatQuoteId),e.R7$(),e.Y8G("isOpen",o.showAttachmentModal)("quote",o.selectedAttachmentQuote),e.R7$(),e.Y8G("ngIf",o.showBroadcastModal),e.R7$(),e.Y8G("isOpen",o.showCreateTenderModal)("customerId",o.currentUserId||"")("tenderToEdit",o.tenderToEdit))},dependencies:[h.MD,h.YU,h.Sq,h.bT,h.vh,u.YN,u.xH,u.y7,u.me,u.wz,u.Fm,u.BC,u.vS,j.z,E.w,G.h,D.d,L.w,ie],styles:[".status-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;border-radius:9999px;padding:.125rem .625rem;font-size:.75rem;line-height:1rem;font-weight:500}.status-pending[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(253 246 178 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(114 59 19 / var(--tw-text-opacity))}.status-inProgress[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(225 239 254 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(30 66 159 / var(--tw-text-opacity))}.status-approved[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(222 247 236 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(3 84 63 / var(--tw-text-opacity))}.status-rejected[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(253 232 232 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(155 28 28 / var(--tw-text-opacity))}.status-cancelled[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(243 244 246 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(31 41 55 / var(--tw-text-opacity))}.status-accepted[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(213 245 246 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(5 80 92 / var(--tw-text-opacity))}.status-unknown[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(243 244 246 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(75 85 99 / var(--tw-text-opacity))}.status-draft[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(253 246 178 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(114 59 19 / var(--tw-text-opacity))}.status-pre-launched[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(225 239 254 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(30 66 159 / var(--tw-text-opacity))}.status-launched[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(222 247 236 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(3 84 63 / var(--tw-text-opacity))}.status-closed[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(243 244 246 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(31 41 55 / var(--tw-text-opacity))}.rotate-180[_ngcontent-%COMP%]{transform:rotate(180deg)}"]})}return n})();const Xe=[{path:"",component:$}];let Ne=(()=>{class n{static#e=this.\u0275fac=function(r){return new(r||n)};static#t=this.\u0275mod=e.$C({type:n});static#r=this.\u0275inj=e.G2t({imports:[h.MD,v.iI.forChild(Xe),$,j.z,E.w]})}return n})()}}]);