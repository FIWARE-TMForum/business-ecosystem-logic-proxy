"use strict";(self.webpackChunkbae_frontend=self.webpackChunkbae_frontend||[]).push([[468],{4468:(We,I,c)=>{c.r(I),c.d(I,{TendersModule:()=>Xe});var _=c(177),k=c(1600),e=c(4438),u=c(9417),h=c(6354),y=c(7468),f=c(7673),v=c(9437),x=c(5558),E=c(8508),F=c(3077),R=c(7473),P=c(452),j=c(8944),T=c(3836),A=c(6964),L=c(5586),G=c(3636),D=c(1626),S=c(5312);let Q=(()=>{class n{constructor(){this.http=(0,e.WQX)(D.Qq),this.endpoint=`${S.c.BASE_URL}/party/organization`}getProviders(t={}){let o=new D.Nl;t.fields&&(o=o.set("fields",t.fields)),void 0!==t.offset&&(o=o.set("offset",t.offset.toString())),void 0!==t.limit&&(o=o.set("limit",t.limit.toString()));const r=`${this.endpoint}${o.toString()?"?"+o.toString():""}`;return this.http.get(r).pipe((0,h.T)(i=>Array.isArray(i)?i:[]),(0,v.W)(i=>(console.warn("Provider API failed:",i),(0,f.of)([]))))}getProviderById(t){const o=`${this.endpoint}/${t}`,r=o.startsWith("https://"),i=r?`https://api.allorigins.win/get?url=${encodeURIComponent(o)}`:o;return this.http.get(i).pipe((0,h.T)(s=>r?JSON.parse(s.contents):s),(0,v.W)(s=>{throw console.warn("Provider by ID API failed:",s),s}))}getProvidersForTender(){const t=this.endpoint,o=t.startsWith("https://"),r=o?`https://api.allorigins.win/get?url=${encodeURIComponent(t)}`:t;return this.http.get(r).pipe((0,h.T)(i=>{const s=o?JSON.parse(i.contents):i;return Array.isArray(s)?s:[]}),(0,v.W)(i=>(console.warn("Providers for tender API failed:",i),(0,f.of)([]))))}getProvidersForTenderNew(t){return this.http.post(S.c.searchOrganizationsEndpoint,t).pipe((0,h.T)(r=>Array.isArray(r)?r:r?.data&&Array.isArray(r.data)?r.data:[]),(0,v.W)(r=>(console.warn("Providers for tender (new) API failed:",r),(0,f.of)([]))))}getFilterOptions(){const t=S.c.searchOrganizationsEndpoint.replace(/\/searchOrganizations$/,""),o=this.http.get(`${t}/categories`).pipe((0,h.T)(s=>Array.isArray(s)?s:Array.isArray(s?.data)?s.data:[]),(0,v.W)(s=>(console.warn("Categories API failed:",s),(0,f.of)([])))),r=this.http.get(`${t}/countries`).pipe((0,h.T)(s=>Array.isArray(s)?s:Array.isArray(s?.data)?s.data:[]),(0,v.W)(s=>(console.warn("Countries API failed:",s),(0,f.of)([])))),i=this.http.get(`${t}/complianceLevels`).pipe((0,h.T)(s=>Array.isArray(s)?s:Array.isArray(s?.data)?s.data:[]),(0,v.W)(s=>(console.warn("ComplianceLevels API failed:",s),(0,f.of)([]))));return(0,y.p)({categories:o,countries:r,complianceLevels:i})}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var p=c(2087),d=c(8058);const q=new Intl.DisplayNames(["en"],{type:"region"}),N={EL:"GR",UK:"GB"};function B(n){if(2!==n?.length)return n??"";if(!n)return"";const a=n.toUpperCase();return q.of(N?.[a]??a)??a}function U(n){if(!n)return"";const a=n.toUpperCase();return{BL:"Baseline",P:"Professional","P+":"Professional+"}[a]??a}function O(n,a){if(1&n){const t=e.RV6();e.j41(0,"div")(1,"div",11)(2,"label",12),e.EFF(3," Tender Title * "),e.k0s(),e.j41(4,"input",13),e.mxI("ngModelChange",function(r){e.eBV(t);const i=e.XpG(2);return e.DH7(i.tenderTitle,r)||(i.tenderTitle=r),e.Njj(r)}),e.k0s(),e.j41(5,"p",14),e.EFF(6,"This will be the main description of your tender"),e.k0s()(),e.j41(7,"div",15)(8,"button",16),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.closeTenderModal())}),e.EFF(9," Cancel "),e.k0s(),e.j41(10,"button",17),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.saveInitialTender())}),e.EFF(11),e.k0s()()()}if(2&n){const t=e.XpG(2);e.R7$(4),e.R50("ngModel",t.tenderTitle),e.R7$(6),e.Y8G("disabled",!t.tenderTitle.trim()||t.tenderLoading),e.R7$(),e.SpI(" ",t.tenderLoading?"Saving...":"Save"," ")}}function Y(n,a){if(1&n&&(e.j41(0,"div",33)(1,"div",34)(2,"div",35),e.qSk(),e.j41(3,"svg",36),e.nrm(4,"path",37),e.k0s(),e.joV(),e.j41(5,"div")(6,"p",38),e.EFF(7,"Current PDF:"),e.k0s(),e.j41(8,"p",39),e.EFF(9),e.k0s()()(),e.j41(10,"span",40),e.EFF(11,"Attached"),e.k0s()(),e.j41(12,"p",41),e.EFF(13,"Upload a new file to replace the existing attachment"),e.k0s()()),2&n){const t=e.XpG(3);e.R7$(9),e.JRh(t.existingAttachment.name)}}function V(n,a){1&n&&(e.j41(0,"span",42),e.EFF(1," Fill in all fields to continue "),e.k0s())}function X(n,a){if(1&n){const t=e.RV6();e.j41(0,"div")(1,"div",18)(2,"label",19),e.EFF(3,"Tender Title"),e.k0s(),e.j41(4,"p",20),e.EFF(5),e.k0s()(),e.j41(6,"div",21)(7,"p",22),e.EFF(8),e.k0s()(),e.j41(9,"div",11)(10,"label",23),e.EFF(11," Tender Start Date * "),e.k0s(),e.j41(12,"input",24),e.mxI("ngModelChange",function(r){e.eBV(t);const i=e.XpG(2);return e.DH7(i.requestedCompletionDate,r)||(i.requestedCompletionDate=r),e.Njj(r)}),e.k0s(),e.j41(13,"p",25),e.EFF(14,"Format: DD/MM/YYYY"),e.k0s()(),e.j41(15,"div",11)(16,"label",26),e.EFF(17," Tender End Date * "),e.k0s(),e.j41(18,"input",27),e.mxI("ngModelChange",function(r){e.eBV(t);const i=e.XpG(2);return e.DH7(i.expectedCompletionDate,r)||(i.expectedCompletionDate=r),e.Njj(r)}),e.k0s(),e.j41(19,"p",25),e.EFF(20,"Format: DD/MM/YYYY"),e.k0s()(),e.j41(21,"div",11)(22,"label",28),e.EFF(23," PDF Attachment * "),e.k0s(),e.DNE(24,Y,14,1,"div",29),e.j41(25,"input",30),e.bIt("change",function(r){e.eBV(t);const i=e.XpG(2);return e.Njj(i.onPdfFileSelected(r))}),e.k0s(),e.j41(26,"p",25),e.EFF(27),e.k0s()(),e.j41(28,"div",15)(29,"button",16),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.closeTenderModal())}),e.EFF(30," Cancel "),e.k0s(),e.j41(31,"button",31),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.proceedToProviderSelection())}),e.EFF(32),e.DNE(33,V,2,0,"span",32),e.k0s()()()}if(2&n){const t=e.XpG(2);e.R7$(5),e.JRh(t.tenderTitle),e.R7$(3),e.JRh(t.TENDER_STEP2_DESCRIPTION),e.R7$(4),e.R50("ngModel",t.requestedCompletionDate),e.Y8G("min",t.minDate),e.R7$(6),e.R50("ngModel",t.expectedCompletionDate),e.Y8G("min",t.minDate),e.R7$(6),e.Y8G("ngIf",t.existingAttachment),e.R7$(3),e.SpI(" ",t.existingAttachment?"Select a new file to upload or keep the current one":"Only PDF files allowed"," \u2014 Max size 10MB "),e.R7$(4),e.Y8G("disabled",!t.isStep2Complete()||t.tenderLoading)("title",t.isStep2Complete()?"":"Fill in all fields to continue"),e.R7$(),e.SpI(" ",t.tenderLoading?"Saving...":"Next: Select Providers"," "),e.R7$(),e.Y8G("ngIf",!t.isStep2Complete())}}function z(n,a){if(1&n&&(e.j41(0,"div",44)(1,"h4",45),e.EFF(2,"\u2713 PDF Attachment Set"),e.k0s(),e.j41(3,"p",55),e.EFF(4),e.k0s()()),2&n){const t=e.XpG(3);e.R7$(4),e.JRh((null==t.existingAttachment?null:t.existingAttachment.name)||(null==t.selectedPdfFile?null:t.selectedPdfFile.name))}}function J(n,a){1&n&&(e.j41(0,"div",56),e.nrm(1,"div",57),e.k0s())}function W(n,a){if(1&n&&(e.j41(0,"div",58)(1,"p",59),e.EFF(2),e.k0s()()),2&n){const t=e.XpG(3);e.R7$(2),e.JRh(t.tenderError)}}function H(n,a){if(1&n&&(e.j41(0,"p",80),e.EFF(1),e.k0s()),2&n){const t=e.XpG().$implicit;e.R7$(),e.SpI(" ",null==t.provider.externalReference||null==t.provider.externalReference[0]?null:t.provider.externalReference[0].name," ")}}function K(n,a){if(1&n){const t=e.RV6();e.j41(0,"div",74)(1,"div",75)(2,"p",76),e.EFF(3),e.k0s(),e.DNE(4,H,2,1,"p",77),e.k0s(),e.j41(5,"button",78),e.bIt("click",function(){const r=e.eBV(t).$implicit,i=e.XpG(5);return e.Njj(i.removeInvitedProvider(r.quoteId,r.provider.id))}),e.qSk(),e.j41(6,"svg",79),e.nrm(7,"path",9),e.k0s()()()}if(2&n){const t=a.$implicit;e.R7$(3),e.SpI(" ",t.provider.tradingName||"Unnamed Provider"," "),e.R7$(),e.Y8G("ngIf",null==t.provider.externalReference||null==t.provider.externalReference[0]?null:t.provider.externalReference[0].name)}}function Z(n,a){if(1&n&&(e.j41(0,"div",11)(1,"label",61),e.EFF(2),e.k0s(),e.j41(3,"div",72),e.DNE(4,K,8,2,"div",73),e.k0s()()),2&n){const t=e.XpG(4);e.R7$(2),e.SpI(" Already Invited Providers (",t.invitedProviders.length,") "),e.R7$(2),e.Y8G("ngForOf",t.invitedProviders)}}function ee(n,a){if(1&n){const t=e.RV6();e.j41(0,"option",81),e.bIt("mousedown",function(r){const i=e.eBV(t).$implicit,s=e.XpG(4);return e.Njj(s.toggleFromSelect(s.countriesCtrl,i,r))}),e.EFF(1),e.k0s()}if(2&n){const t=a.$implicit,o=e.XpG(4);e.Y8G("value",t),e.R7$(),e.JRh(o.countryName(t))}}function te(n,a){if(1&n){const t=e.RV6();e.j41(0,"option",81),e.bIt("mousedown",function(r){const i=e.eBV(t).$implicit,s=e.XpG(4);return e.Njj(s.toggleFromSelect(s.categoriesCtrl,i,r))}),e.EFF(1),e.k0s()}if(2&n){const t=a.$implicit;e.Y8G("value",t),e.R7$(),e.JRh(t)}}function re(n,a){if(1&n){const t=e.RV6();e.j41(0,"option",81),e.bIt("mousedown",function(r){const i=e.eBV(t).$implicit,s=e.XpG(4);return e.Njj(s.toggleFromSelect(s.complianceLevelsCtrl,i,r))}),e.EFF(1),e.k0s()}if(2&n){const t=a.$implicit,o=e.XpG(4);e.Y8G("value",t),e.R7$(),e.JRh(o.complianceLevelsName(t))}}function oe(n,a){if(1&n){const t=e.RV6();e.j41(0,"input",85),e.bIt("change",function(){e.eBV(t);const r=e.XpG().$implicit,i=e.XpG(4);return e.Njj(i.toggleProviderSelection(r.id))}),e.k0s()}if(2&n){const t=e.XpG().$implicit,o=e.XpG(4);e.Y8G("id","provider-"+t.id)("checked",o.selectedProviders.has(t.id))}}function ie(n,a){if(1&n&&(e.j41(0,"p",80),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2).$implicit;e.R7$(),e.SpI(" ",null==t.externalReference||null==t.externalReference[0]?null:t.externalReference[0].name," ")}}function ne(n,a){if(1&n&&(e.j41(0,"label",86)(1,"div")(2,"p",76),e.EFF(3),e.k0s(),e.DNE(4,ie,2,1,"p",77),e.k0s()()),2&n){const t=e.XpG().$implicit;e.Y8G("for","provider-"+t.id),e.R7$(3),e.SpI(" ",t.tradingName||"Unnamed Provider"," "),e.R7$(),e.Y8G("ngIf",null==t.externalReference||null==t.externalReference[0]?null:t.externalReference[0].name)}}function se(n,a){if(1&n&&(e.j41(0,"div",82),e.DNE(1,oe,1,2,"input",83)(2,ne,5,3,"label",84),e.k0s()),2&n){const t=a.$implicit;e.R7$(),e.Y8G("ngIf",t.id),e.R7$(),e.Y8G("ngIf",t.id)}}function ae(n,a){if(1&n){const t=e.RV6();e.j41(0,"input",85),e.bIt("change",function(){e.eBV(t);const r=e.XpG().$implicit,i=e.XpG(4);return e.Njj(i.toggleProviderSelection(r.id))}),e.k0s()}if(2&n){const t=e.XpG().$implicit,o=e.XpG(4);e.Y8G("id","provider-"+t.id)("checked",o.selectedProviders.has(t.id))}}function de(n,a){if(1&n&&(e.j41(0,"p",80),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2).$implicit;e.R7$(),e.SpI(" ",null==t.externalReference||null==t.externalReference[0]?null:t.externalReference[0].name," ")}}function le(n,a){if(1&n&&(e.j41(0,"label",86)(1,"div")(2,"p",76),e.EFF(3),e.k0s(),e.DNE(4,de,2,1,"p",77),e.k0s()()),2&n){const t=e.XpG().$implicit;e.Y8G("for","provider-"+t.id),e.R7$(3),e.SpI(" ",t.tradingName||"Unnamed Provider"," "),e.R7$(),e.Y8G("ngIf",null==t.externalReference||null==t.externalReference[0]?null:t.externalReference[0].name)}}function ce(n,a){if(1&n&&(e.j41(0,"div",82),e.DNE(1,ae,1,2,"input",83)(2,le,5,3,"label",84),e.k0s()),2&n){const t=a.$implicit;e.R7$(),e.Y8G("ngIf",t.id),e.R7$(),e.Y8G("ngIf",t.id)}}function ue(n,a){1&n&&(e.qex(0),e.j41(1,"p",89),e.EFF(2," No more providers available. All providers have been invited. "),e.k0s(),e.bVm())}function ge(n,a){1&n&&(e.j41(0,"p",89),e.EFF(1," No filters Selected. Adjust Countries/Categories and click "),e.j41(2,"strong"),e.EFF(3,"Search"),e.k0s(),e.EFF(4,". "),e.k0s())}function pe(n,a){if(1&n&&(e.j41(0,"div",87),e.DNE(1,ue,3,0,"ng-container",88)(2,ge,5,0,"ng-template",null,0,e.C5r),e.k0s()),2&n){const t=e.sdS(3),o=e.XpG(4);e.R7$(),e.Y8G("ngIf",!o.hasActiveFilters())("ngIfElse",t)}}function he(n,a){if(1&n){const t=e.RV6();e.j41(0,"div"),e.DNE(1,Z,5,2,"div",60),e.j41(2,"div",11)(3,"label",61),e.EFF(4," Select Providers to Invite "),e.k0s(),e.j41(5,"div",62)(6,"div",63)(7,"div")(8,"label",19),e.EFF(9,"Countries"),e.k0s(),e.j41(10,"select",64),e.DNE(11,ee,2,2,"option",65),e.k0s()(),e.j41(12,"div")(13,"label",19),e.EFF(14,"Categories"),e.k0s(),e.j41(15,"select",64),e.DNE(16,te,2,2,"option",65),e.k0s()(),e.j41(17,"div")(18,"label",19),e.EFF(19,"Compliance Levels"),e.k0s(),e.j41(20,"select",64),e.DNE(21,re,2,2,"option",65),e.k0s()(),e.j41(22,"div",66)(23,"button",67),e.bIt("click",function(){e.eBV(t);const r=e.XpG(3);return e.Njj(r.clearFilters())}),e.EFF(24," Clear Filters "),e.k0s(),e.j41(25,"button",68),e.bIt("click",function(){e.eBV(t);const r=e.XpG(3);return e.Njj(r.emitFilters())}),e.EFF(26," Search "),e.k0s()()()(),e.j41(27,"div",69),e.DNE(28,se,3,2,"div",70)(29,ce,3,2,"div",70)(30,pe,4,2,"div",71),e.k0s(),e.j41(31,"p",14),e.EFF(32),e.k0s()()()}if(2&n){const t=e.XpG(3);e.R7$(),e.Y8G("ngIf",t.invitedProviders.length>0),e.R7$(9),e.Y8G("formControl",t.countriesCtrl),e.R7$(),e.Y8G("ngForOf",t.countriesOptions),e.R7$(4),e.Y8G("formControl",t.categoriesCtrl),e.R7$(),e.Y8G("ngForOf",t.categoriesOptions),e.R7$(4),e.Y8G("formControl",t.complianceLevelsCtrl),e.R7$(),e.Y8G("ngForOf",t.complianceLevelsOptions),e.R7$(7),e.Y8G("ngForOf",t._safeInvitedList),e.R7$(),e.Y8G("ngForOf",t.availableProviders),e.R7$(),e.Y8G("ngIf",0===t.availableProviders.length),e.R7$(2),e.SpI(" ",t.selectedProviders.size," provider(s) selected ")}}function fe(n,a){1&n&&(e.j41(0,"span",42),e.EFF(1," Please select at least one provider "),e.k0s())}function me(n,a){1&n&&(e.j41(0,"span",42),e.EFF(1," Please invite at least one provider first "),e.k0s())}function _e(n,a){if(1&n){const t=e.RV6();e.j41(0,"div")(1,"div",43)(2,"label",19),e.EFF(3,"Tender Title"),e.k0s(),e.j41(4,"p",20),e.EFF(5),e.k0s()(),e.j41(6,"div",44)(7,"h4",45),e.EFF(8,"\u2713 Dates Set"),e.k0s(),e.j41(9,"div",46)(10,"div")(11,"span",47),e.EFF(12,"Effective:"),e.k0s(),e.j41(13,"span",48),e.EFF(14),e.k0s()(),e.j41(15,"div")(16,"span",47),e.EFF(17,"Expected Fulfillment:"),e.k0s(),e.j41(18,"span",48),e.EFF(19),e.k0s()()()(),e.DNE(20,z,5,1,"div",49)(21,J,2,0,"div",50)(22,W,3,1,"div",51)(23,he,33,11,"div",10),e.j41(24,"div",52)(25,"button",16),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.backToStep2())}),e.EFF(26," \u2190 Back "),e.k0s(),e.j41(27,"div",53)(28,"button",16),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.closeTenderModal())}),e.EFF(29," Cancel "),e.k0s(),e.j41(30,"button",31),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.saveProvidersList())}),e.EFF(31),e.DNE(32,fe,2,0,"span",32),e.k0s(),e.j41(33,"button",54),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.finalizeTender())}),e.EFF(34," Submit Tender "),e.DNE(35,me,2,0,"span",32),e.k0s()()()()}if(2&n){const t=e.XpG(2);e.R7$(5),e.JRh(t.tenderTitle),e.R7$(9),e.JRh(t.formatDateForDisplay(t.expectedCompletionDate)),e.R7$(5),e.JRh(t.formatDateForDisplay(t.requestedCompletionDate)),e.R7$(),e.Y8G("ngIf",t.existingAttachment||t.pdfAttachmentSet),e.R7$(),e.Y8G("ngIf",t.tenderLoading),e.R7$(),e.Y8G("ngIf",t.tenderError),e.R7$(),e.Y8G("ngIf",!t.tenderLoading&&!t.tenderError),e.R7$(7),e.Y8G("disabled",0===t.selectedProviders.size||t.tenderLoading)("title",0===t.selectedProviders.size?"Please select at least one provider":""),e.R7$(),e.SpI(" ",t.tenderLoading?"Inviting...":"Save Providers List"," "),e.R7$(),e.Y8G("ngIf",0===t.selectedProviders.size),e.R7$(),e.Y8G("disabled",0===t.invitedProviders.length||t.tenderLoading)("title",0===t.invitedProviders.length?"Please invite at least one provider first":""),e.R7$(2),e.Y8G("ngIf",0===t.invitedProviders.length)}}function ve(n,a){if(1&n){const t=e.RV6();e.j41(0,"div",3),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.closeTenderModal())}),e.j41(1,"div",4),e.bIt("click",function(r){return e.eBV(t),e.Njj(r.stopPropagation())}),e.j41(2,"div",5)(3,"h3",6),e.EFF(4),e.k0s(),e.j41(5,"button",7),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.closeTenderModal())}),e.qSk(),e.j41(6,"svg",8),e.nrm(7,"path",9),e.k0s()()(),e.DNE(8,O,12,3,"div",10)(9,X,34,12,"div",10)(10,_e,36,14,"div",10),e.k0s()()}if(2&n){const t=e.XpG();e.R7$(4),e.JRh(t.editingTenderId?"Edit Tender":"Create New Tender"),e.R7$(4),e.Y8G("ngIf",1===t.tenderCreationStep),e.R7$(),e.Y8G("ngIf",2===t.tenderCreationStep),e.R7$(),e.Y8G("ngIf",3===t.tenderCreationStep)}}let be=(()=>{class n{constructor(){this.isOpen=!1,this.customerId="",this.tenderToEdit=null,this.closeModal=new e.bkB,this.tenderCreated=new e.bkB,this.tenderUpdated=new e.bkB,this.quoteService=(0,e.WQX)(E.K),this.notificationService=(0,e.WQX)(R.J),this.localStorage=(0,e.WQX)(F.s),this.providerService=(0,e.WQX)(Q),this.router=(0,e.WQX)(k.Ix),this.tenderProviders=[],this.selectedProviders=new Set,this.invitedProviders=[],this.tenderLoading=!1,this.tenderError=null,this.showGenericConfirm=!1,this.genericConfirmTitle="",this.genericConfirmMessage="",this.genericConfirmButtonText="Confirm",this.genericConfirmButtonClass="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",this.genericConfirmCallback=null,this.currentUserId=null,this.countriesOptions=[],this.categoriesOptions=[],this.complianceLevelsOptions=[],this._safeInvitedList=[],this.countriesCtrl=new u.MJ([],{nonNullable:!0}),this.categoriesCtrl=new u.MJ([],{nonNullable:!0}),this.complianceLevelsCtrl=new u.MJ([],{nonNullable:!0}),this.orgFilters={categories:[],countries:[],complianceLevels:[]},this.complianceLevelsName=U,this.countryName=B,this.availableProviders=[],this.tenderTitle="",this.expectedCompletionDate="",this.requestedCompletionDate="",this.expectedDateSet=!1,this.requestedDateSet=!1,this.selectedPdfFile=null,this.pdfAttachmentSet=!1,this.editingTenderId=null,this.existingAttachment=null,this.createdQuoteId=null,this.tenderCreationStep=1,this.TENDER_STEP2_DESCRIPTION=d.te}get minDate(){return(new Date).toISOString().split("T")[0]}ngOnInit(){if(this.customerId)this.currentUserId=this.customerId;else{const t=this.localStorage.getObject("login_items");if(t&&t.logged_as==t.id)this.currentUserId=t.partyId;else if(t&&t.logged_as){const o=t.organizations.find(r=>r.id==t.logged_as);this.currentUserId=o?.partyId}}this.loadFilterOptions()}ngOnChanges(t){t.tenderToEdit&&this.tenderToEdit&&this.loadTenderForEdit(this.tenderToEdit),t.isOpen&&this.isOpen&&this.tenderToEdit&&this.loadTenderForEdit(this.tenderToEdit)}loadTenderForEdit(t){this.editingTenderId=t.id||null,this.createdQuoteId=t.id||null,this.tenderTitle=t.tenderNote||"",t.expectedFulfillmentStartDate&&(this.requestedCompletionDate=this.formatDateForInput(t.expectedFulfillmentStartDate),this.requestedDateSet=!0),t.effectiveQuoteCompletionDate&&(this.expectedCompletionDate=this.formatDateForInput(t.effectiveQuoteCompletionDate),this.expectedDateSet=!0),t.attachment&&(this.existingAttachment=t.attachment,this.pdfAttachmentSet=!0),this.tenderCreationStep=2}formatDateForInput(t){try{const o=new Date(t),r=o.getFullYear();return`${r}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`}catch(o){return console.error("Error formatting date:",o),""}}closeTenderModal(){this.isOpen=!1,this.tenderCreationStep=1,this.selectedProviders.clear(),this.invitedProviders=[],this.tenderProviders=[],this.tenderError=null,this.editingTenderId=null,this.resetTenderForm(),this.closeModal.emit()}showConfirmation(t,o,r,i="Confirm",s="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"){this.genericConfirmTitle=t,this.genericConfirmMessage=o,this.genericConfirmButtonText=i,this.genericConfirmButtonClass=s,this.genericConfirmCallback=()=>{r(),this.showGenericConfirm=!1},this.showGenericConfirm=!0}resetTenderForm(){this.tenderTitle="",this.expectedCompletionDate="",this.requestedCompletionDate="",this.expectedDateSet=!1,this.requestedDateSet=!1,this.existingAttachment=null,this.createdQuoteId=null,this.selectedPdfFile=null,this.pdfAttachmentSet=!1,this.invitedProviders=[]}saveInitialTender(){this.tenderTitle.trim()?this.currentUserId?(this.tenderLoading=!0,this.quoteService.createCoordinatorQuote(this.currentUserId,this.tenderTitle.trim()).subscribe({next:t=>{console.log("Coordinator tender created:",t),this.createdQuoteId=t.id||null,this.editingTenderId=t.id||null,this.notificationService.showSuccess("Tender created! Now set the completion dates."),this.tenderLoading=!1,this.tenderCreationStep=2},error:t=>{console.error("Error creating tender:",t),this.notificationService.showError("Failed to create tender: "+(t.message||"Unknown error")),this.tenderLoading=!1}})):this.notificationService.showError("User not logged in"):this.notificationService.showError("Tender title is required")}formatDateForAPI(t){if(!t)return"";const[o,r,i]=t.split("-");return`${i}-${r}-${o}`}setExpectedDate(){if(!this.expectedCompletionDate||!this.createdQuoteId)return void this.notificationService.showError("Please select a date");this.tenderLoading=!0;const t=this.formatDateForAPI(this.expectedCompletionDate);this.quoteService.updateQuoteDate(this.createdQuoteId,t,"effective").subscribe({next:o=>{this.expectedDateSet=!0,this.notificationService.showSuccess("Effective completion date set successfully!"),this.tenderLoading=!1,this.tenderUpdated.emit()},error:o=>{console.error("Error setting effective date:",o),this.notificationService.showError("Failed to set effective date: "+(o.message||"Unknown error")),this.tenderLoading=!1}})}setRequestedDate(){if(!this.requestedCompletionDate||!this.createdQuoteId)return void this.notificationService.showError("Please select a date");this.tenderLoading=!0;const t=this.formatDateForAPI(this.requestedCompletionDate);this.quoteService.updateQuoteDate(this.createdQuoteId,t,"expectedFulfillment").subscribe({next:o=>{this.requestedDateSet=!0,this.notificationService.showSuccess("Expected fulfillment start date set successfully!"),this.tenderLoading=!1,this.tenderUpdated.emit()},error:o=>{console.error("Error setting expected fulfillment date:",o),this.notificationService.showError("Failed to set expected fulfillment date: "+(o.message||"Unknown error")),this.tenderLoading=!1}})}onPdfFileSelected(t){const o=t.target,r=o.files?.[0];if(r){if("application/pdf"!==r.type)return this.notificationService.showError("Please select a valid PDF file"),this.selectedPdfFile=null,void(o.value="");this.selectedPdfFile=r,console.log("PDF file selected:",r.name)}else this.selectedPdfFile=null}setPdfAttachment(){this.selectedPdfFile&&this.createdQuoteId?(this.tenderLoading=!0,this.quoteService.addAttachmentToQuote(this.createdQuoteId,this.selectedPdfFile,"").subscribe({next:t=>{if(this.pdfAttachmentSet=!0,t.quoteItem&&t.quoteItem.length>0){const r=t.quoteItem[0];if(r.attachment&&r.attachment.length>0){const i=r.attachment[0];this.existingAttachment={name:i.name||"attachment.pdf",mimeType:i.mimeType||"application/pdf",content:i.content||"",size:i.size?.amount}}}this.selectedPdfFile=null;const o=document.getElementById("pdfFile");o&&(o.value=""),this.notificationService.showSuccess("PDF attachment uploaded successfully!"),this.tenderLoading=!1},error:t=>{console.error("Error uploading PDF:",t),this.notificationService.showError("Failed to upload PDF: "+(t.message||"Unknown error")),this.tenderLoading=!1}})):this.notificationService.showError("Please select a PDF file")}isStep2Complete(){return!(!this.requestedCompletionDate||!this.expectedCompletionDate||!this.selectedPdfFile&&!this.existingAttachment)}proceedToProviderSelection(){if(!this.isStep2Complete()||!this.createdQuoteId)return;this.tenderLoading=!0;const t=this.formatDateForAPI(this.requestedCompletionDate),o=this.formatDateForAPI(this.expectedCompletionDate);this.quoteService.updateQuoteDate(this.createdQuoteId,t,"expectedFulfillment").pipe((0,x.n)(()=>this.quoteService.updateQuoteDate(this.createdQuoteId,o,"effective")),(0,x.n)(()=>this.selectedPdfFile?this.quoteService.addAttachmentToQuote(this.createdQuoteId,this.selectedPdfFile,""):(0,f.of)(null))).subscribe({next:()=>{this.tenderLoading=!1,this.notificationService.showSuccess("Tender details saved successfully!"),this.tenderCreationStep=3,this.loadTenderProviders()},error:r=>{this.tenderLoading=!1,this.notificationService.showError("Failed to save tender details. Please try again."),console.error("Error saving tender step 2:",r)}})}loadTenderProviders(){this.tenderLoading=!0,this.tenderError=null,console.log("Loading providers from API..."),this.providerService.getProvidersForTenderNew(this.orgFilters).subscribe({next:t=>{t&&0!==t.length?(this.tenderProviders=t,console.log("Search loaded providers:",t.length),this.tenderLoading=!1,this.updateAvailableProviders(),3===this.tenderCreationStep&&this.loadInvitedProviders()):(console.log("Search returned no providers, trying fallback endpoint..."),this.providerService.getProvidersForTender().subscribe({next:o=>{this.tenderProviders=o,console.log("Fallback loaded providers:",o.length),this.tenderLoading=!1,this.updateAvailableProviders(),3===this.tenderCreationStep&&this.loadInvitedProviders()},error:o=>{this.tenderError="Failed to load providers from both endpoints: "+(o.message||"Unknown error"),this.tenderLoading=!1,console.error("Fallback endpoint also failed:",o)}}))},error:t=>{console.warn("Search endpoint failed, trying fallback...",t),this.providerService.getProvidersForTender().subscribe({next:o=>{this.tenderProviders=o,console.log("Fallback loaded providers:",o.length),this.tenderLoading=!1,this.updateAvailableProviders(),3===this.tenderCreationStep&&this.loadInvitedProviders()},error:o=>{this.tenderError="Failed to load providers: "+(o.message||"Unknown error"),this.tenderLoading=!1,console.error("Error loading tender providers:",o)}})}})}emitFilters(){const t={countries:this.countriesCtrl.value??[],categories:this.categoriesCtrl.value??[],complianceLevels:this.complianceLevelsCtrl.value??[]};console.log(t),this.orgFilters=t,this.loadTenderProviders()}hasActiveFilters(){return 0==(this.orgFilters.countries?.length??0)&&0==(this.orgFilters.categories?.length??0)&&0==(this.orgFilters.complianceLevels?.length??0)}clearFilters(){this.countriesCtrl.setValue([],{emitEvent:!0}),this.categoriesCtrl.setValue([],{emitEvent:!0}),this.complianceLevelsCtrl.setValue([],{emitEvent:!0}),this.emitFilters()}toggleProviderSelection(t){const o=this._safeInvitedList.findIndex(r=>r?.id===t);if(o>=0)this._safeInvitedList.splice(o,1);else{const r=this.tenderProviders.find(i=>i.id===t);r&&this._safeInvitedList.push(r)}this.rebuildSelectionAndAvailable()}rebuildSelectionAndAvailable(){this.selectedProviders=new Set(this._safeInvitedList.map(r=>r?.id).filter(r=>!!r));const t=new Set([...this.invitedProviders.map(r=>r?.provider?.id).filter(r=>!!r),...Array.from(this.selectedProviders)]),o=this.tenderProviders.filter(r=>!!r?.id&&!t.has(r.id)).map(r=>({...r}));return this.availableProviders=o,o}loadInvitedProviders(){this.createdQuoteId&&this.currentUserId?(console.log("Loading invited providers for externalId:",this.createdQuoteId),this.tenderLoading=!0,this.quoteService.getTenderingQuotesByUser(this.currentUserId,p.XZ.BUYER).subscribe({next:t=>{console.log("Received tenders:",t),this.invitedProviders=[],t.filter(r=>r.external_id===this.createdQuoteId).forEach(r=>{const i={id:r.provider||void 0,tradingName:r.provider||"Unknown Provider"};r.id&&(this.invitedProviders.push({provider:i,quoteId:r.id}),console.log("Added invited provider:",i.tradingName,"with quote ID:",r.id))}),console.log("Total invited providers loaded:",this.invitedProviders.length),this.tenderLoading=!1},error:t=>{console.error("Error loading invited providers:",t),this.tenderLoading=!1}})):console.log("No coordinator quote ID or user ID, skipping invited providers load")}backToStep2(){this.tenderCreationStep=2}formatDateForDisplay(t){if(!t)return"";const o=t.split("-");if(3===o.length){const[r,i,s]=o;return`${s}/${i}/${r}`}return t}updateAvailableProviders(){this.availableProviders=this.getAvailableProviders()}getAvailableProviders(){return this.rebuildSelectionAndAvailable()}saveProvidersList(){if(0===this.selectedProviders.size)return void this.notificationService.showError("Please select at least one provider");if(!this.createdQuoteId||!this.currentUserId)return void this.notificationService.showError("Coordinator quote not found. Please start over.");this.tenderLoading=!0;const t=Array.from(this.selectedProviders),o=this.tenderTitle;console.log("Creating tendering quotes for providers:",t);const r=t.map(i=>{const s=this._safeInvitedList.find(l=>l.id===i);return this.quoteService.createTenderingQuote(this.currentUserId,i,this.createdQuoteId,o).toPromise().then(l=>{if(!l||!l.id||!s)throw new Error("Failed to create quote for provider");return{provider:s,quoteId:l.id}})});Promise.all(r).then(i=>{console.log("Tendering quotes created:",i),this.invitedProviders.push(...i),this.selectedProviders.clear(),this._safeInvitedList=[],this.notificationService.showSuccess(`${t.length} provider(s) has been saved for invite`),this.tenderLoading=!1}).catch(i=>{console.error("Error creating tendering quotes:",i),this.notificationService.showError("Failed to invite providers: "+(i.message||"Unknown error")),this.tenderLoading=!1})}removeInvitedProvider(t,o){o&&this.showConfirmation("Remove Provider","Are you sure you want to remove this provider invitation? This will delete the quote.",()=>{this.tenderLoading=!0,this.quoteService.deleteQuote(t).subscribe({next:()=>{console.log("Quote deleted for provider:",o),this.invitedProviders=this.invitedProviders.filter(r=>r.quoteId!==t),this.notificationService.showSuccess("Provider invitation removed successfully"),this.tenderLoading=!1},error:r=>{console.error("Error deleting quote:",r),this.notificationService.showError("Failed to remove provider invitation: "+(r.message||"Unknown error")),this.tenderLoading=!1}})},"Remove","px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500")}finalizeTender(){0!==this.invitedProviders.length?this.createdQuoteId?this.showConfirmation("Finalize Tender","Are you sure you want to finalize the tender? This will notify all invited providers.",()=>this.executeFinalizeTender(),"Finalize","px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"):this.notificationService.showError("Coordinator quote not found"):this.notificationService.showError("Please invite at least one provider first")}executeFinalizeTender(){this.tenderLoading=!0,this.quoteService.getQuoteById(this.createdQuoteId).pipe((0,x.n)(t=>{console.log("Coordinator quote retrieved:",t);const o=this.formatDateForAPI(this.expectedCompletionDate),r=this.formatDateForAPI(this.requestedCompletionDate);console.log(`Copying dates to ${this.invitedProviders.length} provider quotes`);const i=this.invitedProviders.flatMap(s=>{const l=s.quoteId;return[this.quoteService.updateQuoteDate(l,o,"expected"),this.quoteService.updateQuoteDate(l,r,"requested")]});return 0===i.length?(0,f.of)([]):(0,y.p)(i)}),(0,x.n)(t=>(console.log(`Successfully updated dates for ${t.length/2} provider quotes`),this.quoteService.updateQuoteStatus(this.createdQuoteId,"inProgress")))).subscribe({next:t=>{console.log("Coordinator quote status updated to inProgress:",t),this.notificationService.showSuccess("Dates copied to all provider quotes and notifications sent to providers"),this.tenderLoading=!1,this.closeTenderModal(),this.tenderCreated.emit(t)},error:t=>{console.error("Error finalizing tender:",t),this.notificationService.showError("Failed to finalize tender: "+(t.message||"Unknown error")),this.tenderLoading=!1}})}loadFilterOptions(){this.clearFilters(),this.providerService.getFilterOptions().subscribe({next:({categories:t,countries:o,complianceLevels:r})=>{this.categoriesOptions=t??[],this.countriesOptions=o??[],this.complianceLevelsOptions=r??[]},error:t=>{console.warn("Failed to load filter options",t)}})}toggleFromSelect(t,o,r){r.preventDefault(),r.stopPropagation();const i=t.value??[],s=i.includes(o)?i.filter(l=>l!==o):[...i,o];t.setValue(s)}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-create-tender-modal"]],inputs:{isOpen:"isOpen",customerId:"customerId",tenderToEdit:"tenderToEdit"},outputs:{closeModal:"closeModal",tenderCreated:"tenderCreated",tenderUpdated:"tenderUpdated"},standalone:!0,features:[e.OA$,e.aNF],decls:2,vars:6,consts:[["filteredEmpty",""],["class","fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",3,"click",4,"ngIf"],[3,"confirm","cancel","isOpen","title","message","confirmText","confirmButtonClass"],[1,"fixed","inset-0","bg-gray-600","bg-opacity-50","overflow-y-auto","h-full","w-full","z-50",3,"click"],[1,"relative","top-10","mx-auto","p-5","border","w-11/12","md:w-3/4","lg:w-2/3","shadow-lg","rounded-md","bg-white","dark:bg-gray-800",3,"click"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-lg","font-bold","text-gray-900","dark:text-white"],[1,"text-gray-400","hover:text-gray-600","dark:hover:text-gray-300",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[4,"ngIf"],[1,"mb-6"],["for","tenderTitle",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-200","mb-2"],["type","text","id","tenderTitle","placeholder","Enter tender title or description...","autofocus","",1,"w-full","px-4","py-3","border","border-gray-300","dark:border-gray-600","dark:bg-gray-700","dark:text-white","rounded-lg","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-indigo-500","focus:border-transparent",3,"ngModelChange","ngModel"],[1,"mt-2","text-sm","text-gray-500","dark:text-gray-400"],[1,"flex","justify-end","space-x-3","mt-6","pt-4","border-t","border-gray-200","dark:border-gray-700"],[1,"bg-gray-100","dark:bg-gray-700","text-gray-700","dark:text-gray-200","px-4","py-2","rounded","hover:bg-gray-200","dark:hover:bg-gray-600",3,"click"],[1,"bg-indigo-600","text-white","px-4","py-2","rounded","hover:bg-indigo-700","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"mb-4","p-4","bg-gray-50","dark:bg-gray-700","rounded-lg","border","border-gray-200","dark:border-gray-600"],[1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-200","mb-2"],[1,"text-gray-900","dark:text-white","font-medium","break-words","overflow-wrap-anywhere"],[1,"mb-6","p-3","bg-yellow-50","dark:bg-yellow-900/20","border","border-yellow-200","dark:border-yellow-700","rounded-lg"],[1,"text-sm","text-yellow-800","dark:text-yellow-200"],["for","requestedDate",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-200","mb-2"],["type","date","id","requestedDate",1,"w-full","px-4","py-2","border","border-gray-300","dark:border-gray-600","dark:bg-gray-700","dark:text-white","rounded-lg","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-indigo-500","focus:border-transparent",3,"ngModelChange","ngModel","min"],[1,"mt-1","text-xs","text-gray-500","dark:text-gray-400"],["for","expectedDate",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-200","mb-2"],["type","date","id","expectedDate",1,"w-full","px-4","py-2","border","border-gray-300","dark:border-gray-600","dark:bg-gray-700","dark:text-white","rounded-lg","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-indigo-500","focus:border-transparent",3,"ngModelChange","ngModel","min"],["for","pdfFile",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-200","mb-2"],["class","mb-3 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg",4,"ngIf"],["type","file","id","pdfFile","accept",".pdf",1,"w-full","px-4","py-2","border","border-gray-300","dark:border-gray-600","dark:bg-gray-700","dark:text-white","rounded-lg","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-indigo-500","focus:border-transparent",3,"change"],[1,"bg-indigo-600","text-white","px-4","py-2","rounded","hover:bg-indigo-700","disabled:opacity-50","disabled:cursor-not-allowed","relative","group",3,"click","disabled","title"],["class","absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-1 bg-gray-900 text-white text-xs rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",4,"ngIf"],[1,"mb-3","p-3","bg-blue-50","dark:bg-blue-900/20","border","border-blue-200","dark:border-blue-700","rounded-lg"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","space-x-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-blue-600","dark:text-blue-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"text-sm","font-medium","text-blue-900","dark:text-blue-100"],[1,"text-sm","text-blue-700","dark:text-blue-300"],[1,"text-xs","font-medium","text-blue-600","dark:text-blue-400","bg-blue-100","dark:bg-blue-900","px-2","py-1","rounded"],[1,"text-xs","text-blue-600","dark:text-blue-400","mt-2"],[1,"absolute","bottom-full","left-1/2","transform","-translate-x-1/2","mb-2","px-3","py-1","bg-gray-900","text-white","text-xs","rounded","whitespace-nowrap","opacity-0","group-hover:opacity-100","transition-opacity","pointer-events-none"],[1,"mb-6","p-4","bg-gray-50","dark:bg-gray-700","rounded-lg","border","border-gray-200","dark:border-gray-600"],[1,"mb-6","p-4","bg-green-50","dark:bg-green-900/20","rounded-lg","border","border-green-200","dark:border-green-700"],[1,"text-sm","font-medium","text-green-900","dark:text-green-100","mb-2"],[1,"grid","grid-cols-2","gap-4","text-sm"],[1,"text-green-700","dark:text-green-300"],[1,"ml-2","font-medium","text-green-900","dark:text-green-100"],["class","mb-6 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-700",4,"ngIf"],["class","flex justify-center py-8",4,"ngIf"],["class","bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-md p-4 mb-4",4,"ngIf"],[1,"flex","justify-between","space-x-3","mt-6","pt-4","border-t","border-gray-200","dark:border-gray-700"],[1,"flex","space-x-3"],[1,"bg-green-600","text-white","px-4","py-2","rounded","hover:bg-green-700","disabled:opacity-50","disabled:cursor-not-allowed","relative","group",3,"click","disabled","title"],[1,"text-sm","text-green-700","dark:text-green-300"],[1,"flex","justify-center","py-8"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-indigo-600"],[1,"bg-red-50","dark:bg-red-900/20","border","border-red-200","dark:border-red-700","rounded-md","p-4","mb-4"],[1,"text-sm","text-red-700","dark:text-red-300"],["class","mb-6",4,"ngIf"],[1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-200","mb-3"],[1,"bg-white","dark:bg-gray-800","rounded-lg","shadow-sm"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6","items-start"],["multiple","",1,"block","w-full","rounded-md","border","border-gray-300","dark:border-gray-600","bg-white","dark:bg-gray-700","dark:text-white","px-3","py-2","text-sm","shadow-sm","focus:border-blue-500","focus:ring","focus:ring-blue-200",3,"formControl"],[3,"value","mousedown",4,"ngFor","ngForOf"],[1,"md:col-span-2","flex","justify-start","gap-x-2","mb-2","mt-2","md:mt-0"],["type","button",1,"bg-gray-100","dark:bg-gray-700","text-gray-700","dark:text-gray-200","px-4","py-2","rounded","hover:bg-gray-200","dark:hover:bg-gray-600",3,"click"],["type","button",1,"bg-indigo-600","text-white","px-4","py-2","rounded","hover:bg-indigo-700","disabled:opacity-50",3,"click"],[1,"max-h-96","overflow-y-auto","border","border-gray-300","dark:border-gray-600","rounded-lg"],["class","flex items-center p-4 hover:bg-gray-50 dark:hover:bg-gray-700 border-b border-gray-200 dark:border-gray-600 last:border-b-0",4,"ngFor","ngForOf"],["class","p-8 text-center text-gray-500 dark:text-gray-400",4,"ngIf"],[1,"max-h-64","overflow-y-auto","border","border-green-300","dark:border-green-700","rounded-lg","bg-green-50","dark:bg-green-900/20"],["class","flex items-center justify-between p-4 hover:bg-green-100 dark:hover:bg-green-900/30 border-b border-green-200 dark:border-green-700 last:border-b-0",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","p-4","hover:bg-green-100","dark:hover:bg-green-900/30","border-b","border-green-200","dark:border-green-700","last:border-b-0"],[1,"flex-1"],[1,"text-sm","font-medium","text-gray-900","dark:text-white"],["class","text-xs text-gray-500 dark:text-gray-400 mt-1",4,"ngIf"],["title","Remove invitation",1,"ml-4","p-2","text-red-600","hover:text-red-800","hover:bg-red-100","dark:hover:bg-red-900/30","rounded-full","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],[1,"text-xs","text-gray-500","dark:text-gray-400","mt-1"],[3,"mousedown","value"],[1,"flex","items-center","p-4","hover:bg-gray-50","dark:hover:bg-gray-700","border-b","border-gray-200","dark:border-gray-600","last:border-b-0"],["type","checkbox","class","h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded",3,"id","checked","change",4,"ngIf"],["class","ml-3 flex-1 cursor-pointer",3,"for",4,"ngIf"],["type","checkbox",1,"h-4","w-4","text-indigo-600","focus:ring-indigo-500","border-gray-300","rounded",3,"change","id","checked"],[1,"ml-3","flex-1","cursor-pointer",3,"for"],[1,"p-8","text-center","text-gray-500","dark:text-gray-400"],[4,"ngIf","ngIfElse"],[1,"text-sm"]],template:function(o,r){1&o&&(e.DNE(0,ve,11,4,"div",1),e.j41(1,"app-confirm-dialog",2),e.bIt("confirm",function(){return r.genericConfirmCallback&&r.genericConfirmCallback()})("cancel",function(){return r.showGenericConfirm=!1}),e.k0s()),2&o&&(e.Y8G("ngIf",r.isOpen),e.R7$(),e.Y8G("isOpen",r.showGenericConfirm)("title",r.genericConfirmTitle)("message",r.genericConfirmMessage)("confirmText",r.genericConfirmButtonText)("confirmButtonClass",r.genericConfirmButtonClass))},dependencies:[_.MD,_.Sq,_.bT,u.YN,u.xH,u.y7,u.me,u.W0,u.BC,u.vS,u.X1,u.l_,T.w],encapsulation:2})}return n})();function xe(n,a){if(1&n){const t=e.RV6();e.j41(0,"button",38),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.openCreateTenderModal())}),e.qSk(),e.j41(1,"svg",39),e.nrm(2,"path",40),e.k0s(),e.EFF(3," Create Tender "),e.k0s()}}function ye(n,a){1&n&&(e.j41(0,"div",41),e.nrm(1,"div",42),e.k0s())}function Ce(n,a){if(1&n&&(e.j41(0,"div",43)(1,"div",44)(2,"div",45),e.qSk(),e.j41(3,"svg",46),e.nrm(4,"path",47),e.k0s()(),e.joV(),e.j41(5,"div",48)(6,"h3",49),e.EFF(7,"Error loading quotes"),e.k0s(),e.j41(8,"p",50),e.EFF(9),e.k0s()()()()),2&n){const t=e.XpG();e.R7$(9),e.JRh(t.error)}}function ke(n,a){1&n&&(e.j41(0,"div",55),e.qSk(),e.j41(1,"svg",56),e.nrm(2,"path",57),e.k0s(),e.joV(),e.j41(3,"h3",58),e.EFF(4,"No tenders found"),e.k0s(),e.j41(5,"p",59),e.EFF(6,"No tender requests to display"),e.k0s()())}function Te(n,a){1&n&&(e.j41(0,"div",60)(1,"div",61)(2,"div",62),e.EFF(3,"REQUEST DATE"),e.k0s(),e.j41(4,"div",63),e.EFF(5,"CUSTOMER"),e.k0s(),e.j41(6,"div",64),e.EFF(7,"TITLE"),e.k0s(),e.j41(8,"div",65),e.EFF(9,"STATUS"),e.k0s(),e.j41(10,"div",62),e.EFF(11,"ACTIONS"),e.k0s()()())}function Se(n,a){1&n&&(e.j41(0,"div",60)(1,"div",66)(2,"div",65),e.EFF(3,"EXPAND"),e.k0s(),e.j41(4,"div",63),e.EFF(5,"TITLE"),e.k0s(),e.j41(6,"div",62),e.EFF(7,"STATUS"),e.k0s(),e.j41(8,"div",62),e.EFF(9,"TENDER START DATE"),e.k0s(),e.j41(10,"div",62),e.EFF(11,"TENDER END DATE"),e.k0s(),e.j41(12,"div",62),e.EFF(13,"ATTACHMENTS"),e.k0s(),e.j41(14,"div",64),e.EFF(15,"ACTIONS"),e.k0s()()())}function we(n,a){if(1&n){const t=e.RV6();e.j41(0,"div",68)(1,"div",69)(2,"div",70),e.EFF(3),e.nI1(4,"date"),e.k0s(),e.j41(5,"div",71),e.EFF(6),e.k0s(),e.j41(7,"div",72),e.EFF(8),e.k0s(),e.j41(9,"div",65)(10,"span",73),e.EFF(11),e.k0s()(),e.j41(12,"div",74)(13,"button",75),e.bIt("click",function(){const r=e.eBV(t).$implicit,i=e.XpG(3);return e.Njj(i.openChat(r))}),e.qSk(),e.j41(14,"svg",76),e.nrm(15,"path",77),e.k0s()(),e.joV(),e.j41(16,"button",78),e.bIt("click",function(){const r=e.eBV(t).$implicit,i=e.XpG(3);return e.Njj(i.viewDetails(r))}),e.EFF(17," Details "),e.qSk(),e.j41(18,"svg",79),e.nrm(19,"path",80),e.k0s()()()()()}if(2&n){const t=a.$implicit,o=e.XpG(3);e.R7$(),e.AVh("bg-gray-50",o.isQuoteFinalized(t))("dark:bg-gray-800",o.isQuoteFinalized(t))("hover:bg-gray-50",!o.isQuoteFinalized(t))("dark:hover:bg-gray-800",!o.isQuoteFinalized(t)),e.BMQ("data-quote-id",t.id),e.R7$(2),e.SpI(" ",e.i5U(4,23,t.quoteDate,"dd-MM-yyyy")," "),e.R7$(3),e.SpI(" ",o.getBuyerName(t)," "),e.R7$(),e.Y8G("title",t.description||"(no title)"),e.R7$(),e.SpI(" ",o.getTruncatedTitle(t.description)," "),e.R7$(2),e.Y8G("ngClass",o.getStateClass(o.getQuoteItemState(t))),e.R7$(),e.SpI(" ",o.getStatusLabel(t)," "),e.R7$(2),e.HbH(o.getIconButtonClass(t,"chat","text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200")),e.Y8G("disabled",o.isActionDisabled(t,"chat")),e.R7$(3),e.AVh("opacity-50",o.isActionDisabled(t,"viewDetails"))("cursor-not-allowed",o.isActionDisabled(t,"viewDetails")),e.Y8G("disabled",o.isActionDisabled(t,"viewDetails"))}}function Ie(n,a){if(1&n&&(e.qex(0),e.DNE(1,we,20,26,"div",67),e.bVm()),2&n){const t=e.XpG(2);e.R7$(),e.Y8G("ngForOf",t.filteredQuotes)}}function Ee(n,a){if(1&n){const t=e.RV6();e.j41(0,"button",94),e.bIt("click",function(){e.eBV(t);const r=e.XpG().$implicit,i=e.XpG(3);return e.Njj(i.toggleExpand(r))}),e.qSk(),e.j41(1,"svg",95),e.nrm(2,"path",96),e.k0s()()}if(2&n){const t=e.XpG().$implicit,o=e.XpG(3);e.Y8G("title",o.isExpanded(t.id)?"Collapse related quotes":"Expand to view related quotes"),e.R7$(),e.AVh("rotate-180",o.isExpanded(t.id))}}function Fe(n,a){if(1&n){const t=e.RV6();e.j41(0,"div",97)(1,"button",98),e.bIt("click",function(){e.eBV(t);const r=e.XpG().$implicit,i=e.XpG(3);return e.Njj(i.downloadAttachment(r))}),e.qSk(),e.j41(2,"svg",79),e.nrm(3,"path",99),e.k0s(),e.joV(),e.j41(4,"span",100),e.EFF(5),e.k0s()()()}if(2&n){const t=e.XpG().$implicit,o=e.XpG(3);e.R7$(),e.Y8G("disabled",o.isActionDisabled(t,"downloadAttachment")),e.R7$(4),e.JRh(o.getAttachmentName(t))}}function Re(n,a){if(1&n){const t=e.RV6();e.j41(0,"button",101),e.bIt("click",function(){e.eBV(t);const r=e.XpG().$implicit,i=e.XpG(3);return e.Njj(i.editTender(r))}),e.EFF(1," Edit "),e.k0s()}}function je(n,a){if(1&n){const t=e.RV6();e.j41(0,"button",102),e.bIt("click",function(){e.eBV(t);const r=e.XpG().$implicit,i=e.XpG(3);return e.Njj(i.openBroadcastModal(r))}),e.EFF(1," Broadcast "),e.k0s()}}function De(n,a){if(1&n){const t=e.RV6();e.j41(0,"button",103),e.bIt("click",function(){e.eBV(t);const r=e.XpG().$implicit,i=e.XpG(3);return e.Njj(i.simulateStartTender(r))}),e.qSk(),e.j41(1,"svg",104),e.nrm(2,"path",105),e.k0s(),e.EFF(3," Start "),e.k0s()}}function Me(n,a){if(1&n){const t=e.RV6();e.j41(0,"button",106),e.bIt("click",function(){e.eBV(t);const r=e.XpG().$implicit,i=e.XpG(3);return e.Njj(i.simulateCloseTender(r))}),e.qSk(),e.j41(1,"svg",104),e.nrm(2,"path",107),e.k0s(),e.EFF(3," Close "),e.k0s()}}function $e(n,a){1&n&&(e.j41(0,"div",114),e.nrm(1,"div",115),e.j41(2,"span",116),e.EFF(3,"Loading related quotes..."),e.k0s()())}function Pe(n,a){if(1&n){const t=e.RV6();e.j41(0,"button",129),e.bIt("click",function(){e.eBV(t);const r=e.XpG().$implicit,i=e.XpG(6);return e.Njj(i.downloadAttachment(r))}),e.qSk(),e.j41(1,"svg",79),e.nrm(2,"path",99),e.k0s(),e.joV(),e.j41(3,"span",130),e.EFF(4),e.k0s()()}if(2&n){const t=e.XpG().$implicit,o=e.XpG(6);e.R7$(4),e.JRh(o.getAttachmentName(t))}}function Ae(n,a){if(1&n){const t=e.RV6();e.j41(0,"div",121)(1,"div",122)(2,"div",123),e.EFF(3),e.k0s(),e.j41(4,"div",62)(5,"span",124),e.EFF(6),e.k0s()(),e.j41(7,"div",63),e.DNE(8,Pe,5,1,"button",125),e.k0s(),e.j41(9,"div",126)(10,"button",127),e.bIt("click",function(){const r=e.eBV(t).$implicit,i=e.XpG(6);return e.Njj(i.openChat(r))}),e.qSk(),e.j41(11,"svg",79),e.nrm(12,"path",77),e.k0s()(),e.joV(),e.j41(13,"button",128),e.bIt("click",function(){const r=e.eBV(t).$implicit,i=e.XpG(6);return e.Njj(i.viewDetails(r))}),e.EFF(14," Details "),e.qSk(),e.j41(15,"svg",104),e.nrm(16,"path",80),e.k0s()()()()()}if(2&n){const t=a.$implicit,o=a.last,r=e.XpG(6);e.AVh("border-b",!o)("border-gray-200",!o)("dark:border-gray-600",!o),e.R7$(3),e.SpI(" ",r.getProviderName(t)," "),e.R7$(2),e.Y8G("ngClass",r.getStateClass(r.getQuoteItemState(t))),e.R7$(),e.SpI(" ",r.getStatusLabel(t)," "),e.R7$(2),e.Y8G("ngIf",r.hasAttachment(t))}}function Le(n,a){if(1&n&&(e.j41(0,"div",117)(1,"div",118)(2,"div",119)(3,"div",64),e.EFF(4,"Provider"),e.k0s(),e.j41(5,"div",62),e.EFF(6,"Status"),e.k0s(),e.j41(7,"div",63),e.EFF(8,"Attachments"),e.k0s(),e.j41(9,"div",63),e.EFF(10,"Actions"),e.k0s()()(),e.DNE(11,Ae,17,10,"div",120),e.k0s()),2&n){const t=e.XpG(2).$implicit,o=e.XpG(3);e.R7$(11),e.Y8G("ngForOf",o.getRelatedQuotes(t.id))}}function Ge(n,a){1&n&&(e.j41(0,"div",131),e.qSk(),e.j41(1,"svg",132),e.nrm(2,"path",57),e.k0s(),e.joV(),e.j41(3,"p"),e.EFF(4,"No related provider quotes found"),e.k0s()())}function Qe(n,a){if(1&n&&(e.j41(0,"div",108)(1,"div",109)(2,"h4",110),e.EFF(3,"Related Provider Quotes"),e.k0s(),e.DNE(4,$e,4,0,"div",111)(5,Le,12,1,"div",112)(6,Ge,5,0,"div",113),e.k0s()()),2&n){const t=e.XpG().$implicit,o=e.XpG(3);e.R7$(4),e.Y8G("ngIf",o.isLoadingRelatedQuotes(t.id)),e.R7$(),e.Y8G("ngIf",!o.isLoadingRelatedQuotes(t.id)&&o.getRelatedQuotes(t.id).length>0),e.R7$(),e.Y8G("ngIf",!o.isLoadingRelatedQuotes(t.id)&&0===o.getRelatedQuotes(t.id).length)}}function qe(n,a){if(1&n){const t=e.RV6();e.j41(0,"div",68)(1,"div",81)(2,"div",82),e.DNE(3,Ee,3,3,"button",83),e.k0s(),e.j41(4,"div",84),e.EFF(5),e.k0s(),e.j41(6,"div",62)(7,"span",73),e.EFF(8),e.k0s()(),e.j41(9,"div",70),e.EFF(10),e.nI1(11,"date"),e.k0s(),e.j41(12,"div",70),e.EFF(13),e.nI1(14,"date"),e.k0s(),e.j41(15,"div",85),e.DNE(16,Fe,6,2,"div",86),e.k0s(),e.j41(17,"div",87)(18,"button",88),e.bIt("click",function(){const r=e.eBV(t).$implicit,i=e.XpG(3);return e.Njj(i.viewDetails(r))}),e.EFF(19," Details "),e.qSk(),e.j41(20,"svg",79),e.nrm(21,"path",80),e.k0s()(),e.DNE(22,Re,2,0,"button",89)(23,je,2,0,"button",90)(24,De,4,0,"button",91)(25,Me,4,0,"button",92),e.k0s()(),e.DNE(26,Qe,7,3,"div",93),e.k0s()}if(2&n){const t=a.$implicit,o=e.XpG(3);e.R7$(),e.AVh("bg-gray-50",o.isQuoteFinalized(t))("dark:bg-gray-800",o.isQuoteFinalized(t))("hover:bg-gray-50",!o.isQuoteFinalized(t))("dark:hover:bg-gray-800",!o.isQuoteFinalized(t)),e.BMQ("data-quote-id",t.id),e.R7$(2),e.Y8G("ngIf",o.isCoordinatorExpandable(t)),e.R7$(),e.Y8G("title",t.description||"(no title)"),e.R7$(),e.SpI(" ",o.getTruncatedTitle(t.description)," "),e.R7$(2),e.Y8G("ngClass",o.getStateClass(o.getQuoteItemState(t))),e.R7$(),e.SpI(" ",o.getStatusLabel(t)," "),e.R7$(2),e.SpI(" ",e.i5U(11,22,t.expectedFulfillmentStartDate,"dd/MM/yyyy")," "),e.R7$(3),e.SpI(" ",e.i5U(14,25,t.effectiveQuoteCompletionDate,"dd/MM/yyyy")," "),e.R7$(3),e.Y8G("ngIf",o.hasAttachment(t)),e.R7$(6),e.Y8G("ngIf",t.category===o.QUOTE_CATEGORIES.COORDINATOR&&!o.isCoordinatorExpandable(t)),e.R7$(),e.Y8G("ngIf",t.category===o.QUOTE_CATEGORIES.COORDINATOR&&o.isCoordinatorExpandable(t)&&o.isExpanded(t.id)),e.R7$(),e.Y8G("ngIf",t.category===o.QUOTE_CATEGORIES.COORDINATOR&&o.getPrimaryState(t)===o.QUOTE_STATUSES.IN_PROGRESS),e.R7$(),e.Y8G("ngIf",t.category===o.QUOTE_CATEGORIES.COORDINATOR&&o.getPrimaryState(t)===o.QUOTE_STATUSES.APPROVED),e.R7$(),e.Y8G("ngIf",o.isExpanded(t.id))}}function Ne(n,a){if(1&n&&(e.qex(0),e.DNE(1,qe,27,28,"div",67),e.bVm()),2&n){const t=e.XpG(2);e.R7$(),e.Y8G("ngForOf",t.filteredQuotes)}}function Be(n,a){if(1&n&&(e.j41(0,"div",51),e.DNE(1,ke,7,0,"div",52)(2,Te,12,0,"div",53)(3,Se,16,0,"div",53)(4,Ie,2,1,"ng-container",54)(5,Ne,2,1,"ng-container",54),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngIf",0===t.filteredQuotes.length),e.R7$(),e.Y8G("ngIf",t.filteredQuotes.length>0&&t.selectedRole===t.UI_ROLES.SELLER),e.R7$(),e.Y8G("ngIf",t.filteredQuotes.length>0&&t.selectedRole===t.UI_ROLES.BUYER),e.R7$(),e.Y8G("ngIf",t.selectedRole===t.UI_ROLES.SELLER),e.R7$(),e.Y8G("ngIf",t.selectedRole===t.UI_ROLES.BUYER)}}function Ue(n,a){if(1&n){const t=e.RV6();e.j41(0,"div",142)(1,"input",143),e.mxI("ngModelChange",function(r){e.eBV(t);const i=e.XpG(2);return e.DH7(i.selectedState,r)||(i.selectedState=r),e.Njj(r)}),e.k0s(),e.j41(2,"label",144),e.EFF(3),e.k0s()()}if(2&n){const t=a.$implicit,o=e.XpG(2);e.R7$(),e.Y8G("id","state-"+t),e.R50("ngModel",o.selectedState),e.Y8G("value",t),e.R7$(),e.Y8G("for","state-"+t),e.R7$(),e.SpI(" ",o.getStateDisplay(t)," ")}}function Oe(n,a){if(1&n){const t=e.RV6();e.j41(0,"div",133)(1,"div",134)(2,"div",135)(3,"h3",136),e.EFF(4,"Update Quote State"),e.k0s(),e.j41(5,"div",137),e.DNE(6,Ue,4,5,"div",138),e.k0s(),e.j41(7,"div",139)(8,"button",140),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.showStateUpdate=!1)}),e.EFF(9," Cancel "),e.k0s(),e.j41(10,"button",141),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.confirmStateUpdate())}),e.EFF(11," Update "),e.k0s()()()()()}if(2&n){const t=e.XpG();e.R7$(6),e.Y8G("ngForOf",t.availableStates),e.R7$(4),e.Y8G("disabled",!t.selectedState)}}function Ye(n,a){if(1&n){const t=e.RV6();e.j41(0,"div",133)(1,"div",134)(2,"div",145)(3,"h3",136),e.EFF(4,"Broadcast Message"),e.k0s(),e.j41(5,"textarea",146),e.mxI("ngModelChange",function(r){e.eBV(t);const i=e.XpG();return e.DH7(i.broadcastMessage,r)||(i.broadcastMessage=r),e.Njj(r)}),e.k0s(),e.j41(6,"div",147)(7,"button",140),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.closeBroadcastModal())}),e.EFF(8," Cancel "),e.k0s(),e.j41(9,"button",148),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.sendBroadcastMessage())}),e.EFF(10),e.k0s()()()()()}if(2&n){const t=e.XpG();e.R7$(5),e.R50("ngModel",t.broadcastMessage),e.R7$(4),e.Y8G("disabled",!t.broadcastMessage||t.isBroadcastSending),e.R7$(),e.SpI(" ",t.isBroadcastSending?"Sending...":"Send"," ")}}let M=(()=>{class n{constructor(){this.router=(0,e.WQX)(k.Ix),this.quoteService=(0,e.WQX)(E.K),this.localStorage=(0,e.WQX)(F.s),this.notificationService=(0,e.WQX)(R.J),this.accountService=(0,e.WQX)(P.O),this.quotes=[],this.filteredQuotes=[],this.loading=!1,this.error=null,this.showDeleteConfirm=!1,this.deleteConfirmMessage="",this.quoteToDelete=null,this.showStateUpdate=!1,this.quoteToUpdate=null,this.selectedState=null,this.availableStates=["pending","inProgress","approved","rejected","cancelled","accepted"],this.selectedRole=p.Zk.BUYER,this.currentUserId=null,this.UI_ROLES=p.Zk,this.QUOTE_CATEGORIES=d.K0,this.QUOTE_STATUSES=d.yz,this.statusFilter="",this.showQuoteDetailsModal=!1,this.selectedQuoteId=null,this.showChatModal=!1,this.selectedChatQuoteId=null,this.showAttachmentModal=!1,this.selectedAttachmentQuote=null,this.showBroadcastModal=!1,this.broadcastForCoordinatorId=null,this.broadcastMessage="",this.showGenericConfirm=!1,this.genericConfirmTitle="",this.genericConfirmMessage="",this.genericConfirmButtonText="Confirm",this.genericConfirmButtonClass="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",this.genericConfirmCallback=null,this.isBroadcastSending=!1,this.showCreateTenderModal=!1,this.tenderToEdit=null,this.expandedQuoteIds=new Set,this.relatedQuotesMap=new Map,this.loadingRelatedQuotes=new Set,this.coordinatorQuoteStatesMap=new Map,this.loadingCoordinatorStates=new Set,this.organizationNames=new Map}ngOnInit(){let t=this.localStorage.getObject("login_items");if(t&&t.logged_as==t.id)this.currentUserId=t.partyId;else if(t&&t.logged_as){let o=t.organizations.find(r=>r.id==t.logged_as);this.currentUserId=o?.partyId}this.currentUserId?this.loadQuotes():this.error="User not authenticated"}loadQuotes(){if(!this.currentUserId)return void(this.error="User not authenticated");let t;this.loading=!0,this.error=null,t=this.selectedRole===p.Zk.BUYER?this.quoteService.getCoordinatorQuotesByUser(this.currentUserId).pipe((0,h.T)(o=>o.map(r=>this.mapTenderToQuote(r)))):this.quoteService.getTenderingQuotesByUser(this.currentUserId,(0,p.E9)(this.selectedRole)).pipe((0,h.T)(o=>o.map(r=>this.mapTenderToQuote(r)))),t.subscribe({next:o=>{this.quotes=o,this.enrichQuoteData(o),console.log(`Loaded ${this.quotes.length} quotes as ${this.selectedRole}`),console.log(`Current user ID: ${this.currentUserId}`),this.quotes.forEach(r=>{if(console.log(`Quote ${this.extractShortId(r.id)}:`,{category:r.category,state:r.state,quoteItemState:this.getQuoteItemState(r),externalId:r.externalId,id:r.id,relatedParty:r.relatedParty}),this.selectedRole===p.Zk.SELLER){const i=r.relatedParty?.some(s=>s.id===this.currentUserId&&s.role?.toLowerCase()===p.Zk.SELLER);console.log(`  -> Quote ${this.extractShortId(r.id)} related to current provider? ${i}`)}}),this.selectedRole===p.Zk.SELLER?this.loadCoordinatorStatesForTenderingQuotes().subscribe({next:()=>{console.log("All coordinator states loaded, filtering quotes..."),this.filterQuotesByStatus(),this.loading=!1},error:r=>{console.error("Error loading coordinator states:",r),this.filterQuotesByStatus(),this.loading=!1}}):(this.filterQuotesByStatus(),this.loading=!1)},error:o=>{console.error("Failed to load quotes:",o),this.error="Failed to load quotes. Please try again.",this.loading=!1}})}mapTenderToQuote(t){const o={state:this.mapTenderStateToQuoteState(t.state)};return t.attachment&&(o.attachment=[{name:t.attachment.name,mimeType:t.attachment.mimeType,content:t.attachment.content,size:t.attachment.size?{amount:t.attachment.size,units:"bytes"}:void 0}]),{id:t.id,href:"",description:t.tenderNote||"",quoteDate:t.createdAt||(new Date).toISOString(),effectiveQuoteCompletionDate:t.effectiveQuoteCompletionDate,expectedFulfillmentStartDate:t.expectedFulfillmentStartDate,state:this.mapTenderStateToQuoteState(t.state),category:"tendering"===t.category?d.K0.TENDER:d.K0.COORDINATOR,externalId:t.external_id,relatedParty:[...t.selectedProviders.map(r=>({id:r,role:"Seller",name:t.provider,"@referredType":"Organization"})),...t.buyerPartyId?[{id:t.buyerPartyId,role:"Buyer","@referredType":"Organization"}]:[]],quoteItem:[o],note:[]}}mapTenderStateToQuoteState(t){switch(t){case"draft":case"pending":default:return"pending";case"pre-launched":return"inProgress";case"sent":return"approved";case"closed":return"accepted"}}refreshQuotes(){this.loadQuotes()}selectRole(t){this.selectedRole=t,this.loadQuotes()}getRoleTabClass(t){return this.selectedRole===t?"bg-white dark:bg-gray-600 text-indigo-600 dark:text-blue-400 shadow-sm":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-200"}filterQuotesByStatus(){let t;t=this.statusFilter?this.quotes.filter(o=>this.getPrimaryState(o)===this.statusFilter):[...this.quotes],this.filteredQuotes=this.selectedRole===p.Zk.SELLER?t.filter(o=>{if(o.category!==d.K0.TENDER)return console.log(`[FILTER] Quote ${this.extractShortId(o.id)} - category: ${o.category}, keeping (not tender)`),!0;if(!o.externalId)return console.log(`[FILTER] Tendering quote ${this.extractShortId(o.id)} - no externalId, keeping`),!0;const r=this.coordinatorQuoteStatesMap.get(o.externalId);if(console.log(`[FILTER] Tendering quote ${this.extractShortId(o.id)} - coordinator: ${this.extractShortId(o.externalId)}, state: ${r||"NOT_LOADED"}`),!r)return console.log(`[FILTER] Coordinator state not loaded yet for ${this.extractShortId(o.externalId)}, hiding`),!1;const i=r!==d.yz.PENDING;return console.log(`[FILTER] Coordinator state is ${r}, ${i?"SHOWING":"HIDING"} quote`),i}):t}viewDetails(t){this.selectedQuoteId=t.id,this.showQuoteDetailsModal=!0}editTender(t){let o;if(Array.isArray(t.quoteItem)&&t.quoteItem.length>0){const s=t.quoteItem[0];if(Array.isArray(s.attachment)&&s.attachment.length>0){const l=s.attachment[0];o={name:l.name||"attachment.pdf",mimeType:l.mimeType||"application/pdf",content:l.content||"",size:l.size?.amount}}}const r=this.getPrimaryState(t),i={id:t.id,category:t.category===d.K0.COORDINATOR?"coordinator":"tendering",state:this.mapQuoteStateToTenderState(r),responseDeadline:t.expectedFulfillmentStartDate||t.effectiveQuoteCompletionDate||(new Date).toISOString(),tenderNote:t.description||"",attachment:o,selectedProviders:t.relatedParty?.filter(s=>"seller"===s.role?.toLowerCase()).map(s=>s.id)||[],effectiveQuoteCompletionDate:t.effectiveQuoteCompletionDate,expectedFulfillmentStartDate:t.expectedFulfillmentStartDate};this.tenderToEdit=i,this.showCreateTenderModal=!0}mapQuoteStateToTenderState(t){if(!t)return"draft";switch(t){case"pending":default:return"draft";case"inProgress":return"pre-launched";case"approved":return"sent";case"accepted":case"cancelled":case"rejected":return"closed"}}viewQuote(t){this.selectedQuoteId=t.id,this.showQuoteDetailsModal=!0}closeQuoteDetailsModal(){this.showQuoteDetailsModal=!1,this.selectedQuoteId=null}showConfirmation(t,o,r,i="Confirm",s="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"){this.genericConfirmTitle=t,this.genericConfirmMessage=o,this.genericConfirmButtonText=i,this.genericConfirmButtonClass=s,this.genericConfirmCallback=()=>{r(),this.showGenericConfirm=!1},this.showGenericConfirm=!0}getModalUserRole(){return this.selectedRole===p.Zk.BUYER?"customer":"seller"}onQuoteUpdated(t){for(const[s,l]of this.relatedQuotesMap.entries())if(l.some(m=>m.id===t.id)){const m=this.quotes.find(C=>C.id===s);m&&this.loadRelatedQuotes(m);const b=this.extractShortId(t.id),g=this.getPrimaryState(t);return void this.notificationService.showSuccess(`Quote ${b} has been updated to ${g}.`)}const o=this.quotes.findIndex(s=>s.id===t.id);-1!==o&&(this.quotes[o]=t,this.filterQuotesByStatus());const r=this.extractShortId(t.id),i=this.getPrimaryState(t);this.notificationService.showSuccess(`Quote ${r} has been updated to ${i}.`)}closeChatModal(){this.showChatModal=!1,this.selectedChatQuoteId=null}closeAttachmentModal(){this.showAttachmentModal=!1,this.selectedAttachmentQuote=null}openBroadcastModal(t){t.id&&(this.broadcastForCoordinatorId=t.id,this.broadcastMessage="",this.showBroadcastModal=!0)}closeBroadcastModal(){this.showBroadcastModal=!1,this.broadcastForCoordinatorId=null,this.broadcastMessage="",this.isBroadcastSending=!1}openCreateTenderModal(){this.currentUserId?this.showCreateTenderModal=!0:this.notificationService.showError("You must be logged in to create a tender.")}closeCreateTenderModal(){this.showCreateTenderModal=!1,this.tenderToEdit=null}onTenderCreated(t){console.log("Tender created successfully:",t),this.loadQuotes(),this.notificationService.showSuccess("Tender created successfully!")}onTenderUpdated(){this.loadQuotes()}sendBroadcastMessage(){!this.broadcastForCoordinatorId||!this.currentUserId||!this.broadcastMessage||this.showConfirmation("Broadcast Message","Are you sure you want to broadcast this message to all the invited providers?",()=>this.executeBroadcastMessage(),"Send","px-4 py-2 text-sm font-medium text-white bg-fuchsia-600 border border-transparent rounded-md hover:bg-fuchsia-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-fuchsia-500")}executeBroadcastMessage(){this.isBroadcastSending=!0;const t=this.getRelatedQuotes(this.broadcastForCoordinatorId);if(!t||0===t.length){const i=this.quotes.find(s=>s.id===this.broadcastForCoordinatorId);i&&this.loadRelatedQuotes(i)}const o=this.getRelatedQuotes(this.broadcastForCoordinatorId).filter(i=>i.category===d.K0.TENDER);if(0===o.length)return this.notificationService.showError("No related provider quotes found to broadcast to."),void(this.isBroadcastSending=!1);const r=o.map(i=>this.quoteService.addNoteToQuote(i.id,this.broadcastMessage,this.currentUserId));(0,y.p)(r).subscribe({next:()=>{this.notificationService.showSuccess("Message broadcast sent to all invited providers."),this.closeBroadcastModal()},error:i=>{console.error("Failed to broadcast message:",i),this.notificationService.showError("Failed to broadcast message."),this.isBroadcastSending=!1}})}onAttachmentUploaded(t){const o=this.quotes.findIndex(r=>r.id===t.id);-1!==o&&(this.quotes[o]=t,this.filterQuotesByStatus()),this.selectedRole===p.Zk.SELLER&&this.getPrimaryState(t)===d.yz.IN_PROGRESS&&(console.log("Provider uploaded PDF, updating quote status to approved:",t.id),this.quoteService.updateQuoteStatus(t.id,d.yz.APPROVED).subscribe({next:r=>{const i=this.quotes.findIndex(l=>l.id===r.id);-1!==i&&(this.quotes[i]=r,this.filterQuotesByStatus());const s=this.extractShortId(t.id);console.log("Quote status automatically updated to approved after PDF upload"),this.notificationService.showSuccess(`Quote ${s} has been approved after PDF upload.`)},error:r=>{console.error("Error updating quote status to approved:",r),this.notificationService.showError(`Error updating quote status: ${r?.message||"Unknown error"}`)}}))}updateQuoteState(t){this.quoteToUpdate=t,this.selectedState=t.state||null,this.showStateUpdate=!0}confirmStateUpdate(){this.quoteToUpdate&&this.selectedState&&this.quoteService.updateQuoteState(this.quoteToUpdate.id,this.selectedState).subscribe({next:t=>{const o=this.quotes.findIndex(r=>r.id===t.id);-1!==o&&(this.quotes[o]=t,this.filterQuotesByStatus()),this.showStateUpdate=!1,this.notificationService.showSuccess("Quote state updated successfully")},error:t=>{console.error("Failed to update quote state:",t),this.notificationService.showError("Failed to update quote state")}})}confirmDelete(t){this.quoteToDelete=t,this.deleteConfirmMessage=`Are you sure you want to delete Quote ${this.extractShortId(t.id)}? This action cannot be undone.`,this.showDeleteConfirm=!0}deleteQuote(){this.quoteToDelete&&this.quoteService.deleteQuote(this.quoteToDelete.id).subscribe({next:()=>{this.quotes=this.quotes.filter(t=>t.id!==this.quoteToDelete.id),this.filterQuotesByStatus(),this.showDeleteConfirm=!1,this.notificationService.showSuccess("Quote deleted successfully")},error:t=>{console.error("Failed to delete quote:",t),this.notificationService.showError("Failed to delete quote")}})}openChat(t){this.selectedChatQuoteId=t.id,this.showChatModal=!0}downloadAttachment(t){try{this.quoteService.downloadAttachment(t),this.notificationService.showSuccess("Download started")}catch(o){console.error("Error downloading attachment:",o),this.notificationService.showError(o.message||"Error downloading attachment")}}downloadCustomerRequest(t){const o=t.externalId||t.id;o?this.quoteService.getQuoteById(o).subscribe({next:r=>{try{if(!r.quoteItem||0===r.quoteItem.length||!r.quoteItem[0].attachment||0===r.quoteItem[0].attachment.length)return void this.notificationService.showError("No buyer's request attachment found on coordinator quote.");this.quoteService.downloadAttachment(r),this.notificationService.showSuccess("Download started")}catch(i){console.error("Error downloading buyer request:",i),this.notificationService.showError(i.message||"Error downloading buyer request")}},error:r=>{console.error("Failed to fetch coordinator quote for download:",r),this.notificationService.showError("Failed to fetch coordinator quote")}}):this.notificationService.showError("No coordinator reference found for this quote.")}addAttachment(t){this.selectedAttachmentQuote=t,this.showAttachmentModal=!0}acceptTenderingQuote(t){const o=this.extractShortId(t.id);this.showConfirmation("Accept Tender Request","Are you sure you want to accept this tender request?",()=>{console.log("Accepting tendering quote:",t.id),this.quoteService.updateQuoteStatus(t.id,"inProgress").subscribe({next:r=>{const i=this.quotes.findIndex(s=>s.id===r.id);-1!==i&&(this.quotes[i]=r,this.filterQuotesByStatus()),console.log("Tendering quote successfully accepted"),this.notificationService.showSuccess(`Tender request ${o} has been accepted and is now in progress.`)},error:r=>{console.error("Error accepting tendering quote:",r),this.notificationService.showError(`Error accepting tender request: ${r.message||"Unknown error"}`)}})},"Accept","px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500")}cancelTenderingQuote(t){const o=this.extractShortId(t.id);this.showConfirmation("Cancel Tender Request","Are you sure you want to cancel this tender request?\n\nThis action cannot be undone.",()=>{console.log("Cancelling tendering quote:",t.id),this.quoteService.updateQuoteStatus(t.id,"cancelled").subscribe({next:r=>{const i=this.quotes.findIndex(s=>s.id===r.id);-1!==i&&(this.quotes[i]=r,this.filterQuotesByStatus()),console.log("Tendering quote successfully cancelled"),this.notificationService.showSuccess(`Tender request ${o} has been cancelled.`)},error:r=>{console.error("Error cancelling tendering quote:",r),this.notificationService.showError(`Error cancelling tender request: ${r.message||"Unknown error"}`)}})},"Cancel Request","px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500")}simulateStartTender(t){const o=this.extractShortId(t.id),r=this.getTodayForAPI();this.showConfirmation("Start Tender",`Are you sure you want to start this tender?\n\nWarning: The Tender Start Date will be updated to today (${r}).`,()=>{this.quoteService.updateQuoteStatus(t.id,"approved").pipe((0,x.n)(i=>{const s=this.quotes.findIndex(l=>l.id===i.id);return-1!==s&&(this.quotes[s]=i,this.filterQuotesByStatus()),this.quoteService.updateQuoteDate(t.id,r,"expectedFulfillment")})).subscribe({next:i=>{const s=this.quotes.findIndex(l=>l.id===i.id);-1!==s&&(this.quotes[s]=i,this.filterQuotesByStatus()),this.notificationService.showSuccess(`Tender ${o} started. Start date set to today.`)},error:i=>{console.error("Error starting tender:",i),this.notificationService.showError(`Error starting tender: ${i.message||"Unknown error"}`)}})},"Start Tender","px-4 py-2 text-sm font-medium text-white bg-orange-600 border border-transparent rounded-md hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500")}simulateCloseTender(t){const o=this.extractShortId(t.id),r=this.getTodayForAPI();this.showConfirmation("Close Tender",`Are you sure you want to close this tender?\n\nWarning: The Tender End Date will be updated to today (${r}).`,()=>{this.quoteService.updateQuoteStatus(t.id,"accepted").pipe((0,x.n)(i=>{const s=this.quotes.findIndex(l=>l.id===i.id);return-1!==s&&(this.quotes[s]=i,this.filterQuotesByStatus()),this.quoteService.updateQuoteDate(t.id,r,"effective")})).subscribe({next:i=>{const s=this.quotes.findIndex(l=>l.id===i.id);-1!==s&&(this.quotes[s]=i,this.filterQuotesByStatus()),this.notificationService.showSuccess(`Tender ${o} closed. End date set to today.`)},error:i=>{console.error("Error closing tender:",i),this.notificationService.showError(`Error closing tender: ${i.message||"Unknown error"}`)}})},"Close Tender","px-4 py-2 text-sm font-medium text-white bg-purple-600 border border-transparent rounded-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500")}getTodayForAPI(){const t=new Date;return`${t.getDate().toString().padStart(2,"0")}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getFullYear()}`}acceptQuoteCustomer(t){const o=this.extractShortId(t.id);this.showConfirmation("Accept Quotation","Are you sure you want to accept the quotation?",()=>{console.log("Buyer accepting quotation:",t.id),this.quoteService.updateQuoteStatus(t.id,"accepted").subscribe({next:r=>{const i=this.quotes.findIndex(s=>s.id===r.id);-1!==i&&(this.quotes[i]=r,this.filterQuotesByStatus()),console.log("Quotation successfully accepted by buyer"),this.notificationService.showSuccess(`Quotation ${o} has been accepted successfully.`)},error:r=>{console.error("Error accepting quotation:",r),this.notificationService.showError(`Error accepting quotation: ${r?.message||"Unknown error"}`)}})},"Accept","px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500")}acceptTenderQuote(t){const o=this.extractShortId(t.id);this.showConfirmation("Accept Tender Quote","Are you sure you want to accept this quote? Every other quote in this tender will be Rejected.",()=>this.executeAcceptTenderQuote(t,o),"Accept","px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500")}executeAcceptTenderQuote(t,o){console.log("Buyer accepting tender:",t.id);const i=(()=>{if(t.externalId)return t.externalId;for(const[s,l]of this.relatedQuotesMap.entries())if(l.some(m=>m.id===t.id))return s;return null})();this.quoteService.updateQuoteStatus(t.id,"accepted").subscribe({next:s=>{if(i){const m=(this.relatedQuotesMap.get(i)||[]).filter(b=>b.id!==t.id).filter(b=>{const g=this.getPrimaryState(b);return g!==d.yz.ACCEPTED&&g!==d.yz.CANCELLED&&g!==d.yz.REJECTED});if(m.length>0){const b=m.map(g=>this.quoteService.updateQuoteStatus(g.id,"rejected"));(0,y.p)(b).subscribe({next:g=>{const ze=(this.relatedQuotesMap.get(i)||[]).map(w=>w.id===s.id?s:g.find(Je=>Je.id===w.id)||w);this.relatedQuotesMap.set(i,ze),this.notificationService.showSuccess(`Tender ${o} accepted. ${g.length} other quote(s) have been rejected.`)},error:g=>{console.error("Error rejecting sibling quotes:",g),this.notificationService.showError(`Accepted the selected quote, but failed rejecting other quotes: ${g.message||"Unknown error"}`)}})}else{const g=(this.relatedQuotesMap.get(i)||[]).map(C=>C.id===s.id?s:C);this.relatedQuotesMap.set(i,g),this.notificationService.showSuccess(`Tender ${o} has been accepted successfully.`)}}else{const l=this.quotes.findIndex(m=>m.id===s.id);-1!==l&&(this.quotes[l]=s,this.filterQuotesByStatus()),this.notificationService.showSuccess(`Tender ${o} has been accepted successfully.`)}},error:s=>{console.error("Error accepting tender:",s),this.notificationService.showError(`Error accepting tender: ${s?.message||"Unknown error"}`)}})}rejectTenderQuote(t){const o=this.extractShortId(t.id);this.showConfirmation("Reject Tender","Are you sure you want to reject this tender?\n\nThis action cannot be undone.",()=>{console.log("Buyer rejecting tender:",t.id),this.quoteService.updateQuoteStatus(t.id,"rejected").subscribe({next:r=>{const i=this.quotes.findIndex(s=>s.id===r.id);-1!==i&&(this.quotes[i]=r,this.filterQuotesByStatus()),console.log("Tender successfully rejected by buyer"),this.notificationService.showSuccess(`Tender ${o} has been rejected.`)},error:r=>{console.error("Error rejecting tender:",r),this.notificationService.showError(`Error rejecting tender: ${r?.message||"Unknown error"}`)}})},"Reject","px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500")}cancelQuote(t){const o=this.extractShortId(t.id);this.showConfirmation("Cancel Quote",`Are you sure you want to cancel quote ${o}?\n\nThis action cannot be undone and will disable all other quote actions.`,()=>{console.log("Cancelling quote:",t.id),this.quoteService.updateQuoteStatus(t.id,"cancelled").subscribe({next:r=>{const i=this.quotes.findIndex(s=>s.id===r.id);-1!==i&&(this.quotes[i]=r,this.filterQuotesByStatus()),console.log("Quote successfully cancelled"),this.notificationService.showSuccess(`Quote ${o} has been cancelled successfully.`)},error:r=>{console.error("Error cancelling quote:",r),this.notificationService.showError(`Error cancelling quote: ${r?.message||"Unknown error"}`)}})},"Cancel Quote","px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500")}extractShortId(t){return t?t.length>8?t.slice(-8):t:"N/A"}getPrimaryState(t){return Array.isArray(t.quoteItem)&&t.quoteItem.length>0?t.quoteItem[0].state||"unknown":t.state?t.state:"unknown"}getQuoteItemState(t){let o="unknown";if(Array.isArray(t.quoteItem)&&t.quoteItem.length>0)for(const r of t.quoteItem)if(r&&r.state){o=r.state;break}return t.category===d.K0.COORDINATOR?this.mapCoordinatorStatusToGUI(o):o}getStatusLabel(t){const o=this.getPrimaryState(t);let r;if(t.category===d.K0.COORDINATOR)r=d.R4;else{if(t.category!==d.K0.TENDER)return o;r=this.selectedRole===p.Zk.BUYER?d.kU:d.NT}switch(o){case d.yz.PENDING:return r.PENDING;case d.yz.IN_PROGRESS:return r.IN_PROGRESS;case d.yz.APPROVED:return r.APPROVED;case d.yz.ACCEPTED:return r.ACCEPTED;case d.yz.CANCELLED:return r.CANCELLED;case d.yz.REJECTED:return r.REJECTED;default:return o}}mapCoordinatorStatusToGUI(t){return{pending:"draft",inProgress:"pre-launched",approved:"launched",accepted:"closed",cancelled:"cancelled",rejected:"rejected"}[t]||t}hasAttachment(t){return Array.isArray(t.quoteItem)&&t.quoteItem.some(o=>o.attachment&&o.attachment.length>0)}getAttachmentName(t){if(!Array.isArray(t.quoteItem))return"";for(const o of t.quoteItem)if(o.attachment&&o.attachment.length>0)return o.attachment[0].name||"attachment.pdf";return""}isQuoteCancelled(t){return!!t.quoteItem?.some(o=>o.state===d.yz.CANCELLED)||t.state===d.yz.CANCELLED}isQuoteAccepted(t){return!!t.quoteItem?.some(o=>o.state===d.yz.ACCEPTED)||t.state===d.yz.ACCEPTED}isQuoteFinalized(t){return this.isQuoteCancelled(t)||this.isQuoteAccepted(t)}isActionDisabled(t,o){const r=this.isQuoteCancelled(t),s=(this.isQuoteAccepted(t),this.isQuoteFinalized(t));switch(o){case"viewDetails":case"chat":case"downloadAttachment":return r;case"addAttachment":case"cancel":return s;case"accept":case"acceptCustomer":case"acceptTender":case"rejectTender":default:return!1;case"addRequestedDate":case"addExpectedDate":return!0}}getButtonClass(t,o){const r="px-2 py-1 text-xs font-medium transition-colors rounded border";return this.isActionDisabled(t,o)?`${r} text-gray-400 cursor-not-allowed border-gray-200`:"viewDetails"===o?`${r} text-blue-600 hover:text-blue-800 border-blue-200 hover:bg-blue-50`:`${r} text-indigo-600 hover:text-indigo-800 border-indigo-200 hover:bg-indigo-50`}getIconButtonClass(t,o,r){const i="p-1.5 text-xs cursor-pointer rounded hover:bg-gray-100 transition-colors";return this.isActionDisabled(t,o)?`${i} text-gray-400 cursor-not-allowed hover:bg-transparent`:`${i} ${r}`}getActionTitle(t,o){return this.isActionDisabled(t,o)?"Action disabled - quote is "+(this.isQuoteCancelled(t)?"cancelled":"accepted"):""}getStateDisplay(t){return t?{pending:"Pending",inProgress:"In Progress",approved:"Approved",rejected:"Rejected",cancelled:"Cancelled",accepted:"Accepted"}[t]||t:"Unknown"}getStateClass(t){switch(t){case"pending":return"status-pending";case"inProgress":return"status-inProgress";case"approved":return"status-approved";case"rejected":return"status-rejected";case"cancelled":return"status-cancelled";case"accepted":return"status-accepted";case"draft":return"status-draft";case"pre-launched":return"status-pre-launched";case"launched":return"status-launched";case"closed":return"status-closed";default:return"status-unknown"}}canUpdateState(t){return t!==d.yz.CANCELLED&&t!==d.yz.ACCEPTED}isCoordinatorExpandable(t){return t.category===d.K0.COORDINATOR&&this.getPrimaryState(t)!==d.yz.PENDING}isExpanded(t){return!!t&&this.expandedQuoteIds.has(t)}toggleExpand(t){t.id&&(this.expandedQuoteIds.has(t.id)?(console.log(`Collapsing quote ${this.extractShortId(t.id)}`),this.expandedQuoteIds.delete(t.id)):(console.log(`Expanding quote ${this.extractShortId(t.id)}, externalId: ${t.externalId}`),this.expandedQuoteIds.add(t.id),this.relatedQuotesMap.has(t.id)?console.log(`Using cached ${this.relatedQuotesMap.get(t.id)?.length} related quotes`):(console.log("Fetching related quotes..."),this.loadRelatedQuotes(t))))}loadRelatedQuotes(t){if(!t.id||!this.currentUserId)return void console.error("Cannot load related quotes: missing id or userId",{id:t.id,userId:this.currentUserId});const o=t.externalId||t.id;console.log(`Loading related quotes for coordinator ${this.extractShortId(t.id)}:`,{userId:this.currentUserId,role:p.XZ.BUYER,externalId:o,coordinatorId:t.id}),this.loadingRelatedQuotes.add(t.id),this.quoteService.getTenderingQuotesByExternalId(this.currentUserId,o,p.XZ.BUYER).subscribe({next:r=>{this.relatedQuotesMap.set(t.id,r),this.loadingRelatedQuotes.delete(t.id),this.enrichQuoteData(r),console.log(`\xe2\u0153\u2026 Successfully loaded ${r.length} related quotes for coordinator ${this.extractShortId(t.id)}`),r.length>0&&console.log("Related quotes:",r.map(i=>({id:this.extractShortId(i.id),provider:this.getProviderName(i),state:this.getQuoteItemState(i)})))},error:r=>{console.error("\xe2\u0152 Failed to load related quotes:",r),this.loadingRelatedQuotes.delete(t.id),this.notificationService.showError("Failed to load related quotes")}})}getRelatedQuotes(t){return t&&this.relatedQuotesMap.get(t)||[]}isLoadingRelatedQuotes(t){return!!t&&this.loadingRelatedQuotes.has(t)}isOrganizationId(t){return t.startsWith("urn:ngsi-ld:organization:")}enrichQuoteData(t){const o=new Set;if(t.forEach(i=>{i.relatedParty?.forEach(s=>{s.id&&!this.organizationNames.has(s.id)&&this.isOrganizationId(s.id)&&o.add(s.id)})}),0===o.size)return;const r=Array.from(o).map(i=>this.accountService.getOrgInfo(i).then(s=>({id:i,name:s?.tradingName||s?.name||i}),()=>({id:i,name:i})));Promise.all(r).then(i=>{i.forEach(({id:s,name:l})=>this.organizationNames.set(s,l)),this.filteredQuotes=[...this.filteredQuotes]})}getProviderName(t){if(!t.relatedParty||0===t.relatedParty.length)return"Unknown Provider";const o=t.relatedParty.find(i=>"seller"===i.role?.toLowerCase());if(!o?.id)return"Unknown Provider";const r=this.organizationNames.get(o.id);return r&&r!==o.id?r:"Loading..."}getBuyerName(t){if(!t.relatedParty||0===t.relatedParty.length)return"Unknown Customer";const o=t.relatedParty.find(i=>"buyer"===i.role?.toLowerCase());if(!o?.id)return"Unknown Customer";const r=this.organizationNames.get(o.id);return r&&r!==o.id?r:"Loading..."}canAcceptTenderingQuote(t){if(!t.externalId)return console.warn("Tendering quote has no externalId, cannot check coordinator state"),!1;const o=this.coordinatorQuoteStatesMap.get(t.externalId);return o?o===d.yz.IN_PROGRESS:(this.loadCoordinatorQuoteState(t.externalId),!1)}canAddAttachmentToTenderingQuote(t){if(!t.externalId)return console.warn("Tendering quote has no externalId, cannot check coordinator state"),!1;const o=this.coordinatorQuoteStatesMap.get(t.externalId);return o?o===d.yz.APPROVED:(this.loadCoordinatorQuoteState(t.externalId),!1)}loadCoordinatorQuoteState(t){this.loadingCoordinatorStates.has(t)||this.coordinatorQuoteStatesMap.has(t)||(console.log(`Loading coordinator quote state for: ${this.extractShortId(t)}`),this.loadingCoordinatorStates.add(t),this.quoteService.getQuoteById(t).subscribe({next:o=>{const r=this.getQuoteItemState(o),i=this.getPrimaryState(o);this.coordinatorQuoteStatesMap.set(t,i),this.loadingCoordinatorStates.delete(t),console.log(`Coordinator quote ${this.extractShortId(t)} state: ${i} (GUI: ${r})`)},error:o=>{console.error(`Failed to load coordinator quote state for ${this.extractShortId(t)}:`,o),this.loadingCoordinatorStates.delete(t),this.coordinatorQuoteStatesMap.set(t,"unknown")}}))}loadCoordinatorStatesForTenderingQuotes(){const t=new Set;if(this.quotes.forEach(r=>{r.category===d.K0.TENDER&&r.externalId&&t.add(r.externalId)}),0===t.size)return(0,f.of)(void 0);const o=Array.from(t).map(r=>this.coordinatorQuoteStatesMap.has(r)?(0,f.of)(void 0):(console.log(`Loading coordinator quote state for: ${this.extractShortId(r)}`),this.loadingCoordinatorStates.add(r),this.quoteService.getQuoteById(r).pipe((0,h.T)(i=>{const s=this.getPrimaryState(i);this.coordinatorQuoteStatesMap.set(r,s),this.loadingCoordinatorStates.delete(r),console.log(`Coordinator quote ${this.extractShortId(r)} state: ${s}`)}),(0,v.W)(i=>(console.error(`Failed to load coordinator quote state for ${this.extractShortId(r)}:`,i),this.loadingCoordinatorStates.delete(r),this.coordinatorQuoteStatesMap.set(r,"unknown"),(0,f.of)(void 0))))));return(0,y.p)(o).pipe((0,h.T)(()=>{}))}getTruncatedTitle(t){return t?t.length>50?t.substring(0,50)+"...":t:"(no title)"}static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-quote-list"]],standalone:!0,features:[e.aNF],decls:55,vars:31,consts:[[1,"w-full","mx-auto","px-6","py-8"],[1,"flex","justify-between","items-center","mb-6"],[1,"flex","items-center","gap-3"],[1,"text-2xl","font-bold","text-gray-900","dark:text-white"],["href","https://knowledgebase.dome-marketplace.eu/books/tailored-offering-guide","target","_blank","rel","noopener noreferrer","title","Click here for the Tender process guide",1,"text-gray-500","hover:text-gray-700","dark:text-gray-400","dark:hover:text-gray-200","transition-colors"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5"],["fill-rule","evenodd","d","M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z","clip-rule","evenodd"],[1,"flex","space-x-3"],["class","bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 flex items-center",3,"click",4,"ngIf"],[1,"bg-gray-600","text-white","px-4","py-2","rounded-md","hover:bg-gray-700","focus:outline-none","focus:ring-2","focus:ring-gray-500","focus:ring-offset-2","disabled:opacity-50",3,"click","disabled"],[1,"mb-6"],[1,"flex","space-x-1","bg-gray-100","dark:bg-gray-700","p-1","rounded-lg"],[1,"flex-1","px-8","py-4","text-2xl","font-medium","rounded-md","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","inline","mr-3"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"],[1,"flex","items-center","space-x-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-gray-500","dark:text-gray-100"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"],[1,"text-sm","font-medium","text-gray-700","dark:text-gray-100"],[1,"form-select","rounded-md","border-gray-300","dark:bg-gray-700","dark:border-gray-800","dark:text-white","shadow-sm","focus:border-indigo-500","focus:ring-indigo-500",3,"ngModelChange","ngModel"],["value",""],["value","pending"],["value","inProgress"],["value","approved"],["value","rejected"],["value","cancelled"],["value","accepted"],["class","flex justify-center items-center py-8",4,"ngIf"],["class","bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded relative mb-4",4,"ngIf"],["class","bg-white dark:bg-gray-700 shadow-md rounded-lg overflow-hidden",4,"ngIf"],["title","Delete Quote","confirmText","Delete","confirmButtonClass","px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",3,"confirm","cancel","isOpen","message"],[3,"confirm","cancel","isOpen","title","message","confirmText","confirmButtonClass"],["class","fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",4,"ngIf"],[3,"close","quoteUpdated","isOpen","quoteId","currentUserRole","currentUserId"],[3,"close","isOpen","quoteId"],[3,"close","uploadSuccess","isOpen","quote"],[3,"closeModal","tenderCreated","tenderUpdated","isOpen","customerId","tenderToEdit"],[1,"bg-blue-600","text-white","px-4","py-2","rounded-md","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","flex","items-center",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"flex","justify-center","items-center","py-8"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-blue-600"],[1,"bg-red-50","border","border-red-200","text-red-700","px-4","py-3","rounded","relative","mb-4"],[1,"flex"],[1,"flex-shrink-0"],["viewBox","0 0 20 20","fill","currentColor",1,"h-5","w-5","text-red-400"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule","evenodd"],[1,"ml-3"],[1,"text-sm","font-medium","text-red-800"],[1,"mt-1","text-sm","text-red-700"],[1,"bg-white","dark:bg-gray-700","shadow-md","rounded-lg","overflow-hidden"],["class","text-center py-12",4,"ngIf"],["class","bg-gray-50 dark:bg-gray-800 px-6 py-3",4,"ngIf"],[4,"ngIf"],[1,"text-center","py-12"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"mx-auto","h-12","w-12","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"mt-2","text-sm","font-medium","text-gray-900","dark:text-white"],[1,"mt-1","text-sm","text-gray-500","dark:text-gray-400"],[1,"bg-gray-50","dark:bg-gray-800","px-6","py-3"],[1,"grid","grid-cols-12","gap-4","text-xs","font-medium","text-gray-500","dark:text-gray-300","uppercase","tracking-wider"],[1,"col-span-2"],[1,"col-span-3"],[1,"col-span-4"],[1,"col-span-1"],[1,"grid","grid-cols-16","gap-4","text-xs","font-medium","text-gray-500","dark:text-gray-300","uppercase","tracking-wider"],["class","quote-row",4,"ngFor","ngForOf"],[1,"quote-row"],[1,"grid","grid-cols-12","gap-4","items-center","px-6","py-4","border-b","border-gray-100","dark:border-gray-600","transition-colors"],[1,"col-span-2","text-sm","text-gray-600","dark:text-gray-400"],[1,"col-span-3","text-sm","font-medium","text-gray-900","dark:text-white"],[1,"col-span-4","text-sm","text-gray-700","dark:text-gray-300",3,"title"],[1,"status-badge","px-2","inline-flex","text-xs","leading-5","font-semibold","rounded-full",3,"ngClass"],[1,"col-span-2","flex","items-center","gap-2"],["title","Chat",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 10h.01M12 10h.01M16 10h.01M21 12c0 4.418-4.03 8-9 8a9.77 9.77 0 01-4-.8L3 21l1.8-4A7.96 7.96 0 013 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"],[1,"px-3","py-1","text-sm","font-medium","text-blue-600","dark:text-blue-400","hover:text-blue-800","dark:hover:text-blue-300","border","border-blue-200","dark:border-blue-700","rounded-md","hover:bg-blue-50","dark:hover:bg-blue-900/20","transition-colors","flex","items-center","gap-1",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"grid","grid-cols-16","gap-4","items-center","px-6","py-4","border-b","border-gray-100","dark:border-gray-600","transition-colors"],[1,"col-span-1","flex","items-center","gap-1"],["class","p-1.5 text-indigo-600 hover:text-indigo-800 hover:bg-indigo-50 rounded transition-colors",3,"title","click",4,"ngIf"],[1,"col-span-3","text-sm","font-medium","text-gray-900","dark:text-white",3,"title"],[1,"col-span-2","text-sm"],["class","flex items-center space-x-1",4,"ngIf"],[1,"col-span-4","flex","flex-wrap","items-center","gap-2"],[1,"px-3","py-1","text-sm","font-medium","text-blue-600","dark:text-blue-400","hover:text-blue-800","dark:hover:text-blue-300","border","border-blue-200","dark:border-blue-700","rounded-md","hover:bg-blue-50","dark:hover:bg-blue-900/20","transition-colors","flex","items-center","gap-1",3,"click"],["class","px-2 py-1 text-xs font-medium transition-colors rounded border text-green-600 hover:text-green-800 border-green-200 hover:bg-green-50","title","Edit tender",3,"click",4,"ngIf"],["class","px-2 py-1 text-xs font-medium transition-colors rounded border text-fuchsia-600 hover:text-fuchsia-800 border-fuchsia-200 hover:bg-fuchsia-50","title","Broadcast message to all invited providers",3,"click",4,"ngIf"],["class","px-2 py-1 text-xs font-medium transition-colors rounded border text-orange-600 hover:text-orange-800 border-orange-200 hover:bg-orange-50 flex items-center gap-1","title","[TEST] Start tender - updates status to 'launched'",3,"click",4,"ngIf"],["class","px-2 py-1 text-xs font-medium transition-colors rounded border text-purple-600 hover:text-purple-800 border-purple-200 hover:bg-purple-50 flex items-center gap-1","title","[TEST] Close tender - updates status to 'closed'",3,"click",4,"ngIf"],["class","px-6 py-4 bg-gray-50 dark:bg-gray-800 border-t border-gray-200 dark:border-gray-600",4,"ngIf"],[1,"p-1.5","text-indigo-600","hover:text-indigo-800","hover:bg-indigo-50","rounded","transition-colors",3,"click","title"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4","transition-transform"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 9l-7 7-7-7"],[1,"flex","items-center","space-x-1"],["title","Download attachment",1,"flex","items-center","space-x-1","text-purple-600","hover:text-purple-800","disabled:text-gray-300",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"],[1,"text-xs","truncate","max-w-[100px]"],["title","Edit tender",1,"px-2","py-1","text-xs","font-medium","transition-colors","rounded","border","text-green-600","hover:text-green-800","border-green-200","hover:bg-green-50",3,"click"],["title","Broadcast message to all invited providers",1,"px-2","py-1","text-xs","font-medium","transition-colors","rounded","border","text-fuchsia-600","hover:text-fuchsia-800","border-fuchsia-200","hover:bg-fuchsia-50",3,"click"],["title","[TEST] Start tender - updates status to 'launched'",1,"px-2","py-1","text-xs","font-medium","transition-colors","rounded","border","text-orange-600","hover:text-orange-800","border-orange-200","hover:bg-orange-50","flex","items-center","gap-1",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-3","w-3"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 10V3L4 14h7v7l9-11h-7z"],["title","[TEST] Close tender - updates status to 'closed'",1,"px-2","py-1","text-xs","font-medium","transition-colors","rounded","border","text-purple-600","hover:text-purple-800","border-purple-200","hover:bg-purple-50","flex","items-center","gap-1",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"px-6","py-4","bg-gray-50","dark:bg-gray-800","border-t","border-gray-200","dark:border-gray-600"],[1,"ml-8"],[1,"text-sm","font-semibold","text-gray-700","dark:text-gray-300","mb-3"],["class","flex items-center justify-center py-4",4,"ngIf"],["class","bg-white dark:bg-gray-700 rounded-lg shadow-sm border border-gray-200 dark:border-gray-600",4,"ngIf"],["class","text-center py-6 text-sm text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600",4,"ngIf"],[1,"flex","items-center","justify-center","py-4"],[1,"animate-spin","rounded-full","h-6","w-6","border-b-2","border-blue-600"],[1,"ml-2","text-sm","text-gray-600","dark:text-gray-400"],[1,"bg-white","dark:bg-gray-700","rounded-lg","shadow-sm","border","border-gray-200","dark:border-gray-600"],[1,"bg-gray-100","dark:bg-gray-800","px-4","py-2","border-b","border-gray-200","dark:border-gray-600"],[1,"grid","grid-cols-12","gap-4","text-xs","font-medium","text-gray-600","dark:text-gray-300","uppercase"],["class","px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",3,"border-b","border-gray-200","dark:border-gray-600",4,"ngFor","ngForOf"],[1,"px-4","py-3","hover:bg-gray-50","dark:hover:bg-gray-600","transition-colors"],[1,"grid","grid-cols-12","gap-4","items-center","text-sm"],[1,"col-span-4","text-gray-900","dark:text-white","font-medium"],[1,"status-badge","px-2","py-0.5","inline-flex","text-xs","leading-5","font-semibold","rounded-full",3,"ngClass"],["class","flex items-center space-x-1 text-purple-600 hover:text-purple-800","title","Download attachment",3,"click",4,"ngIf"],[1,"col-span-3","flex","items-center","gap-2"],["title","Chat",1,"p-1","text-gray-500","hover:text-gray-700","rounded","hover:bg-gray-100","transition-colors",3,"click"],[1,"px-2","py-1","text-xs","font-medium","text-blue-600","hover:text-blue-800","border","border-blue-200","rounded-md","hover:bg-blue-50","transition-colors","flex","items-center","gap-1",3,"click"],["title","Download attachment",1,"flex","items-center","space-x-1","text-purple-600","hover:text-purple-800",3,"click"],[1,"text-xs","truncate","max-w-[80px]"],[1,"text-center","py-6","text-sm","text-gray-500","dark:text-gray-400","bg-white","dark:bg-gray-700","rounded-lg","border","border-gray-200","dark:border-gray-600"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"mx-auto","h-8","w-8","text-gray-400","mb-2"],[1,"fixed","inset-0","bg-gray-600","bg-opacity-50","overflow-y-auto","h-full","w-full","z-50"],[1,"relative","top-20","mx-auto","p-5","border","w-96","shadow-lg","rounded-md","bg-white"],[1,"mt-3"],[1,"text-lg","font-medium","text-gray-900","mb-4"],[1,"space-y-3"],["class","flex items-center",4,"ngFor","ngForOf"],[1,"mt-6","flex","justify-end","space-x-3"],[1,"px-4","py-2","text-sm","font-medium","text-gray-700","bg-white","border","border-gray-300","rounded-md","hover:bg-gray-50","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-indigo-500",3,"click"],[1,"px-4","py-2","text-sm","font-medium","text-white","bg-indigo-600","border","border-transparent","rounded-md","hover:bg-indigo-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-indigo-500","disabled:opacity-50",3,"click","disabled"],[1,"flex","items-center"],["type","radio",1,"focus:ring-indigo-500","h-4","w-4","text-indigo-600","border-gray-300",3,"ngModelChange","id","ngModel","value"],[1,"ml-3","block","text-sm","font-medium","text-gray-700",3,"for"],[1,"mt-1"],["rows","4","placeholder","Type your message to all invited providers...",1,"w-full","border","border-gray-300","rounded-md","p-2","focus:outline-none","focus:ring-2","focus:ring-indigo-500","focus:border-indigo-500",3,"ngModelChange","ngModel"],[1,"mt-4","flex","justify-end","space-x-3"],[1,"px-4","py-2","text-sm","font-medium","text-white","bg-fuchsia-600","border","border-transparent","rounded-md","hover:bg-fuchsia-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-fuchsia-500","disabled:opacity-50",3,"click","disabled"]],template:function(o,r){1&o&&(e.nrm(0,"app-notification"),e.j41(1,"div",0)(2,"div",1)(3,"div",2)(4,"h1",3),e.EFF(5,"Tenders Dashboard"),e.k0s(),e.j41(6,"a",4),e.qSk(),e.j41(7,"svg",5),e.nrm(8,"path",6),e.k0s()()(),e.joV(),e.j41(9,"div",7),e.DNE(10,xe,4,0,"button",8),e.j41(11,"button",9),e.bIt("click",function(){return r.refreshQuotes()}),e.EFF(12),e.k0s()()(),e.j41(13,"div",10)(14,"div",11)(15,"button",12),e.bIt("click",function(){return r.selectRole(r.UI_ROLES.BUYER)}),e.qSk(),e.j41(16,"svg",13),e.nrm(17,"path",14),e.k0s(),e.EFF(18," As Buyer "),e.k0s(),e.joV(),e.j41(19,"button",12),e.bIt("click",function(){return r.selectRole(r.UI_ROLES.SELLER)}),e.qSk(),e.j41(20,"svg",13),e.nrm(21,"path",15),e.k0s(),e.EFF(22," As Provider "),e.k0s()()(),e.joV(),e.j41(23,"div",10)(24,"div",16),e.qSk(),e.j41(25,"svg",17),e.nrm(26,"path",18),e.k0s(),e.joV(),e.j41(27,"span",19),e.EFF(28,"Filter by status"),e.k0s(),e.j41(29,"select",20),e.mxI("ngModelChange",function(s){return e.DH7(r.statusFilter,s)||(r.statusFilter=s),s}),e.bIt("ngModelChange",function(){return r.filterQuotesByStatus()}),e.j41(30,"option",21),e.EFF(31,"All Statuses"),e.k0s(),e.j41(32,"option",22),e.EFF(33,"Pending"),e.k0s(),e.j41(34,"option",23),e.EFF(35,"In Progress"),e.k0s(),e.j41(36,"option",24),e.EFF(37,"Approved"),e.k0s(),e.j41(38,"option",25),e.EFF(39,"Rejected"),e.k0s(),e.j41(40,"option",26),e.EFF(41,"Cancelled"),e.k0s(),e.j41(42,"option",27),e.EFF(43,"Accepted"),e.k0s()()()(),e.DNE(44,ye,2,0,"div",28)(45,Ce,10,1,"div",29)(46,Be,6,5,"div",30),e.k0s(),e.j41(47,"app-confirm-dialog",31),e.bIt("confirm",function(){return r.deleteQuote()})("cancel",function(){return r.showDeleteConfirm=!1}),e.k0s(),e.j41(48,"app-confirm-dialog",32),e.bIt("confirm",function(){return r.genericConfirmCallback&&r.genericConfirmCallback()})("cancel",function(){return r.showGenericConfirm=!1}),e.k0s(),e.DNE(49,Oe,12,2,"div",33),e.j41(50,"app-quote-details-modal",34),e.bIt("close",function(){return r.closeQuoteDetailsModal()})("quoteUpdated",function(s){return r.onQuoteUpdated(s)}),e.k0s(),e.j41(51,"app-chat-modal",35),e.bIt("close",function(){return r.closeChatModal()}),e.k0s(),e.j41(52,"app-attachment-modal",36),e.bIt("close",function(){return r.closeAttachmentModal()})("uploadSuccess",function(s){return r.onAttachmentUploaded(s)}),e.k0s(),e.DNE(53,Ye,11,3,"div",33),e.j41(54,"app-create-tender-modal",37),e.bIt("closeModal",function(){return r.closeCreateTenderModal()})("tenderCreated",function(s){return r.onTenderCreated(s)})("tenderUpdated",function(){return r.onTenderUpdated()}),e.k0s()),2&o&&(e.R7$(10),e.Y8G("ngIf",r.selectedRole===r.UI_ROLES.BUYER),e.R7$(),e.Y8G("disabled",r.loading),e.R7$(),e.SpI(" ",r.loading?"Loading...":"Refresh"," "),e.R7$(3),e.HbH(r.getRoleTabClass(r.UI_ROLES.BUYER)),e.R7$(4),e.HbH(r.getRoleTabClass(r.UI_ROLES.SELLER)),e.R7$(10),e.R50("ngModel",r.statusFilter),e.R7$(15),e.Y8G("ngIf",r.loading),e.R7$(),e.Y8G("ngIf",r.error),e.R7$(),e.Y8G("ngIf",!r.loading&&!r.error),e.R7$(),e.Y8G("isOpen",r.showDeleteConfirm)("message",r.deleteConfirmMessage),e.R7$(),e.Y8G("isOpen",r.showGenericConfirm)("title",r.genericConfirmTitle)("message",r.genericConfirmMessage)("confirmText",r.genericConfirmButtonText)("confirmButtonClass",r.genericConfirmButtonClass),e.R7$(),e.Y8G("ngIf",r.showStateUpdate),e.R7$(),e.Y8G("isOpen",r.showQuoteDetailsModal)("quoteId",r.selectedQuoteId)("currentUserRole",r.getModalUserRole())("currentUserId",r.currentUserId||""),e.R7$(),e.Y8G("isOpen",r.showChatModal)("quoteId",r.selectedChatQuoteId),e.R7$(),e.Y8G("isOpen",r.showAttachmentModal)("quote",r.selectedAttachmentQuote),e.R7$(),e.Y8G("ngIf",r.showBroadcastModal),e.R7$(),e.Y8G("isOpen",r.showCreateTenderModal)("customerId",r.currentUserId||"")("tenderToEdit",r.tenderToEdit))},dependencies:[_.MD,_.YU,_.Sq,_.bT,_.vh,u.YN,u.xH,u.y7,u.me,u.wz,u.Fm,u.BC,u.vS,j.z,T.w,A.h,L.d,G.w,be],styles:[".status-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;border-radius:9999px;padding:.125rem .625rem;font-size:.75rem;line-height:1rem;font-weight:500}.status-pending[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(253 246 178 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(114 59 19 / var(--tw-text-opacity))}.status-inProgress[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(225 239 254 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(30 66 159 / var(--tw-text-opacity))}.status-approved[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(222 247 236 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(3 84 63 / var(--tw-text-opacity))}.status-rejected[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(253 232 232 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(155 28 28 / var(--tw-text-opacity))}.status-cancelled[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(243 244 246 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(31 41 55 / var(--tw-text-opacity))}.status-accepted[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(209 250 229 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(6 95 70 / var(--tw-text-opacity))}.status-unknown[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(243 244 246 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(75 85 99 / var(--tw-text-opacity))}.status-draft[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(253 246 178 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(114 59 19 / var(--tw-text-opacity))}.status-pre-launched[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(225 239 254 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(30 66 159 / var(--tw-text-opacity))}.status-launched[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(222 247 236 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(3 84 63 / var(--tw-text-opacity))}.status-closed[_ngcontent-%COMP%]{--tw-bg-opacity: 1;background-color:rgb(243 244 246 / var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgb(31 41 55 / var(--tw-text-opacity))}.rotate-180[_ngcontent-%COMP%]{transform:rotate(180deg)}"]})}return n})();const Ve=[{path:"",component:M}];let Xe=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#r=this.\u0275inj=e.G2t({imports:[_.MD,k.iI.forChild(Ve),M,j.z,T.w]})}return n})()}}]);